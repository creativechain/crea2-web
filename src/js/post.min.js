"use strict";(function(){var m;var h;var g;var a=window.location.pathname;var j,b;var d=3;function k(){--d;if(d===0){creaEvents.emit("crea.dom.ready")}}function f(t){t.post.reported=false;if(j){var s=j.account.username;for(var D=0;D<t.post.down_votes.length;D++){var F=t.post.down_votes[D];if(F.voter===s){t.post.reported=true;break}}}if(!m){m=new Vue({el:"#post-view",data:{lang:lang,CONSTANTS:CONSTANTS,session:j,user:b?b.user:false,state:t,comment:""},mounted:function r(){k()},methods:{showPost:showPost,humanFileSize:humanFileSize,getBuzzClass:function P(Y){var x={};var v=Y.buzz.level_name;x[v]=true;return x},cbdToDollar:function M(v){return"$ "+Asset.parseString(v).toPlainString()},assetToString:function V(v){return Asset.parse(v).toFriendlyString()},assetPart:function X(x,v){x=Asset.parse(x);switch(v){case"int":return x.toPlainString(null,false).split(".")[0];case"dec":return x.toPlainString(null,false).split(".")[1];case"sym":return x.asset.symbol;default:return Asset.parse(x).toFriendlyString()}},getDefaultAvatar:R.getAvatar,getLicense:function L(){return License.fromFlag(this.state.post.metadata.license)},dateFromNow:function T(v){return moment(toLocaleDate(v)).fromNow()},formatDate:function I(v){return moment(toLocaleDate(v)).format("LLLL")},hasPaid:function Q(){var x=new Date();var v=toLocaleDate(this.state.post.cashout_time);return x.getTime()>v.getTime()},getPayoutPostDate:function S(){var x=this.state.post;var v=toLocaleDate(x.cashout_time);if(this.hasPaid(x)){v=toLocaleDate(x.last_payout)}return moment(v).fromNow()},hasPromotion:function K(){var x=this.state.post;var v=Asset.parseString(x.promoted);return v.amount>0},getPromotion:function J(){var x=this.state.post;var v=Asset.parseString(x.promoted);return"$ "+v.toPlainString()},getPayout:function w(Y,v){if(!Y){Y=this.state.post}var x=Asset.parseString(Y.pending_payout_value);if(this.hasPaid()){x=Asset.parseString(Y.total_payout_value);x=x.add(Asset.parseString(Y.curator_payout_value))}return(v?"$ ":"")+x.toPlainString(2)},getFriendlyPayout:function H(){return this.getPayout(null,false)+" CBD"},getPendingPayouts:function u(x){x=x?x.toLowerCase():"";var ae=this.state.post;var ag=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"});var aa=this.state.props.cbd_print_rate;var Y=10000;var ac=Asset.parseString(ae.pending_payout_value);var ab=ac;var ah=ae.percent_crea_dollars/20000;var Z=Asset.parse({amount:ab.toFloat()*ah,nai:"cbd"});var ad=Asset.parse({amount:NaNOr(((ab.toFloat()-Z.toFloat())/ag.toFloat()),0),nai:"cgy"});var af=Asset.parse({amount:NaNOr((Z.toFloat()*(aa/Y)),0),nai:"cbd"});var v=Asset.parse({amount:NaNOr(((Z.toFloat()-af.toFloat())/ag.toFloat()),0),nai:"crea"});switch(x){case"cgy":return ad.toFriendlyString(null,false);case"cbd":return af.toFriendlyString(null,false);case"crea":return v.toFriendlyString(null,false);default:return"("+af.toFriendlyString(null,false)+", "+v.toFriendlyString(null,false)+", "+ad.toFriendlyString(null,false)+")"}},getFeaturedImage:function B(x){var v=x.metadata.featuredImage;if(v&&v.hash){return{url:"https://ipfs.creary.net/ipfs/"+v.hash}}else{if(v&&v.url){return v}}return{}},getLinkedTags:function U(x){var v=this.state.post.metadata.tags;var Y=[];v.forEach(function(Z){Y.push('<a href="/search?page=1&query='+encodeURIComponent(Z)+'">'+Z+"</a>")});if(x){return Y.join(", ")}return Y},isSameUser:function W(){if(this.session){return this.state.post.author===this.session.account.username}return false},editPost:function C(){var v=this.state.post.author+"/"+this.state.post.permlink;goTo("/publish?edit="+encodeURIComponent(v))},makeComment:l,makeDownload:i,ignoreUser:function(x){function v(){return x.apply(this,arguments)}v.toString=function(){return x.toString()};return v}(function(){ignoreUser(this.state.post.author,true,function(x,v){n()})}),vote:function z(x){if(this.session){var v=this;var Y=this.session.account.username;requireRoleKey(Y,"posting",function(Z){globalLoading.show=true;crea.broadcast.vote(Z,Y,v.state.post.author,v.state.post.permlink,x,function(ab,aa){globalLoading.show=false;catchError(ab);n()})})}},onVote:function q(v){catchError(v);updateUserSession()},onFollow:function y(x,v){catchError(x);updateUserSession()}}})}else{m.state=t;m.session=j;m.user=b?b.user:null}if(j){if(!h){h=new Vue({el:"#modal-promote",data:{lang:lang,session:j,user:b?b.user:null,state:t,amount:0},mounted:function r(){k()},methods:{hideModalPromote:function G(v){cancelEventPropagation(v);$("#modal-promote").removeClass("modal-active")},makePromotion:function A(Z){cancelEventPropagation(Z);var ab=this.session.account.username;var aa="null";var v="@"+this.state.post.author+"/"+this.state.post.permlink;var x=parseFloat(this.amount)+0.0001;console.log(x);x=Asset.parse({amount:x,nai:apiOptions.nai.CBD}).toFriendlyString(null,false);console.log(x);var Y=this;requireRoleKey(ab,"active",function(ac){globalLoading.show=true;crea.broadcast.transfer(ac,ab,aa,x,v,function(ae,ad){globalLoading.show=false;if(!catchError(ae)){Y.hideModalPromote();updateUserSession()}})})}}})}else{h.session=j;h.user=b?b.user:null;h.state=t}if(t.post.download.resource){if(!g){var O=Asset.parse(t.post.download.price);var o=O.asset.symbol===apiOptions.symbol.CREA?Asset.parseString("0.000 CREA"):Asset.parseString("0.000 CBD");var p=false;if(j){o=O.asset.symbol===apiOptions.symbol.CREA?Asset.parseString(b.user.balance):Asset.parseString(b.user.cbd_balance);p=t.post.download.downloaders.includes(b.user.name)}g=new Vue({el:"#modal-download",data:{lang:lang,session:j,user:b?b.user:false,state:t,modal:{amount:O.toPlainString(null,false),symbol:O.asset.symbol.toUpperCase(),balance:o.toFriendlyString(null,false),alreadyPayed:p,confirmed:false}},mounted:function r(){k()},methods:{cancelPay:function N(){this.modal.confirmed=false},confirmDownload:function E(){if(this.modal.alreadyPayed||this.modal.confirmed){i()}else{this.modal.confirmed=true}}}})}else{g.session=j;g.user=b?b.user:null;g.state=t}}else{k()}}else{k();k()}}function l(){var o=Session.getAlive();var p=m.comment;if(o&&p.length>0){requireRoleKey(o.account.username,"posting",function(u){globalLoading.show=true;var t=m.state.post.author;var s=m.state.post.permlink;var q=crea.formatter.commentPermlink(t,s);if(q.length>CONSTANTS.TEXT_MAX_SIZE.PERMLINK){q=q.substring(0,CONSTANTS.TEXT_MAX_SIZE.PERMLINK)}console.log(q.length,s.length);var r={tags:[m.state.post.metadata.tags[0]]};crea.broadcast.comment(u,t,s,o.account.username,q,"",p,"",jsonstring(r),function(w,v){globalLoading.show=false;if(!catchError(w)){m.comment="";n()}})})}}function i(q){cancelEventPropagation(q);var r=m.session;var o=m.user;var p=m.state.post;if(r){requireRoleKey(r.account.username,"active",function(u){globalLoading.show=true;var s=function s(){setTimeout(function(){var y=Buffer.from(p.author);var x=Buffer.from(p.permlink);var z=Buffer.concat([y,x]);var v=crea.utils.Signature.signBuffer(z,u);var w=v.toBuffer().toString("base64");crea.api.getDownload(r.account.username,p.author,p.permlink,w,function(D,A){globalLoading.show=false;if(!catchError(D)){var C=/Qm[a-zA-Z0-9]+/;var E=C.exec(A.resource)[0];console.log(E);if(!p.download.type){p.download.type="application/octet-stream"}var B=apiOptions.ipfsd+"/"+p.download.type+"/"+E+"/"+p.download.name;B+="?stream=false";downloadFile(B,p.download.name);$("#modal-download").removeClass("modal-active")}})},3000)};var t=function t(){crea.broadcast.commentDownload(u,r.account.username,p.author,p.permlink,function(w,v){if(!catchError(w)){s();n()}else{globalLoading.show=false}})};if(p.download.downloaders.includes(o.name)){s()}else{t()}})}}function e(p){if(!p){p=a}var o=p.replace("@","").split("/");o.splice(0,2);return o.join("/")}function c(r,o){var p=function p(s){var t=new Vue({el:"#more-projects",data:{otherProjects:s},mounted:function v(){mr.sliders.documentReady($)},methods:{showPost:showPost,getFeaturedImage:function u(x){var w=x.metadata.featuredImage;if(w&&w.hash){return{url:"https://ipfs.creary.net/ipfs/"+w.hash}}else{if(w&&w.url){return w}}return{}}}});t.$forceUpdate()};var q=new Date().toISOString().replace("Z","");crea.api.getDiscussionsByAuthorBeforeDateWith({start_permlink:"",limit:100,before_date:q,author:r},function(y,t){if(!catchError(y)){var w=[];t.discussions.forEach(function(x){x.metadata=jsonify(x.json_metadata);if(x.permlink!==o&&x.metadata.featuredImage){w.push(x)}});if(w.length>12){var u=[];for(var s=0;s<12;s++){var v=randomNumber(0,w.length-1);u.push(w.splice(v,1)[0])}w=u}p(w)}})}function n(){if(a){var r=a.slice(1,a.length).split("/").length;var p=function p(s){crea.api.getState(s,function(w,t){if(!catchError(w)){var u=Object.keys(t.accounts);if(u.length===0){goTo("/404")}else{u.forEach(function(x){t.accounts[x]=parseAccount(t.accounts[x])});t.postKey=e(s);t.post=parsePost(t.content[t.postKey]);t.author=t.accounts[t.post.author];var v=Object.keys(t.content);v.sort(function(A,z){var y=new Date(t.content[A].created);var x=new Date(t.content[z].created);return x.getTime()-y.getTime()});v.forEach(function(x){t[x]=parsePost(t.content[x])});t.comments=v;f(t)}}})};if(r===2){var q=getPathPart().replace("@","");var o=getPathPart(1);crea.api.getContent(q,o,function(u,s){if(!catchError(u)){var t=parsePost(s);p("/"+t.metadata.tags[0]+"/@"+q+"/"+o)}})}else{p(a)}}}creaEvents.on("crea.dom.ready",function(){var p=getPathPart();var o;if(!p.startsWith("@")){p=getPathPart(1).replace("@","");o=getPathPart(2)}else{p=getPathPart().replace("@","");o=getPathPart(1)}c(p,o)});creaEvents.on("crea.session.login",function(p,o){j=p;b=o;n()});creaEvents.on("crea.session.update",function(p,o){j=p;b=o;n()});creaEvents.on("crea.session.logout",function(){j=false;b=false;n()})})();