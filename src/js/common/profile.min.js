var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,g,e){b!=Array.prototype&&b!=Object.prototype&&(b[g]=e.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,g,e,m){if(g){e=$jscomp.global;b=b.split(".");for(m=0;m<b.length-1;m++){var n=b[m];n in e||(e[n]={});e=e[n]}b=b[b.length-1];m=e[b];g=g(m);g!=m&&null!=g&&$jscomp.defineProperty(e,b,{configurable:!0,writable:!0,value:g})}};$jscomp.polyfill("Object.is",function(b){return b?b:function(b,e){return b===e?0!==b||1/b===1/e:b!==b&&e!==e}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(b,e){var g=this;g instanceof String&&(g=String(g));var n=g.length;e=e||0;for(0>e&&(e=Math.max(e+n,0));e<n;e++){var r=g[e];if(r===b||Object.is(r,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(b,g,e){if(null==b)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return b+""};$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,e){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,e||0)}},"es6","es3");
$jscomp.owns=function(b,g){return Object.prototype.hasOwnProperty.call(b,g)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(b,g){for(var e=1;e<arguments.length;e++){var m=arguments[e];if(m)for(var n in m)$jscomp.owns(m,n)&&(b[n]=m[n])}return b};$jscomp.polyfill("Object.assign",function(b){return b||$jscomp.assign},"es6","es3");$jscomp.arrayIteratorImpl=function(b){var g=0;return function(){return g<b.length?{done:!1,value:b[g++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,g){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(e){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(e||"")+"_"+g++,e)}var g=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,g){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var e=0,m={next:function(){if(e<b.length){var n=e++;return{value:g(n,b[n]),done:!1}}m.next=function(){return{done:!0,value:void 0}};return m.next()}};m[Symbol.iterator]=function(){return m};return m};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,e){var g=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var n=g.length,r=b.length;e=Math.max(0,Math.min(e|0,g.length));for(var y=0;y<r&&e<n;)if(g[e++]!=b[y++])return!1;return y>=r}},"es6","es3");
(function(){function b(a,b){console.log("Modal De-Energize",jsonify(jsonstring(a)));var c=parseFloat(vestingCrea(a.user,a.props).toPlainString(null,!1)),f=parseFloat(delegatedCrea(a.user,a.props).toPlainString(null,!1));c-=f;f=vestsToCgy(a,(new Vests(a.user.withdrawn)).toFriendlyString(null,!1),apiOptions.nai.CREA);var d=vestsToCgy(a,(new Vests(a.user.to_withdraw)).toFriendlyString(null,!1),apiOptions.nai.CREA),h="";0<d.amount-f.amount&&(h=String.format(lang.WALLET.DE_ENERGIZE_TEXT,d.toFriendlyString(null,
!1),f.toFriendlyString(null,!1)));A?(A.session=b,A.state=a):A=new Vue({el:"#wallet-de-energize",data:{lang:lang,session:b,state:a,maxPowerDown:c,finalAmount:0,sliderValue:0,amountByWeek:"",withdrawNote:h},methods:{formatString:String.format,onAmount:function(a){a+=1E-4;var c=Asset.parse({amount:a,nai:apiOptions.nai.CREA});this.amountByWeek=.001>a?"":String.format(this.lang.WALLET.DE_ENERGIZE_AMOUNT_BY_WEEK,c.divide(8).toFriendlyString(null,!1))},onManualChange:function(a){a&&(a=a.target.valueAsNumber,
isNaN(a)&&(a=0),this.onAmount(a))},hideModalDeEnergize:function(a){cancelEventPropagation(a);hideModal($("#wallet-de-energize").parent())},makeDeEnergize:function(a,c){cancelEventPropagation(a);var d=this,k=this.session.account.username;requireRoleKey(k,"active",function(a){globalLoading.show=!0;var c=d.finalAmount+" CREA";console.log(c);c=cgyToVests(d.state,c);crea.broadcast.withdrawVesting(a,k,c.toFriendlyString(null,!1),function(k,a){globalLoading.show=!1;catchError(k)||(d.hideModalDeEnergize(),
updateUserSession())})})}}})}function g(a,b){t?(t.state=a,t.session=b,t.from=a.user.name):t=new Vue({el:"#wallet-send",data:{CONSTANTS:CONSTANTS,session:b,state:a,lang:lang,from:a.user.name,amount:0,memo:"",config:clone(B),toError:!1},mounted:function(){var a=this;$("#wallet-send").on("modalClosed.modals.mr",function(){a.clearFields()})},methods:{shouldShowMemo:function(){return!["transfer_to_vests","transfer_to_savings_crea","transfer_to_savings_cbd"].includes(this.config.op)},cancelSend:function(a){cancelEventPropagation(a);
this.config.confirmed=!1},hideModalSend:function(a){cancelEventPropagation(a);hideModal("#wallet-send");this.clearFields()},clearFields:function(){this.amount=0;this.memo="";this.config=clone(B)},useTotalAmount:function(a){cancelEventPropagation(a);this.amount=this.config.total_amount.toPlainString()},sendCrea:function(){if(!this.toError&&this.amount)if(this.config.confirmed){var a=this,b={amount:a.amount,nai:a.config.nai.toLowerCase(),round:!0},d=Asset.parse(b).toFriendlyString(null,!1);requireRoleKey(this.session.account.username,
"active",function(c){globalLoading.show=!0;console.log("Key:",c,a.config.op);J(c,a.config.op,a.session,a.config.to,d,a.memo,function(c,d){globalLoading.show=!1;!catchError(c)&&d&&(updateUserSession(),a.hideModalSend())})})}else this.config.confirmed=!0,this.config.button=this.lang.BUTTON.SEND},validateDestiny:function(a){a=a.target.value;if(crea.utils.validateAccountName(a))this.toError=!0;else{a=[a];console.log("Checking",a);var c=this;crea.api.lookupAccountNames(a,function(a,b){a?(console.error(a),
c.toError=!0):c.toError=null==b[0]})}}}})}function e(a,b,c,p){var d=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"projects",h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"balance",f=a.user?a.user.savings_withdraw_requests:0,e=null,q=null;0<a.user.to_withdraw&&b&&a.user.name===b.account.username&&0<toLocaleDate(a.user.next_vesting_withdrawal).valueOf()&&(e=String.format(lang.WALLET.NEXT_DE_ENERGIZE,toLocaleDate(a.user.next_vesting_withdrawal).fromNow()));0<f&&(q=String.format(lang.WALLET.SAVINGS_WITHDRAWAL_TEXT,
f));console.log(clone(a));l?(console.log("Updating data"),l.state=a,l.session=b,l.account=c,l.filter=p,l.profile=a.user.metadata,l.navbar.section=d,l.changePass.username=b?b.account.username:null):l=new Vue({el:"#profile-container",data:{CONSTANTS:CONSTANTS,lang:lang,isoLangs:isoLangs,session:b,account:c,state:a,filter:p,navbar:{section:d},profile:a.user.metadata,walletTab:h,history:{data:[],accounts:{}},blocked:{},showPriv:{posting:!1,active:!1,owner:!1,memo:!1},changePass:{username:b?b.account.username:
null,oldPass:null,newPass:null,matchedPass:null,checkedLostPass:!1,checkedStoredPass:!1,error:null},nextDeEnergize:e,savingsWithdrawNote:q,simpleView:!1},updated:function(){var a=$("#wallet-tabs").prev();a.is(":empty")&&a.remove();var b=$("#profile-edit-tags");b.tagsinput({maxTags:CONSTANTS.MAX_TAGS,maxChars:CONSTANTS.TEXT_MAX_SIZE.TAG,delimiter:" "});this.profile.tags&&this.profile.tags.forEach(function(a){b.tagsinput("add",a)})},methods:{isFeed:function(){return!1},getDefaultAvatar:R.getAvatar,
toUrl:toUrl,hidePrivKey:function(a){this.showPriv[a]=!1},getPrivKey:function(a){var k=this;requireRoleKey(this.session?this.session.account.username:"",a,function(b){k.showPriv[a]=b})},getKey:function(k){return this.showPriv[k]?this.showPriv[k]:"memo"===k?a.user.memo_key:a.user[k].key_auths[0][0]},prepareModal:function(a){switch(a){case "transfer_crea":var k={title:this.lang.WALLET.TRANSFER_CREA_TITLE,text:this.lang.WALLET.TRANSFER_CREA_TEXT,button:this.lang.BUTTON.CONFIRM,nai:apiOptions.symbol.CREA,
total_amount:Asset.parseString(this.state.user.balance)};break;case "transfer_to_savings_crea":k={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:!0};break;case "transfer_to_savings_cbd":k={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,
nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance),to:this.session.account.username,disableTo:!0};break;case "transfer_from_savings_cbd":k={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CBD,text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.savings_cbd_balance)};break;case "transfer_from_savings_crea":k={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CREA,
text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.savings_balance)};break;case "transfer_to_vests":k={title:this.lang.WALLET.CONVERT_CGY_TITLE,text:this.lang.WALLET.CONVERT_CGY_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:!0};break;case "transfer_cbd":k={title:this.lang.WALLET.TRANSFER_CBD_TITLE,
text:this.lang.WALLET.TRANSFER_CBD_TEXT,button:this.lang.BUTTON.SEND,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance)}}k.op=a;t.config=Object.assign(clone(B),k)},canWithdraw:function(){return this.session&&this.session.account.username==a.user.name},parseAsset:function(a){var k=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0;return Asset.parse(a).toFriendlyString(k,b)},assetPart:function(a,
b){a=Asset.parse(a);switch(b){case "int":return a.toPlainString(null,!1).split(".")[0];case "dec":return a.toPlainString(null,!1).split(".")[1];case "sym":return a.asset.symbol;default:return Asset.parse(a).toFriendlyString(null,!0)}},openPost:function(a,b){cancelEventPropagation(b);creaEvents.emit("navigation.post.data",a,this.state,"","profile");showModal("#modal-post")},showProfile:showProfile,getJoinDate:function(){var a=toLocaleDate(this.state.user.created);return this.lang.PROFILE.JOINED+a.format("MMMM YYYY")},
getBuzzClass:function(a){var k={};k[a.buzz.level_name]=!0;return k},getFeaturedImage:function(a){return(a=a.metadata.featuredImage)&&a.hash?{url:apiOptions.ipfs+a.hash}:a&&a.url?a:{}},getTags:function(a){a=a.metadata.tags;var b=[];a=a.slice(0,7);a.forEach(function(a){b.push('<a href="/search?page=1&query='+encodeURIComponent(a)+'">'+a+"</a>")});return b.join(", ")},getLinkedTags:function(a,b){var k=[];return a&&(a.forEach(function(a){k.push('<a href="/search?page=1&query='+encodeURIComponent(a)+'">'+
a+"</a>")}),b)?k.join(", "):k},hasPaid:function(a){var b=moment();a=toLocaleDate(a.cashout_time);return b.isAfter(a)},getPayoutPostDate:function(a){var b=toLocaleDate(a.cashout_time);this.hasPaid(a)&&(b=toLocaleDate(a.last_payout));return b.fromNow()},hasPromotion:function(a){return 0<Asset.parseString(a.promoted).amount},getPromotion:function(a){return"$ "+Asset.parseString(a.promoted).toPlainString()},parseJSON:function(a){if(a&&0<a.length)try{return JSON.parse(a)}catch(I){catchError(I)}return{}},
getPayout:function(a){var b=Asset.parseString(a.pending_payout_value);this.hasPaid(a)&&(b=Asset.parseString(a.total_payout_value),b=b.add(Asset.parseString(a.curator_payout_value)));return"$ "+b.toPlainString()},getPendingPayouts:function(a){var b=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"}),c=this.state.props.cbd_print_rate,d=Asset.parseString(a.pending_payout_value);a=a.percent_crea_dollars/2E4;a=
Asset.parse({amount:d.toFloat()*a,nai:"cbd"});d=Asset.parse({amount:NaNOr((d.toFloat()-a.toFloat())/b.toFloat(),0),nai:"cgy"});c=Asset.parse({amount:NaNOr(a.toFloat()*(c/1E4),0),nai:"cbd"});b=Asset.parse({amount:NaNOr((a.toFloat()-c.toFloat())/b.toFloat(),0),nai:"crea"});return"("+c.toFriendlyString(null,!1)+", "+b.toFriendlyString(null,!1)+", "+d.toFriendlyString(null,!1)},dateFromNow:function(a){return toLocaleDate(a).fromNow()},getFutureDate:function(a){return toLocaleDate(a).fromNow()},onFollow:function(a,
b){--u;updateUserSession()},onVote:function(a,b,c){catchError(a);var d=this;getDiscussion(c.author,c.permlink,function(a,b){a||(a=parsePost(b),d.state.content[a.link]=a,d.$forceUpdate())})},getLicense:function(a){return a?License.fromFlag(a):new License(LICENSE.FREE_CONTENT)},getCGYReward:function(){return parseFloat(this.state.user.reward_vesting_crea.split(" ")[0])+" CGY"},getCGYBalance:function(){return vestingCrea(this.state.user,this.state.props)},getDelegatedCGY:function(){return receivedDelegatedCGY(this.state.user,
this.state.props)},hasRewardBalance:function(){var a=Asset.parse(this.state.user.reward_crea_balance),b=Asset.parse(this.state.user.reward_cbd_balance),c=Asset.parse(this.state.user.reward_vesting_balance);return 0<a.amount||0<b.amount||0<c.amount},cancelPowerDown:function(a){cancelEventPropagation(a);var b=this.session.account.username;requireRoleKey(b,"active",function(a){globalLoading.show=!0;var c=new Vests(0);crea.broadcast.withdrawVesting(a,b,c.toFriendlyString(null,!1),function(a,b){globalLoading.show=
!1;catchError(a)||updateUserSession()})})},navigateTo:function(a,b){cancelEventPropagation(a);updateUrl("/@"+this.state.user.name+"/"+b);this.navbar.section=b},isUserProfile:function(){return this.session?this.session.account.username===a.user.name:!1},onLoadAvatar:function(a){a=a.target.files;if(0<a.length){globalLoading.show=!0;var b=this;a=a[0];var c=CONSTANTS.FILE_MAX_SIZE.PROFILE[a.type.toUpperCase().split("/")[0]];resizeImage(a,function(a){uploadToIpfs(a,c,function(a,c){globalLoading.show=!1;
catchError(a)||Vue.set(b.profile,"avatar",c)})})}},loadAvatar:function(a){cancelEventPropagation(a);$("#profile-edit-input-avatar").click()},suggestPassword:function(){this.changePass.newPass="P"+crea.formatter.createSuggestedPassword()},claimRewards:K,sendAccountUpdate:E,ignoreUser:function(a){function b(){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(){ignoreUser(this.state.user.name,!0,function(a,b){updateUserSession()})}),changePassword:function(){var a=
this,b=function(b){a.changePass.error=b;globalLoading.show=!1};this.changePass.oldPass?this.changePass.newPass&&this.changePass.newPass===this.changePass.matchedPass?this.changePass.checkedLostPass&&this.changePass.checkedStoredPass?Session.create(this.changePass.username,this.changePass.oldPass).login(function(c,d){c?c===Errors.USER_LOGIN_ERROR&&b(a.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD):(c=Account.generate(a.changePass.username,a.changePass.newPass,DEFAULT_ROLES).keys,E(null,c,function(a,
b){if(a=Session.getAlive())a.logout(),goTo("/")}))}):b(a.lang.CHANGE_PASSWORD.ERROR_CONDITIONS):b(a.lang.CHANGE_PASSWORD.ERROR_MATCHED_PASSWORDS):b(a.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD)}}});l.$forceUpdate();creaEvents.emit("crea.dom.ready")}function m(a,b,c){var f=a.replace("s","").replace("-","_"),d={rewards24Vests:0,rewardsWeekVests:0,totalRewardsVests:0,rewards24Crea:0,rewardsWeekCrea:0,totalRewardsCrea:0,rewards24CBD:0,rewardsWeekCBD:0,totalRewardsCBD:0},h=moment(),D=h.subtract(1,"day").valueOf(),
e=h.subtract(7,"days").valueOf(),q,k,g=[];c.user.transfer_history.sort(function(a,b){a=toLocaleDate(a[1].timestamp);return toLocaleDate(b[1].timestamp).valueOf()-a.valueOf()});c.user.transfer_history.forEach(function(a){if("author_reward"===a[1].op[0]&&"author_reward"===f){k||(k=toLocaleDate(a[1].timestamp).valueOf());q=toLocaleDate(a[1].timestamp).valueOf();var b=Asset.parseString(a[1].op[1].vesting_payout),c=Asset.parseString(a[1].op[1].crea_payout),h=Asset.parseString(a[1].op[1].cbd_payout);q>
e&&(q>D&&(d.rewards24Vests+=b.toFloat(),d.rewards24Crea+=c.toFloat(),d.rewards24CBD+=h.toFloat()),d.rewardsWeekVests+=b.toFloat(),d.rewardsWeekCrea+=c.toFloat(),d.rewardsWeekCBD+=h.toFloat());d.totalRewardsVests+=b.toFloat();d.totalRewardsCrea+=c.toFloat();d.totalRewardsCBD+=h.toFloat();g.push(a)}else"curation_reward"===a[1].op[0]&&"curation_reward"===f&&(k||(k=toLocaleDate(a[1].timestamp).valueOf()),q=toLocaleDate(a[1].timestamp).valueOf(),b=Asset.parseString(a[1].op[1].reward),q>e&&(q>D&&(d.rewards24Vests+=
b.toFloat()),d.rewardsWeekVests+=b.toFloat()),d.totalRewardsVests+=b.toFloat(),g.push(a))});v[a]?(v[a].session=b,v[a].state=c,v[a].rewards=d,v[a].rewardsOp=g):v[a]=new Vue({el:"#profile-"+a,data:{lang:lang,session:b,state:c,rewards:d,rewardsOp:g},methods:{vestsToCgy:function(a){function b(b){return a.apply(this,arguments)}b.toString=function(){return a.toString()};return b}(function(a){return vestsToCgy(this.state,a)}),parseAsset:Asset.parse,formatTime:function(a){return moment(a).format("DD MMM HH:MM")}}})}
function n(a,b,c){z?(z.session=a,z.account=b,z.blocked=c):z=new Vue({el:"#blocked-container",data:{lang:lang,session:a,account:b,blocked:c},methods:{unlock:function(a){ignoreUser(a,!1,function(a,b){catchError(a)||updateUserSession()})}}})}function r(a,b,c,p){w?(w.state=a,w.session=b,w.account=c,w.following=p):w=new Vue({el:"#following-container",data:{lang:lang,state:a,session:b,account:c,following:p},methods:{onFollow:function(){updateUserSession()}}})}function y(a,b,c,p){x?(x.state=a,x.session=
b,x.account=c,x.follower=p):x=new Vue({el:"#follower-container",data:{lang:lang,state:a,session:b,account:c,follower:p},methods:{onFollow:function(){updateUserSession()}}})}function L(a){var b=getPathPart().replace("@","");F(b,"transfers",function(b,f){catchError(b)||(m("author-rewards",a,f),m("curation-rewards",a,f))})}function M(a,b){a&&crea.api.getFollowing(a.account.username,"","ignore",1E3,function(c,f){if(!catchError(c)){var d=[];f=f.following;f.forEach(function(b){b.follower===a.account.username&&
(d.includes(b.following)||d.push(b.following))});d.length?crea.api.getAccounts(d,function(c,d){if(!catchError(c)){c={};for(var h=0;h<d.length;h++){var f=d[h];f.metadata=jsonify(f.json_metadata);c[f.name]=f}n(a,b,c)}}):(console.log("Not blockeds"),n(a,b,{}))}})}function N(a,b,c){var f=function(d){crea.api.getAccounts(d.user.followings,function(d,f){if(!catchError(d)){var h={};f.forEach(function(a){a.metadata=jsonify(a.json_metadata);a.metadata.avatar=a.metadata.avatar||{};h[a.name]=a});r(a,b,c,h)}})};
c&&a.user.name===c.user.name?f(c):crea.api.getFollowing(a.user.name,"","blog",1E3,function(b,c){if(!catchError(b)){var d=[];c.following.forEach(function(a){d.push(a.following)});a.user.followings=d;f(a)}})}function O(a,b,c){var f=function(d){crea.api.getAccounts(d.user.followers,function(d,f){if(!catchError(d)){var h={};f.forEach(function(a){a.metadata=jsonify(a.json_metadata);a.metadata.avatar=a.metadata.avatar||{};h[a.name]=a});y(a,b,c,h)}})};crea.api.getFollowers(a.user.name,"","blog",1E3,function(b,
c){if(!catchError(b)){var d=[];c.followers.forEach(function(a){d.push(a.follower)});a.user.followers=d;f(a)}})}function P(a,f,c,p){var d=getPathPart(null,1),h="balances";if(!d||d.isEmpty())d="projects";switch(d){case "balances":case "passwords":case "permissions":h=d,d="wallet"}d=d.toLowerCase();e(a,f,c,p,d,h);f&&f.account.username===a.user.name&&(g(a,f),b(a,f));Q(a.user.name);L(f);M(f,c);N(a,f,c);O(a,f,c)}function E(a,b,c){var f=toLocaleDate(l.state.user.last_account_update);if(moment().valueOf()-
f.valueOf()>=CONSTANTS.ACCOUNT.UPDATE_THRESHOLD){var d=Session.getAlive();if(d){var h=l.profile;h.tags=$("#profile-edit-tags").val().split(" ");h=jsonstring(h);b||(a=l.state.user,b={memo:{pub:a.memo_key},active:{pub:a.active.key_auths[0][0]},posting:{pub:a.posting.key_auths[0][0]},owner:{pub:a.owner.key_auths[0][0]}});console.log(b);requireRoleKey(d.account.username,"owner",function(a){globalLoading.show=!0;crea.broadcast.accountUpdate(a,d.account.username,createAuth(b.owner.pub),createAuth(b.active.pub),
createAuth(b.posting.pub),b.memo.pub,h,function(a,b){globalLoading.show=!1;a?c&&c(a):(updateUserSession(),c&&c(null,b))})})}else globalLoading.show=!1,c&&c(Errors.USER_NOT_LOGGED)}else a=lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.TITLE,f=String.format(lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.BODY,toLocaleDate(f).fromNow()),showAlert(a,f)}function Q(a){setTimeout(function(){crea.api.getAccountHistory(a,-1,50,function(a,b){if(!catchError(a)){b.history=b.history.reverse();var c=[],d=[];b.history.forEach(function(a){a=
a[1];var b=function(a){a&&0>c.indexOf(a)&&c.push(a)};"transfer_operation"===a.op.type?(b(a.op.value.from),b(a.op.value.to)):"transfer_to_vesting_operation"===a.op.type?(b(a.op.value.from),b(a.op.value.to)):"transfer_to_savings_operation"===a.op.type?(b(a.op.value.from),b(a.op.value.to)):"vote_operation"===a.op.type?(b(a.op.value.voter),b(a.op.value.author)):"comment_operation"===a.op.type?(b(a.op.value.parent_author),b(a.op.value.author)):"producer_reward_operation"===a.op.type?b(a.op.value.producer):
"account_create_operation"===a.op.type?b(a.op.value.creator):"curation_reward_operation"===a.op.type?(b(a.op.value.curator),b(a.op.value.comment_author)):"comment_download_operation"===a.op.type&&(b(a.op.value.downloader),b(a.op.value.comment_author));d.push(a)});crea.api.getAccounts(c,function(a,b){if(a)console.error(a);else{var f={};c.forEach(function(a){for(var c=0;c<b.length;c++)if(a===b[c].name){f[a]=parseAccount(b[c]);break}});l.history.data=d;l.history.accounts=f}})}})})}function F(a){var b=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;var e=a.startsWith("/@")?a:"/@"+a;b&&("string"===typeof b?e=e+"/"+b:"function"===typeof b&&(c=b));crea.api.getState(e,function(b,f){b?c&&c(b):(f.accounts[a]&&(f.user=parseAccount(f.accounts[a])),f.content={},f.discussion_idx={"":{profile:[]}},c&&c(b,f))})}function S(a,b){var c=getPathPart();(c=c.replace("@",""))&&F(c,function(f,d){catchError(f)||(console.log(clone(d)),G(function(f,
e){Object.keys(d.accounts).forEach(function(a){d.accounts[a]=parseAccount(d.accounts[a])});d.accounts[c]&&(d.user=d.accounts[c],crea.formatter.estimateAccountValue(d.user).then(function(a){d.user.estimate_account_value=a}));e.sort(function(a,b){a=toLocaleDate(a.created);return toLocaleDate(b.created).valueOf()-a.valueOf()});for(f=0;f<e.length;f++){var h=e[f],g=h.author+"/"+h.permlink;d.content[g]=h;d.discussion_idx[""].profile.push(g)}P(d,a,b,c)}))})}function K(a){a&&a.preventDefault();var b=l.state.user.reward_crea_balance,
c=l.state.user.reward_cbd_balance,e=l.state.user.reward_vesting_balance;requireRoleKey(l.session.account.username,"posting",function(a){globalLoading.show=!0;crea.broadcast.claimRewardBalance(a,l.session.account.username,b,c,e,function(a,b){globalLoading.show=!1;catchError(a)||updateUserSession()})})}function J(a,b,c,e,d,h,g){"function"===typeof h&&(g=h,h="");if(c)switch(c=c.account.username,b){case CONSTANTS.TRANSFER.TRANSFER_CREA:case CONSTANTS.TRANSFER.TRANSFER_CBD:crea.broadcast.transfer(a,c,
e,d,h,g);break;case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CBD:crea.broadcast.transferToSavings(a,c,e,d,h,g);break;case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CBD:crea.broadcast.transferFromSavings(a,c,parseInt(moment().valueOf()/1E3),e,d,h,g);break;case CONSTANTS.TRANSFER.TRANSFER_TO_VESTS:crea.broadcast.transferToVesting(a,c,e,d,g)}else g&&g(Errors.USER_NOT_LOGGED)}function H(a,b){var c=getPathPart(null,
1);c="settings"===c.toLowerCase();if(a){if(c&&(c=getPathPart(),"@"+a.account.username!==c)){showProfile(c);return}b.user.cgy_balance="0.000 "+apiOptions.symbol.CGY;a.account.username===b.user.name&&(B={op:"transfer_crea",title:lang.WALLET.TRANSFER_CREA_TITLE,text:lang.WALLET.TRANSFER_CREA_TEXT,button:lang.BUTTON.SEND,total_amount:Asset.parseString("0.000 CREA").toFriendlyString(),nai:apiOptions.symbol.CREA,confirmed:!1,to:null,disableTo:!1})}else if(c){a=getPathPart();showProfile(a);return}S(a,b)}
function G(a){u||(u=1);var b=new HttpClient(apiOptions.apiUrl+"/creary/blog");b.when("done",function(b){b=jsonify(b).data;var c=[],d=b.length,f=function(){--d;0>=d&&a&&a(null,c)};b.forEach(function(a){var b=a.author+"/"+a.permlink;crea.api.getContent(a.author,a.permlink,function(d,e){d||0>=e.author.length?console.error("Error getting",b,d):(d=parsePost(e),d.reblogged_by=a.reblogged_by,c.push(d));f()})});0===b.length?f():++u});b.when("fail",function(a,b,d){C=!1;catchError(b)});refreshAccessToken(function(a){b.headers=
{Authorization:"Bearer "+a};b.post({author:getPathPart().replace("@",""),page:u})})}var l,v={},z,w,x,t,A,B,u=1;creaEvents.on("crea.session.login",H);creaEvents.on("crea.session.update",function(a,b){--u;H(a,b)});var C;creaEvents.on("crea.scroll.bottom",function(){C||(C=!0,G(function(a,b){b.sort(function(a,b){a=toLocaleDate(a.created);return toLocaleDate(b.created).valueOf()-a.valueOf()});for(a=0;a<b.length;a++){var c=b[a],e=c.author+"/"+c.permlink;l.state.content[e]=c;l.state.discussion_idx[""].profile.push(e)}l.state.discussions=
l.state.discussion_idx[""].profile;l.$forceUpdate();C=!1;creaEvents.emit("navigation.state.update",l.state)}))})})();
