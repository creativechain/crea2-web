(function(){function c(a){console.log("Cookie session",a);a?CreaCookies.set("creary.username",a.account.username):CreaCookies.remove("creary.username");a=navigator.language.toLowerCase().split("-")[0];CreaCookies.set("creary.language",a)}window.addEventListener("load",function(a){console.log("Resources loaded");creaEvents.emit("crea.content.loaded")});document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded");creaEvents.emit("crea.content.prepare");var a=Session.getAlive();
a?a.login(function(b,e){if(b)console.error(b),b===Errors.USER_LOGIN_ERROR&&a.logout(),creaEvents.emit("crea.session.login",!1);else{var d=2,f=function(a,b){--d;0===d&&creaEvents.emit("crea.session.login",a,b)},c=[],g=[];crea.api.getFollowing(a.account.username,"","blog",1E3,function(b,d){catchError(b)||(d.following.forEach(function(a){c.push(a.following)}),e.user.followings=c,f(a,e))});crea.api.getFollowing(a.account.username,"","ignore",1E3,function(b,d){catchError(b)||(d.following.forEach(function(a){g.push(a.following)}),
e.user.blockeds=g,f(a,e))})}}):creaEvents.emit("crea.session.login",!1)});creaEvents.on("crea.session.login",function(a){globalLoading.show=!1;c(a)});creaEvents.on("crea.session.update",c);creaEvents.on("crea.session.logout",c);creaEvents.on("crea.modal.ready",function(a){setTimeout(function(){a&&($(".all-page-modals #modal-login").remove(),$(".all-page-modals #modal-login-d").remove());mr.modals.documentReady($)},500)});creaEvents.on("crea.dom.ready",function(){$.holdReady(!1);$(window).scroll(function(a){a=
$(document).height();var b=$(window).height()+$(window).scrollTop();.01>=(a-b)/a&&creaEvents.emit("crea.scroll.bottom")});$("input, textarea").each(function(a,b){var c=parseInt($(b).attr("maxlength"));$(b).keypress(function(a){var b=a.target.value.length;0<a.charCode&&b===c&&cancelEventPropagation(a)})});$('[data-toggle="popover"]').popover();creaEvents.emit("crea.modal.ready")})})();
