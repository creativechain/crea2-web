"use strict";(function(){var a;var h=new Vue({el:"#navbar-search",data:{lang:lang,search:null,page:1},methods:{reset:function g(){this.search=null;this.page=1},performSearch:function(l){function m(n){return l.apply(this,arguments)}m.toString=function(){return l.toString()};return m}(function(l){cancelEventPropagation(l);if(this.search){performSearch(this.search,this.page,isInHome())}})}});var f=new Vue({el:"#navbar-right-menu",data:{lang:lang}});function c(n,l){if(!a){a=new Vue({el:"#navbar-container",data:{lang:lang,session:n,user:l?l.user:{},nav:getPathPart(),loginForm:{xs:isSmallScreen(),username:{error:null,value:""},password:{error:null,value:""}}},mounted:function p(){this.applyRightMenuEvents($);$("#modal-login").parent().removeAttr("modal-attached")},methods:{applyRightMenuEvents:function o(q){},closeLogin:function m(){hideModal("#modal-login");hideModal("#modal-login-d")},logout:logout,login:function(r){function q(s){return r.apply(this,arguments)}q.toString=function(){return r.toString()};return q}(function(r){cancelEventPropagation(r);var q=this;if(!this.loginForm.username.error){login(this.loginForm.username.value,this.loginForm.password.value,function(s){console.log(s);if(s){console.error(s);if(s===Errors.USER_LOGIN_ERROR){q.loginForm.password.error=q.lang.ERROR[s].TITLE;console.error(q.lang.ERROR[s])}else{q.loginForm.password.error=q.lang.ERROR.UNKNOWN_ERROR;console.error(q.lang.ERROR[s])}}else{q.closeLogin()}})}}),isUserFeed:isUserFeed,checkUsername:k,goTo:goTo,getDefaultAvatar:R.getAvatar,retrieveNowContent:d,retrieveTrendingContent:e,retrieveHotContent:i,retrievePromotedContent:j}})}else{a.session=n;a.user=l?l.user:{}}}function k(m){var n=m.target;var o=n.value.toLowerCase();a.loginForm.username.value=o;if(!crea.utils.validateAccountName(o)){var l=[o];console.log("Checking",l);crea.api.lookupAccountNames(l,function(q,p){if(q){console.error(q);a.loginForm.username.error=lang.ERROR.INVALID_USERNAME}else{if(p[0]==null){a.loginForm.username.error=lang.ERROR.USERNAME_NOT_EXISTS}else{a.loginForm.username.error=null}}})}else{a.loginForm.username.error=lang.ERROR.INVALID_USERNAME}}function b(m,n){if(isInHome()){cancelEventPropagation(m)}var l=resolveFilter(n);updateUrl(n);currentPage.pathname=n;crea.api.getState(l,function(q,r){if(!catchError(q)){if(isUserFeed()){var p=new HttpClient(apiOptions.apiUrl+"/creary/feed");var o=function o(){r.content={};creaEvents.emit("crea.posts",n,l,r)};p.when("done",function(t){var v=jsonify(t).data;if(v.length){var u=v.length;var w=function w(){u--;if(u<=0){creaEvents.emit("crea.posts",n,l,r)}};r.content={};v.forEach(function(y){var x=y.author+"/"+y.permlink;if(!r.content[x]){crea.api.getContent(y.author,y.permlink,function(A,z){if(A){console.error("Error getting",x,A)}else{var B=parsePost(z);B.reblogged_by=y.reblogged_by;r.content[x]=B}w()})}})}else{o()}});p.when("fail",function(t,v,u){catchError(v)});var s=getPathPart().replace("/","").replace("@","");crea.api.getFollowing(s,"","blog",1000,function(v,t){if(!catchError(v)){var u=[];t.following.forEach(function(w){u.push(w.following)});if(u.length){u=u.join(",");refreshAccessToken(function(w){p.headers={Authorization:"Bearer "+w};p.post({following:u,reblogs:true,adult:a.user.metadata.adult_content})})}else{o()}}})}else{creaEvents.emit("crea.posts",n,l,r)}}})}function d(l){b(l,"/now")}function e(l){b(l,"/popular")}function i(l){b(l,"/skyrockets")}function j(l){b(l,"/promoted")}creaEvents.on("crea.posts",function(){a.nav=getPathPart()});creaEvents.on("crea.session.update",function(m,l){c(m,l)});creaEvents.on("crea.session.login",function(m,l){c(m,l)});creaEvents.on("crea.session.logout",function(){c(false,false);creaEvents.emit("crea.modal.ready",true)});creaEvents.on("crea.content.filter",function(l){if(!l.startsWith("/")){l="/"+l}b(null,l)})})();