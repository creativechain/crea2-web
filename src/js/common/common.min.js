var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var c=this;c instanceof String&&(c=String(c));var e=c.length;b=b||0;for(0>b&&(b=Math.max(b+e,0));b<e;b++){var f=c[b];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,c,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,c){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function a(b){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(b||"")+"_"+c++,b)}var c=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");var IpfsFile=function(a,c,b,d){this.hash=a;this.name=c;this.type=b;this.size=d;this.url="https://ipfs.creary.net/ipfs/"+a},creaEvents=new EventEmitter;moment.locale($("html").attr("lang"));
var bannerVue,globalLoading,currentPage,CONSTANTS={ACCOUNT:{UPDATE_THRESHOLD:36E5},TRANSFER:{TRANSFER_CREA:"transfer_crea",TRANSFER_CBD:"transfer_cbd",TRANSFER_TO_SAVINGS_CREA:"transfer_to_savings_crea",TRANSFER_TO_SAVINGS_CBD:"transfer_to_savings_cbd",TRANSFER_FROM_SAVINGS_CREA:"transfer_from_savings_crea",TRANSFER_FROM_SAVINGS_CBD:"transfer_from_savings_cbd",TRANSFER_TO_VESTS:"transfer_to_vests"},FILE_MAX_SIZE:{PROFILE:{IMAGE:512E3},POST_BODY:{AUDIO:104857600,VIDEO:209715200,IMAGE:5242880,GIF:10485760,
WEBP:10485760,DOWNLOAD:209715200},POST_PREVIEW:{IMAGE:512E3}},TEXT_MAX_SIZE:{PROFILE:{PUBLIC_NAME:21,ABOUT:144,CONTACT:55,WEB:55},TITLE:55,DESCRIPTION:233,COMMENT:233,TAG:21,PERMLINK:255},MAX_TAGS:8,BUZZ:{USER_BLOCK_THRESHOLD:-30,MAX_LOG_NUM:20,LEVELS:"novice trainee advanced expert influencer master guru genius".split(" ")},POST:{MAX_OTHER_PROJECTS:12,MAX_COMMENT_SHOWN:10,COMMENT_SHOW_INTERVAL:10}};creaEvents.on("crea.session.login",function(a,c){showBanner(!1===a)});
function showBanner(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;bannerVue&&(bannerVue.showBanner=a)}function goTo(a){window.location.href=a}function showPost(a){a.url||(a.url="/"+a.metadata.tags[0]+"/@"+a.author+"/"+a.permlink);goTo(a.url)}function showProfile(a){(a=a.match(/[\w\.\d-]+/gm))&&goTo("/@"+a)}function updateUrl(a,c,b){c?$("title").html(c):c="";window.history.pushState(b,c,a)}function toHome(a){a?-1<window.location.href.indexOf(a)&&goTo("/"):goTo("/")}
function resolveFilter(a){return a=a.toLowerCase()}function isInHome(){var a=Session.getAlive();return a&&isUserFeed(a.account.username)?!0:"/skyrockets /popular /now /popular30 /created /promoted /votes /actives /cashout /responses /payout /payout_comments".split(" ").includes(window.location.pathname)}function showModal(a){mr.modals.showModal(a)}function hideModal(a){mr.modals.hideModal(a)}
function createBlockchainAccount(a,c,b){var d=crea.auth.getPrivateKeys(a,c,DEFAULT_ROLES);refreshAccessToken(function(c){var e=new HttpClient(apiOptions.apiUrl+"/createCrearyAccount");e.when("done",function(a){a=jsonify(a);b&&b(null,a)});e.when("fail",function(a,c,d){b&&b(d)});e.headers={Authorization:"Bearer "+c};e.post({username:a,active:d.activePubkey,owner:d.ownerPubkey,posting:d.postingPubkey,memo:d.memoPubkey})})}
function removeBlockedContents(a,c,b){if(a){b=b?b:Object.keys(a.content);if(c){var d=[];b.forEach(function(b){var e=a.content[b];0>c.user.blockeds.indexOf(e.author)&&(e.adult_content?"hide"!==c.user.metadata.adult_content&&d.push(b):d.push(b))});return d}return b}return null}
function parseAccount(a){a&&(a=clone(a),a.buzz=crea.formatter.reputation(a.reputation,CONSTANTS.BUZZ.LEVELS.length,CONSTANTS.BUZZ.MAX_LOG_NUM),0>=a.buzz.level&&(a.buzz.level=1),a.buzz.level_name=CONSTANTS.BUZZ.LEVELS[a.buzz.level-1],a.buzz.level_title=lang.BUZZ[a.buzz.level-1],a.buzz.blocked=a.buzz.formatted<=CONSTANTS.BUZZ.USER_BLOCK_THRESHOLD,a.metadata=jsonify(a.json_metadata),a.metadata.avatar=a.buzz.blocked?{}:a.metadata.avatar||{},a.metadata.adult_content=a.metadata.adult_content||"warn",a.metadata.post_rewards=
a.metadata.post_rewards||"100",a.metadata.comment_rewards=a.metadata.comment_rewards||"50",a.metadata.lang=a.metadata.lang||getNavigatorLanguage(),a.metadata.web&&(a.metadata.web=a.metadata.web.replace("https://","").replace("http://","")));return a}
function parsePost(a,c){c&&Array.isArray(c)||(c=[]);if(a){a=clone(a);a.metadata=jsonify(a.json_metadata);a.metadata.tags=a.metadata.tags||[];a.link=a.author+"/"+a.permlink;a.url="/"+a.metadata.tags[0]+"/@"+a.link;a.body=isJSON(a.body)?jsonify(a.body):a.body;a.body=cleanArray(a.body);a.adult_content=a.metadata.adult||a.metadata.tags&&(a.metadata.tags.includes("nsfw")||a.metadata.tags.includes("adult")||a.metadata.tags.includes("nude")||a.metadata.tags.includes("porn"));a.down_votes=[];a.up_votes=[];
a.active_votes.forEach(function(b){0>b.percent?a.down_votes.push(b):0<b.percent&&a.up_votes.push(b)});var b=Session.getAlive();a.reported=!1;if(b){b=b.account.username;for(var d=0;d<a.down_votes.length;d++)if(a.down_votes[d].voter===b){a.reported=!0;break}}b=function(a){return"object"===typeof a?Asset.parse(a).toFriendlyString(null,!1):a};a.refused_payouts=0>=Asset.parse(a.max_accepted_payout).amount;a.curator_payout_value=b(a.curator_payout_value);a.max_accepted_payout=b(a.max_accepted_payout);a.pending_payout_value=
b(a.pending_payout_value);a.promoted=b(a.promoted);a.total_payout_value=b(a.total_payout_value);a.total_pending_value=b(a.total_pending_value);a.reblogged_by&&0!==a.reblogged_by.length||(a.reblogged_by=c)}return a}function getAccounts(a,c){crea.api.getAccounts(a,function(a,d){if(c)if(a)c(a);else{for(a=0;a<d.length;a++)d[a]=parseAccount(d[a]);c(null,d)}})}
function getDiscussion(a,c,b){"function"===typeof c?(b=c,c=$jscomp.makeIterator(/([\w\.\d-]+)\/([\w\d-]+)/gm.exec(a)),c.next(),a=c.next().value,c=c.next().value):a=/[\w\.\d-]+/gm.exec(a)[0];crea.api.getDiscussion(a,c,b)}
function recommendPost(a,c,b,d){var e=Session.getAlive();if(e){"function"===typeof b&&(d=b,b=!0);var f={account:e.account.username,author:a,permlink:c};f=[b?"reblog":"unreblog",f];requireRoleKey(e.account.username,"posting",function(a){crea.broadcast.customJson(a,[],[e.account.username],"follow",jsonstring(f),function(a,c){d&&(a?d(a):d(null,c))})})}}
function ignoreUser(a,c,b){var d=Session.getAlive();if(d){var e={follower:d.account.username,following:a,what:c?["ignore"]:[]};e=["follow",e];requireRoleKey(d.account.username,"posting",function(a){globalLoading.show=!0;crea.broadcast.customJson(a,[],[d.account.username],"follow",jsonstring(e),function(a,c){globalLoading.show=!1;b&&(a?b(a):b(null,c))})})}else b&&b(Errors.USER_NOT_LOGGED)}
function makeComment(a,c,b,d){var e=Session.getAlive();e&&0<a.length&&requireRoleKey(e.account.username,"posting",function(f){globalLoading.show=!0;var h=c?c.parent_author:b.author,k=c?c.parent_permlink:b.permlink,l=[];if(c){var g=c.permlink;l.push(c.metadata.tags[0])}else g=b.parent_author?uniqueId():toPermalink(crea.formatter.commentPermlink(h,k)),l.push(b.metadata.tags[0]);g.length>CONSTANTS.TEXT_MAX_SIZE.PERMLINK&&(g=g.substring(0,CONSTANTS.TEXT_MAX_SIZE.PERMLINK));console.log(g.length,k.length);
crea.broadcast.comment(f,h,k,e.account.username,g,"",a,"",jsonstring({tags:l}),d)})}function deleteComment(a,c,b){c&&a&&a.author===c.account.username&&requireRoleKey(c.account.username,"posting",function(c){globalLoading.show=!0;crea.broadcast.deleteComment(c,a.author,a.permlink,b)})}
function editComment(a,c,b,d){b&&c&&requireRoleKey(b.account.username,"posting",function(b){globalLoading.show=!0;crea.broadcast.comment(b,c.parent_author,c.parent_permlink,c.author,c.permlink,c.title,a,c.json_metadata,d)})}
function makeDownload(a,c,b,d,e){cancelEventPropagation(a);c?requireRoleKey(c.account.username,"active",function(a){globalLoading.show=!0;var f=function(){setTimeout(function(){var b=Buffer.from(d.author),f=Buffer.from(d.permlink);b=Buffer.concat([b,f]);b=crea.utils.Signature.signBuffer(b,a).toBuffer().toString("base64");crea.api.getDownload(c.account.username,d.author,d.permlink,b,function(a,b){globalLoading.show=!1;catchError(a)||(a=/Qm[a-zA-Z0-9]+/.exec(b.resource)[0],console.log(a),d.download.type||
(d.download.type="application/octet-stream"),a=apiOptions.ipfsd+"/"+d.download.type+"/"+a+"/"+d.download.name,a+="?stream=false",hideModal("#modal-download"),e?(console.log("Callback is present"),e()):console.log("Callback null?",e),downloadFile(a,d.download.name))})},3E3)},k=function(){crea.broadcast.commentDownload(a,c.account.username,d.author,d.permlink,function(a,b){catchError(a)?globalLoading.show=!1:f()})};d.download.downloaders.includes(b.name)?f():k()}):console.log("NO session",c)}
function updateUserSession(){var a=Session.getAlive();a?a.login(function(c,b){if(!catchError(c)){var d=2,e=function(a,b){--d;0===d&&creaEvents.emit("crea.session.update",a,b)},f=[],h=[];crea.api.getFollowing(a.account.username,"","blog",1E3,function(c,d){catchError(c)||(d.following.forEach(function(a){f.push(a.following)}),b.user.followings=f,e(a,b))});crea.api.getFollowing(a.account.username,"","ignore",1E3,function(c,d){catchError(c)||(d.following.forEach(function(a){h.push(a.following)}),b.user.blockeds=
h,e(a,b))})}}):creaEvents.emit("crea.session.update",!1)}
function refreshAccessToken(a){var c=(new Date).getTime(),b=localStorage.getItem(CREARY.ACCESS_TOKEN_EXPIRATION);b=isNaN(b)?0:b;b<=c?(c=new HttpClient(apiOptions.apiUrl+"/oauth/v2/token"),c.when("done",function(b){b=JSON.parse(b);localStorage.setItem(CREARY.ACCESS_TOKEN,b.access_token);localStorage.setItem(CREARY.ACCESS_TOKEN_EXPIRATION,(new Date).getTime()+1E3*b.expires_in);a&&a(b.access_token)}),c.post({grant_type:"client_credentials",client_id:"1_2e5ws1sr915wk0o4kksc0swwoc8kc4wgkgcksscgkkko404g8c",client_secret:"3c2x9uf9uwg0ook0kksk8koccsk44w0gg4csos04ows444ko4k"})):
a&&(c=localStorage.getItem(CREARY.ACCESS_TOKEN),a(c))}
function resizeImage(a,c){console.log(a);if("image/png"===a.type||"image/jpg"===a.type||"image/jpeg"===a.type){var b=new FileReader;b.onload=function(b){var d=new Image;d.onload=function(){var b;d.width<=d.height&&500<d.width?b={maxWidth:500,maxHeight:Infinity}:d.height<=d.width&&500<d.height&&(b={maxWidth:Infinity,maxHeight:500});b?(b.quality=.8,b.success=function(a){console.log(a);c&&c(a)},new Compressor(a,b)):c&&c(a)};d.src=b.target.result};b.readAsDataURL(a)}else c&&c(a)}
function uploadToIpfs(a,c,b){if(window.File&&window.FileReader&&window.FileList&&window.Blob)if(c)if(a.size<=c){var d=function(c,d){c?b&&b(c):(console.log(d),c=new IpfsFile(d.Hash,a.name,a.type,d.Size),console.log(c),b(null,c))};c=new HttpClient("https://ipfs.creary.net:5002/api/v0/add?pin=true&stream-channels=true");c.post({file:a}).when("done",function(a){d(null,jsonify(a))});c.when("fail",function(a,b,c){d(c,null)})}else globalLoading.show=!1,console.error("File",a.name,"too large. Size:",a.size,
"MAX:",c),b&&b(lang.PUBLISH.FILE_TOO_LARGE);else b&&b(lang.PUBLISH.FILE_FORMAT_NOT_ALLOWED);else globalLoading.show=!1}function downloadFile(a,c){var b=document.createElement("a");b.setAttribute("href",a);b.setAttribute("download",c);b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)}
function performSearch(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,b=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,d=3<arguments.length?arguments[3]:void 0,e="/search?query="+encodeURIComponent(a)+"&page="+c;b?(updateUrl(e),refreshAccessToken(function(b){var e=new HttpClient(apiOptions.apiUrl+"/searchCreaContent");e.setHeaders({Authorization:"Bearer "+b});e.when("done",function(a){a=jsonify(a).data;for(var b=0;b<a.length;b++)a[b].tags=jsonify(a[b].tags);creaEvents.emit("crea.search.content",
a);d&&d()});e.when("fail",function(a,b,c){console.error(a,b,c);catchError(c)});e.get({search:a,page:c})})):goTo(e)}
function catchError(a){if(a){var c=[];if(a.stack)console.trace(a.stack);else{console.error(a);switch(a){case 1:case 2:a=lang.ERROR[a]}console.log(a)}if("string"===typeof a)var b=a;else{a.name?b=name:a.TITLE&&(b=a.TITLE);if(a.message){var d=a.message.split(":");d=d[d.length-1];console.error(d);" Account does not have enough flow to vote."===d||d.includes("RC. Please wait to transact, or energize CREA.")?(b=lang.ERROR.INSUFFICIENT_RC.TITLE,c=lang.ERROR.INSUFFICIENT_RC.BODY,console.log(c)):c.push(d)}a.BODY&&
(c=a.BODY)}showAlert(b,c);return!0}return!1}function showAlert(a,c){a={title:a,body:"string"===typeof c?[c]:c};console.log(a);creaEvents.emit("crea.alert",a)}
function requireRoleKey(a,c,b,d){"function"===typeof b&&(d=b,b=!1);console.log(a,c,null!=d);if(d){var e=randomNumber(0,Number.MAX_SAFE_INTEGER),f=Session.getAlive();f&&f.account.keys[c]?d(f.account.keys[c].prv,f.account.username):(creaEvents.on("crea.auth.role."+e,function(a,b){d&&d(a,b);creaEvents.off("crea.auth.role."+e)}),creaEvents.emit("crea.auth.role",a,c,b,e))}}
creaEvents.on("crea.content.prepare",function(){globalLoading=new Vue({el:"#global-loading",data:{show:!0}});null!==document.getElementById("home-banner")&&(bannerVue=new Vue({el:"#home-banner",data:{showBanner:!1,lang:lang}}))});
