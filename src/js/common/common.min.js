var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=b[c];if(f===a||Object.is(f,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Number.MAX_SAFE_INTEGER",function(){return 9007199254740991},"es6","es3");function _typeof(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return _typeof(a)}
function _instanceof(a,b){$jscomp.initSymbol();$jscomp.initSymbol();return null!=b&&"undefined"!==typeof Symbol&&b[Symbol.hasInstance]?($jscomp.initSymbol(),b[Symbol.hasInstance](a)):a instanceof b}function _classCallCheck(a,b){if(!_instanceof(a,b))throw new TypeError("Cannot call a class as a function");}var IpfsFile=function IpfsFile(a,b,c,d){_classCallCheck(this,IpfsFile);this.hash=a;this.name=b;this.type=c;this.size=d;this.url="https://ipfs.creary.net/ipfs/"+a},creaEvents=new EventEmitter;moment.locale($("html").attr("lang"));
var bannerVue,globalLoading,currentPage,CONSTANTS={ACCOUNT:{UPDATE_THRESHOLD:36E5},TRANSFER:{TRANSFER_CREA:"transfer_crea",TRANSFER_CBD:"transfer_cbd",TRANSFER_TO_SAVINGS_CREA:"transfer_to_savings_crea",TRANSFER_TO_SAVINGS_CBD:"transfer_to_savings_cbd",TRANSFER_FROM_SAVINGS_CREA:"transfer_from_savings_crea",TRANSFER_FROM_SAVINGS_CBD:"transfer_from_savings_cbd",TRANSFER_TO_VESTS:"transfer_to_vests"},FILE_MAX_SIZE:{PROFILE:{IMAGE:512E3},POST_BODY:{AUDIO:104857600,VIDEO:209715200,IMAGE:5242880,GIF:10485760,
DOWNLOAD:209715200},POST_PREVIEW:{IMAGE:512E3}},TEXT_MAX_SIZE:{PROFILE:{PUBLIC_NAME:21,ABOUT:144,CONTACT:55,WEB:55},TITLE:55,DESCRIPTION:233,COMMENT:233,TAG:21,PERMLINK:255},MAX_TAGS:8,BUZZ:{USER_BLOCK_THRESHOLD:-30,MAX_LOG_NUM:20,LEVELS:"novice trainee advanced expert influencer master guru genius".split(" ")},POST:{MAX_OTHER_PROJECTS:12,MAX_COMMENT_SHOWN:10,COMMENT_SHOW_INTERVAL:10}};creaEvents.on("crea.session.login",function(a,b){showBanner(!1===a)});
function showBanner(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0;bannerVue&&(bannerVue.showBanner=a)}function goTo(a){window.location.href=a}function showPost(a){a.url||(a.url="/"+a.metadata.tags[0]+"/@"+a.author+"/"+a.permlink);goTo(a.url)}function showProfile(a){(a=a.match(/[\w\.\d-]+/gm))&&goTo("/@"+a)}function updateUrl(a,b,c){b?$("title").html(b):b="";window.history.pushState(c,b,a)}function toHome(a){a?-1<window.location.href.indexOf(a)&&goTo("/"):goTo("/")}
function resolveFilter(a){return a=a.toLowerCase()}function isInHome(){var a=Session.getAlive();return a&&isUserFeed(a.account.username)?!0:"/skyrockets /popular /now /popular30 /created /promoted /votes /actives /cashout /responses /payout /payout_comments".split(" ").includes(window.location.pathname)}function showModal(a){mr.modals.showModal(a)}function hideModal(a){mr.modals.hideModal(a)}
function createBlockchainAccount(a,b,c){var d=crea.auth.getPrivateKeys(a,b,DEFAULT_ROLES);refreshAccessToken(function(b){var e=new HttpClient(apiOptions.apiUrl+"/createCrearyAccount");e.when("done",function(a){a=jsonify(a);c&&c(null,a)});e.when("fail",function(a,b,d){c&&c(d)});e.headers={Authorization:"Bearer "+b};e.post({username:a,active:d.activePubkey,owner:d.ownerPubkey,posting:d.postingPubkey,memo:d.memoPubkey})})}
function removeBlockedContents(a,b,c){if(a){c=c?c:Object.keys(a.content);if(b){var d=[];c.forEach(function(c){var e=a.content[c];0>b.user.blockeds.indexOf(e.author)&&(e.adult_content?"hide"!==b.user.metadata.adult_content&&d.push(c):d.push(c))});return d}return c}return null}
function parseAccount(a){a&&(a=clone(a),a.buzz=crea.formatter.reputation(a.reputation,CONSTANTS.BUZZ.LEVELS.length,CONSTANTS.BUZZ.MAX_LOG_NUM),0>=a.buzz.level&&(a.buzz.level=1),a.buzz.level_name=CONSTANTS.BUZZ.LEVELS[a.buzz.level-1],a.buzz.level_title=lang.BUZZ[a.buzz.level-1],a.buzz.blocked=a.buzz.formatted<=CONSTANTS.BUZZ.USER_BLOCK_THRESHOLD,a.metadata=jsonify(a.json_metadata),a.metadata.avatar=a.buzz.blocked?{}:a.metadata.avatar||{},a.metadata.adult_content=a.metadata.adult_content||"warn",a.metadata.post_rewards=
a.metadata.post_rewards||"100",a.metadata.comment_rewards=a.metadata.comment_rewards||"50",a.metadata.lang=a.metadata.lang||getNavigatorLanguage(),a.metadata.web&&(a.metadata.web=a.metadata.web.replace("https://","").replace("http://","")));return a}
function parsePost(a,b){b&&Array.isArray(b)||(b=[]);if(a){a=clone(a);a.metadata=jsonify(a.json_metadata);a.metadata.tags=a.metadata.tags||[];a.link=a.author+"/"+a.permlink;a.url="/"+a.metadata.tags[0]+"/@"+a.link;a.body=isJSON(a.body)?jsonify(a.body):a.body;a.body=cleanArray(a.body);a.adult_content=a.metadata.adult||a.metadata.tags&&(a.metadata.tags.includes("nsfw")||a.metadata.tags.includes("adult")||a.metadata.tags.includes("nude")||a.metadata.tags.includes("porn"));a.down_votes=[];a.up_votes=[];
a.active_votes.forEach(function(b){0>b.percent?a.down_votes.push(b):0<b.percent&&a.up_votes.push(b)});var c=Session.getAlive();a.reported=!1;if(c){c=c.account.username;for(var d=0;d<a.down_votes.length;d++)if(a.down_votes[d].voter===c){a.reported=!0;break}}c=function(a){return"object"===_typeof(a)?Asset.parse(a).toFriendlyString(null,!1):a};a.refused_payouts=0>=Asset.parse(a.max_accepted_payout).amount;a.curator_payout_value=c(a.curator_payout_value);a.max_accepted_payout=c(a.max_accepted_payout);
a.pending_payout_value=c(a.pending_payout_value);a.promoted=c(a.promoted);a.total_payout_value=c(a.total_payout_value);a.total_pending_value=c(a.total_pending_value);a.reblogged_by&&0!==a.reblogged_by.length||(a.reblogged_by=b)}return a}function getAccounts(a,b){crea.api.getAccounts(a,function(a,d){if(b)if(a)b(a);else{for(a=0;a<d.length;a++)d[a]=parseAccount(d[a]);b(null,d)}})}
function getDiscussion(a,b,c){"function"===typeof b?(c=b,b=$jscomp.makeIterator(/([\w\.\d-]+)\/([\w\d-]+)/gm.exec(a)),b.next(),a=b.next().value,b=b.next().value):a=/[\w\.\d-]+/gm.exec(a)[0];crea.api.getDiscussion(a,b,c)}
function recommendPost(a,b,c,d){var e=Session.getAlive();if(e){"function"===typeof c&&(d=c,c=!0);var f={account:e.account.username,author:a,permlink:b};f=[c?"reblog":"unreblog",f];requireRoleKey(e.account.username,"posting",function(a){crea.broadcast.customJson(a,[],[e.account.username],"follow",jsonstring(f),function(a,b){d&&(a?d(a):d(null,b))})})}}
function ignoreUser(a,b,c){var d=Session.getAlive();if(d){var e={follower:d.account.username,following:a,what:b?["ignore"]:[]};e=["follow",e];requireRoleKey(d.account.username,"posting",function(a){globalLoading.show=!0;crea.broadcast.customJson(a,[],[d.account.username],"follow",jsonstring(e),function(a,b){globalLoading.show=!1;c&&(a?c(a):c(null,b))})})}else c&&c(Errors.USER_NOT_LOGGED)}
function makeComment(a,b,c,d){var e=Session.getAlive();e&&0<a.length&&requireRoleKey(e.account.username,"posting",function(f){globalLoading.show=!0;var h=b?b.parent_author:c.author,k=b?b.parent_permlink:c.permlink,l=[];if(b){var g=b.permlink;l.push(b.metadata.tags[0])}else g=c.parent_author?uniqueId():toPermalink(crea.formatter.commentPermlink(h,k)),l.push(c.metadata.tags[0]);g.length>CONSTANTS.TEXT_MAX_SIZE.PERMLINK&&(g=g.substring(0,CONSTANTS.TEXT_MAX_SIZE.PERMLINK));console.log(g.length,k.length);
crea.broadcast.comment(f,h,k,e.account.username,g,"",a,"",jsonstring({tags:l}),d)})}function deleteComment(a,b,c){b&&a&&a.author===b.account.username&&requireRoleKey(b.account.username,"posting",function(b){globalLoading.show=!0;crea.broadcast.deleteComment(b,a.author,a.permlink,c)})}
function editComment(a,b,c,d){c&&b&&requireRoleKey(c.account.username,"posting",function(c){globalLoading.show=!0;crea.broadcast.comment(c,b.parent_author,b.parent_permlink,b.author,b.permlink,b.title,a,b.json_metadata,d)})}
function makeDownload(a,b,c,d,e){cancelEventPropagation(a);b?requireRoleKey(b.account.username,"active",function(a){globalLoading.show=!0;var f=function(){setTimeout(function(){var c=Buffer.from(d.author),f=Buffer.from(d.permlink);c=Buffer.concat([c,f]);c=crea.utils.Signature.signBuffer(c,a).toBuffer().toString("base64");crea.api.getDownload(b.account.username,d.author,d.permlink,c,function(a,b){globalLoading.show=!1;catchError(a)||(a=/Qm[a-zA-Z0-9]+/.exec(b.resource)[0],console.log(a),d.download.type||
(d.download.type="application/octet-stream"),a=apiOptions.ipfsd+"/"+d.download.type+"/"+a+"/"+d.download.name,a+="?stream=false",hideModal("#modal-download"),e?(console.log("Callback is present"),e()):console.log("Callback null?",e),downloadFile(a,d.download.name))})},3E3)},k=function(){crea.broadcast.commentDownload(a,b.account.username,d.author,d.permlink,function(a,b){catchError(a)?globalLoading.show=!1:f()})};d.download.downloaders.includes(c.name)?f():k()}):console.log("NO session",b)}
function updateUserSession(){var a=Session.getAlive();a?a.login(function(b,c){if(!catchError(b)){var d=2,e=function(a,b){--d;0===d&&creaEvents.emit("crea.session.update",a,b)},f=[],h=[];crea.api.getFollowing(a.account.username,"","blog",1E3,function(b,d){catchError(b)||(d.following.forEach(function(a){f.push(a.following)}),c.user.followings=f,e(a,c))});crea.api.getFollowing(a.account.username,"","ignore",1E3,function(b,d){catchError(b)||(d.following.forEach(function(a){h.push(a.following)}),c.user.blockeds=
h,e(a,c))})}}):creaEvents.emit("crea.session.update",!1)}
function refreshAccessToken(a){var b=(new Date).getTime(),c=localStorage.getItem(CREARY.ACCESS_TOKEN_EXPIRATION);c=isNaN(c)?0:c;c<=b?(b=new HttpClient(apiOptions.apiUrl+"/oauth/v2/token"),b.when("done",function(b){b=JSON.parse(b);localStorage.setItem(CREARY.ACCESS_TOKEN,b.access_token);localStorage.setItem(CREARY.ACCESS_TOKEN_EXPIRATION,(new Date).getTime()+1E3*b.expires_in);a&&a(b.access_token)}),b.post({grant_type:"client_credentials",client_id:"1_2e5ws1sr915wk0o4kksc0swwoc8kc4wgkgcksscgkkko404g8c",client_secret:"3c2x9uf9uwg0ook0kksk8koccsk44w0gg4csos04ows444ko4k"})):
a&&(b=localStorage.getItem(CREARY.ACCESS_TOKEN),a(b))}
function resizeImage(a,b){console.log(a);if("image/png"===a.type||"image/jpg"===a.type||"image/jpeg"===a.type){var c=new FileReader;c.onload=function(c){var d=new Image;d.onload=function(){var c;d.width<=d.height&&500<d.width?c={maxWidth:500,maxHeight:Infinity}:d.height<=d.width&&500<d.height&&(c={maxWidth:Infinity,maxHeight:500});c?(c.quality=.8,c.success=function(a){console.log(a);b&&b(a)},new Compressor(a,c)):b&&b(a)};d.src=c.target.result};c.readAsDataURL(a)}else b&&b(a)}
function uploadToIpfs(a,b,c){if(window.File&&window.FileReader&&window.FileList&&window.Blob)if(b)if(a.size<=b){var d=function(b,d){b?c&&c(b):(console.log(d),b=new IpfsFile(d.Hash,a.name,a.type,d.Size),console.log(b),c(null,b))};b=new HttpClient("https://ipfs.creary.net:5002/api/v0/add?pin=true&stream-channels=true");b.post({file:a}).when("done",function(a){d(null,jsonify(a))});b.when("fail",function(a,b,c){d(c,null)})}else globalLoading.show=!1,console.error("File",a.name,"too large. Size:",a.size,
"MAX:",b),c&&c(lang.PUBLISH.FILE_TOO_LARGE);else c&&c(lang.PUBLISH.FILE_FORMAT_NOT_ALLOWED);else globalLoading.show=!1}function downloadFile(a,b){var c=document.createElement("a");c.setAttribute("href",a);c.setAttribute("download",b);c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c)}
function performSearch(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!1,d=3<arguments.length?arguments[3]:void 0,e="/search?query="+encodeURIComponent(a)+"&page="+b;c?(updateUrl(e),refreshAccessToken(function(c){var e=new HttpClient(apiOptions.apiUrl+"/searchCreaContent");e.setHeaders({Authorization:"Bearer "+c});e.when("done",function(a){a=jsonify(a).data;for(var b=0;b<a.length;b++)a[b].tags=jsonify(a[b].tags);creaEvents.emit("crea.search.content",
a);d&&d()});e.when("fail",function(a,b,c){console.error(a,b,c);catchError(c)});e.get({search:a,page:b})})):goTo(e)}
function catchError(a){if(a){var b=[];if(a.stack)console.trace(a.stack);else{console.error(a);switch(a){case 1:case 2:a=lang.ERROR[a]}console.log(a)}if("string"===typeof a)var c=a;else{a.name?c=name:a.TITLE&&(c=a.TITLE);if(a.message){var d=a.message.split(":");d=d[d.length-1];console.error(d);" Account does not have enough flow to vote."===d||d.includes("RC. Please wait to transact, or energize CREA.")?(c=lang.ERROR.INSUFFICIENT_RC.TITLE,b=lang.ERROR.INSUFFICIENT_RC.BODY,console.log(b)):b.push(d)}a.BODY&&
(b=a.BODY)}showAlert(c,b);return!0}return!1}function showAlert(a,b){a={title:a,body:"string"===typeof b?[b]:b};console.log(a);creaEvents.emit("crea.alert",a)}
function requireRoleKey(a,b,c,d){"function"===typeof c&&(d=c,c=!1);console.log(a,b,null!=d);if(d){var e=randomNumber(0,Number.MAX_SAFE_INTEGER),f=Session.getAlive();f&&f.account.keys[b]?d(f.account.keys[b].prv,f.account.username):(creaEvents.on("crea.auth.role."+e,function(a,b){d&&d(a,b);creaEvents.off("crea.auth.role."+e)}),creaEvents.emit("crea.auth.role",a,b,c,e))}}
creaEvents.on("crea.content.prepare",function(){globalLoading=new Vue({el:"#global-loading",data:{show:!0}});null!==document.getElementById("home-banner")&&(bannerVue=new Vue({el:"#home-banner",data:{showBanner:!1,lang:lang}}))});
