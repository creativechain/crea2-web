var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var e=0;return function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,a){b!=Array.prototype&&b!=Object.prototype&&(b[e]=a.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(b,e){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function b(a){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(a||"")+"_"+e++,a)}var e=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var a=0,d={next:function(){if(a<b.length){var h=a++;return{value:e(h,b[h]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(b,e,a,d){if(e){a=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var h=b[d];h in a||(a[h]={});a=a[h]}b=b[b.length-1];d=a[b];e=e(d);e!=d&&null!=e&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.checkStringArgs=function(b,e,a){if(null==b)throw new TypeError("The 'this' value for String.prototype."+a+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+a+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,a){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,m=b.length;a=Math.max(0,Math.min(a|0,d.length));for(var n=0;n<m&&a<e;)if(d[a++]!=b[n++])return!1;return n>=m}},"es6","es3");$jscomp.polyfill("Object.is",function(b){return b?b:function(b,a){return b===a?0!==b||1/b===1/a:b!==b&&a!==a}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(b){return b?b:function(b,a){var d=this;d instanceof String&&(d=String(d));var e=d.length;a=a||0;for(0>a&&(a=Math.max(a+e,0));a<e;a++){var m=d[a];if(m===b||Object.is(m,b))return!0}return!1}},"es7","es3");$jscomp.polyfill("String.prototype.includes",function(b){return b?b:function(b,a){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,a||0)}},"es6","es3");
(function(){function b(b,l,c){console.log(b,l,c);for(var k=c.content,e=c.accounts,q=Object.keys(k),p=[],g=0;g<q.length;g++){var f=q[g];k[f].parent_author||(k[f].metadata=jsonify(k[f].json_metadata),p.push(f))}c.content=k;Object.keys(e).forEach(function(a){e[a]=parseAccount(e[a])});c.accounts=e;l.startsWith("/")&&(l=l.substring(1));g=resolveFilter("/"+getPathPart()).replace("/","");f=getPathPart(null,1)||"";isUserFeed(getPathPart())&&!c.discussion_idx[f]?(q=p,q.sort(function(a,b){a=toLocaleDate(k[a].created);
return toLocaleDate(k[b].created).valueOf()-a.valueOf()}),c.discussion_idx[f]={},c.discussion_idx[f][g]=q,d=d?d:1):"/search"===window.location.pathname?d=getParameterByName("page")||1:(q=c.discussion_idx[f][g],d=c.content[q[q.length-1]]);c.discussion_idx[f][g]=removeBlockedContents(c,m,c.discussion_idx[f][g]);a?(a.session=h,a.account=m,a.filter=l,a.category=g,a.discuss=f,a.state=c,a.urlFilter=b,a.search=getParameterByName("query")):a=new Vue({el:"#home-posts",data:{session:h,account:m,filter:l,category:g,
discuss:f,urlFilter:b,state:c,search:getParameterByName("query"),simpleView:!1,lang:lang},updated:function(){mr.masonry&&(mr.masonry.windowLoad(),mr.masonry.updateLayout())},methods:{isFeed:function(){return isUserFeed()},getDefaultAvatar:R.getAvatar,toggleSimpleView:function(){this.simpleView=!this.simpleView;console.log("SimpleView",this.simpleView)},onFollow:function(a,b){updateUserSession()},openPost:function(a,b){cancelEventPropagation(b);creaEvents.emit("navigation.post.data",a,this.state,this.discuss,
this.category);showModal("#modal-post")},parseAsset:function(a){return Asset.parse(a).toFriendlyString()},getBuzzClass:function(a){var b={};b[a.buzz.level_name]=!0;return b},getFeaturedImage:function(a){return(a=!this.account&&a.adult_content||this.account&&"warn"===this.account.user.metadata.adult_content&&a.adult_content?{url:R.IMG.POST.NSFW}:a.metadata.featuredImage)&&a.hash?{url:apiOptions.ipfs+a.hash}:a&&a.url?a:{}},getTags:function(a){a=a.metadata.tags;var b=[];a=a.slice(0,7);a.forEach(function(a){b.push('<a href="/search?page=1&query='+
encodeURIComponent(a)+'">'+a+"</a>")});return b.join(", ")},getFutureDate:function(a){return toLocaleDate(a).fromNow()},hasPaid:function(a){var b=moment();a=toLocaleDate(a.cashout_time);return b.isAfter(a)},getPayoutPostDate:function(a){var b=toLocaleDate(a.cashout_time);this.hasPaid(a)&&(b=toLocaleDate(a.last_payout));return b.fromNow()},hasPromotion:function(a){return 0<Asset.parseString(a.promoted).amount},getPromotion:function(a){return"$ "+Asset.parseString(a.promoted).toPlainString()},getPayout:function(a){var b=
Asset.parseString(a.pending_payout_value);this.hasPaid(a)&&(b=Asset.parseString(a.total_payout_value),b=b.add(Asset.parseString(a.curator_payout_value)));return"$ "+b.toPlainString()},getPendingPayouts:function(a,b){b=b?b.toLowerCase():"";var f=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"}),c=this.state.props.cbd_print_rate,d=Asset.parse(a.pending_payout_value);a=a.percent_crea_dollars/2E4;a=Asset.parse({amount:d.toFloat()*
a,nai:"cbd"});d=Asset.parse({amount:NaNOr((d.toFloat()-a.toFloat())/f.toFloat(),0),nai:"cgy"});c=Asset.parse({amount:NaNOr(a.toFloat()*(c/1E4),0),nai:"cbd"});f=Asset.parse({amount:NaNOr((a.toFloat()-c.toFloat())/f.toFloat(),0),nai:"crea"});switch(b){case "cgy":return d.toFriendlyString(null,!1);case "cbd":return c.toFriendlyString(null,!1);case "crea":return f.toFriendlyString(null,!1);default:return"("+c.toFriendlyString(null,!1)+", "+f.toFriendlyString(null,!1)+", "+d.toFriendlyString(null,!1)+
")"}},parseJSON:function(a){if(a&&0<a.length)try{return JSON.parse(a)}catch(r){catchError(r)}return{}},onVote:function(a,b,f){catchError(a);var c=this;getDiscussion(f.author,f.permlink,function(a,b){a||(a=parsePost(b,f.reblogged_by),c.state.content[a.link]=a,c.$forceUpdate())})},getLicense:function(a){return a?License.fromFlag(a):new License(LICENSE.FREE_CONTENT)}}});a.$forceUpdate();creaEvents.emit("crea.dom.ready")}function e(a){var b=currentPage?currentPage.pathname:window.location.pathname;"/"===
b?h?(a=a?a:"/@"+h.account.username+"/feed",creaEvents.emit("crea.content.filter",a)):creaEvents.emit("crea.content.filter","/popular"):isUserFeed(getPathPart())?h?getPathPart()!=="@"+h.account.username?showProfile(getPathPart()):creaEvents.emit("crea.content.filter",b):showProfile(getPathPart()):b.startsWith("/search")?(a=getParameterByName("query"),b=getParameterByName("page")||1,performSearch(a,b,!0)):creaEvents.emit("crea.content.filter",b)}var a,d,h,m;creaEvents.on("crea.posts",function(d,e,c){var k=
[],l;for(l in c.content){var q=c.content[l].author;k.includes(q)||k.push(q);c.content[l]=parsePost(c.content[l])}if(isUserFeed(getPathPart()))getAccounts(k,function(f,g){if(!catchError(f)){var k={};g.forEach(function(a){k[a.name]=a});if(a){for(var r in k)a.state.accounts[r]=k[r];for(var p in c.content)a.state.content[p]=parsePost(c.content[p]);c=a.state}else c.accounts=k;b(d,e,c)}});else if(a&&a.urlFilter===d&&"/search"===d)if(k=getParameterByName("query"),k===a.search&&null!==k){for(var p in c.accounts)a.state.accounts[p]=
parseAccount(c.accounts[p]);for(var g in c.content)a.state.content[g]=parsePost(c.content[g]);p=c.discussion_idx[""].search;for(g=0;g<p.length;g++)a.state.discussion_idx[""].search.includes(p[g])||a.state.discussion_idx[""].search.push(p[g]);a.state.discussion_idx[""].search=removeBlockedContents(a.state,m,a.state.discussion_idx[""].search)}else b(d,e,c);else{if(a&&a.urlFilter===d){for(var f in c.accounts)a.state.accounts[f]=parseAccount(c.accounts[f]);c=a.state}var h=Object.keys(c.content),r=0,u=
function(){r++;r>=h.length&&b(d,e,c)};refreshAccessToken(function(a){for(var b=0;b<h.length;b++)(function(b,f,d){var g=new HttpClient(apiOptions.apiUrl+String.format("/creary/%s/%s",d.author,d.permlink));g.when("done",function(a){a=jsonify(a).data;c.content[f[b]]=parsePost(d,a.reblogged_by);u()});g.when("fail",function(a,g,e){console.error(g,e);c.content[f[b]]=parsePost(d,void 0);u()});g.headers={Authorization:"Bearer "+a};g.get({})})(b,h,c.content[h[b]])})}});creaEvents.on("crea.session.update",
function(b,l){a.session=h=b;a.account=m=l;--d;e(a.urlFilter)});creaEvents.on("crea.session.login",function(a,b){h=a;m=b;e()});var n;creaEvents.on("crea.scroll.bottom",function(){if(!n)if(n=!0,isUserFeed()){var b=new HttpClient(apiOptions.apiUrl+"/creary/feed");b.when("done",function(b){b=jsonify(b).data;if(b.length){var c=b.length,g=[],f=[],e=function(){c--;0>=c?getAccounts(f,function(b,f){if(!catchError(b)){f.forEach(function(b){a.state.accounts[b.name]=parseAccount(b)});g.sort(function(a,b){a=toLocaleDate(a.created);
return toLocaleDate(b.created).valueOf()-a.valueOf()});var c=a.discuss,d=a.category;g.forEach(function(b){var f=b.author+"/"+b.permlink;a.state.content[f]=b;a.state.discussion_idx[c][d].push(f)});a.state.discussion_idx[c][d]=removeBlockedContents(a.state,m,a.state.discussion_idx[c][d]);a.state.discussions=a.state.discussion_idx[c][d];a.$forceUpdate();creaEvents.emit("navigation.state.update",a.state)}n=!1}):n=!1};b.forEach(function(b){var c=b.author+"/"+b.permlink;a.state.content[c]?a.state.content[c].reblogged_by=
b.reblogged_by:crea.api.getContent(b.author,b.permlink,function(d,h){d?console.error("Error getting",c,d):(d=parsePost(h),d.reblogged_by=b.reblogged_by,g.push(d),a.state.accounts[b.author]||f.includes(b.author)||f.push(b.author));e()})})}else n=!1,--d});b.when("fail",function(a,b,d){n=!1;catchError(b)});var e=getPathPart().replace("/","").replace("@","");crea.api.getFollowing(e,"","blog",1E3,function(a,c){if(!catchError(a)){var e=[];c.following.forEach(function(a){e.push(a.following)});e.length&&
(e=e.join(","),refreshAccessToken(function(a){b.headers={Authorization:"Bearer "+a};d++;b.post({following:e,page:d,reblogs:!0,adult:m.user.metadata.adult_content})}))}})}else if("/search"===window.location.pathname){e=getParameterByName("query");var c=Object.keys(a.state.content).length;0<c&&0===c%20&&(globalLoading.show=!0,performSearch(e,++d,!0,function(){n=!1;globalLoading.show=!1}))}else{var h=a.category;switch(h){case "now":var t=crea.api.getDiscussionsByNow;break;case "skyrockets":t=crea.api.getDiscussionsBySkyrockets;
break;case "promoted":t=crea.api.getDiscussionsByPromoted;break;case "popular":t=crea.api.getDiscussionsByPopular;break;default:t=crea.api["getDiscussionsBy"+h.capitalize()]}t&&refreshAccessToken(function(b){t(d.author,d.permlink,21,function(c,e){if(c)console.error(c);else{var f=e.discussions;f.shift();var g=[],k=0,l=function(){k++;k>=f.length&&getAccounts(g,function(b,c){if(!catchError(b)){c.forEach(function(b){a.state.accounts[b.name]=b});var e=a.discuss;f.forEach(function(b){var c=b.author+"/"+
b.permlink;a.state.content[c]=b;a.state.discussion_idx[e][h].push(c)});a.state.discussion_idx[e][h]=removeBlockedContents(a.state,m,a.state.discussion_idx[e][h]);a.state.discussions=a.state.discussion_idx[e][h];d=f[f.length-1];a.$forceUpdate();creaEvents.emit("navigation.state.update",a.state)}n=!1})};for(c=0;c<f.length;c++)(function(c,d,f){var e=new HttpClient(apiOptions.apiUrl+String.format("/creary/%s/%s",d.author,d.permlink)),h=function(b){f[c]=parsePost(d,b);a.state.accounts[d.author]||g.includes(d.author)||
g.push(d.author)};e.when("done",function(a){a=jsonify(a).data;h(a.reblogged_by);l()});e.when("fail",function(a,b,c){console.error(b,c);h();l()});e.headers={Authorization:"Bearer "+b};e.get({})})(c,f[c],f)}})})}});creaEvents.on("crea.search.content",function(a){for(var b={},c={},d=[],e=0,h=function(f){e++;e>=a.length&&(console.log(f),f.content=b,f.accounts=c,d.sort(function(a,b){return f.content[b].active_votes.length-f.content[a].active_votes.length}),f.discussion_idx[""]={},f.discussion_idx[""].search=
d,creaEvents.emit("crea.posts","/search","search",f))},k=function(e){(function u(a){var e=a.author+"/"+a.permlink;crea.api.getState("/"+a.tags[0]+"/@"+e,function(f,g){f?(console.error(f),u(a)):(d.push(e),c[a.author]=g.accounts[a.author],b[e]=g.content[e],h(g))})})(a[e])},g=0;g<a.length;g++)k(g);0===a.length&&crea.api.getState("/no_results",function(a,b){catchError(a)||h(b)})});creaEvents.on("crea.content.filter",function(a){currentPage={pathname:a,title:document.title}});creaEvents.on("crea.dom.ready",
function(){$("#view-changer").click(function(){a.toggleSimpleView()})})})();
