(function(){function h(){a=new Vue({el:"#welcome",data:{slide:0,username:"",email:"",phone:"",phone_code:"",error:{username:"",email:"",phone:"",phone_code:"",password:null,matchPassword:"",terms:"",policy:""},validUsername:!1,validEmail:!1,validPhone:!1,sentSMS:!1,passwordMatch:!1,checkedTerms:!1,checkedPolicy:!1,suggestedPassword:"",password:"",lang:lang},methods:{inputPassword:k,inputCheckPassword:l,checkEmail:m,checkPhone:n,verifyPhone:p,changeSlide:function(a){var c=1<arguments.length&&void 0!==
arguments[1]?arguments[1]:null;console.log("Change to slide",a,c);c&&0!=c.length||(this.slide=a)},suggestPassword:function(){this.password=this.suggestedPassword="P"+crea.formatter.createSuggestedPassword()},checkUsername:q,sendConfirmationMail:r,createAccount:t,copyToClipboard:copyToClipboard}});creaEvents.emit("crea.dom.ready")}function q(){var b=a.$refs.inputusername;b.value=b.value.toLowerCase();var c=b.value;b=(new Date).getTime();e.last.value=c;e.last.date=b;e[c]=b;crea.utils.validateAccountName(c)?
a.error.username=lang.ERROR.INVALID_USERNAME:crea.api.lookupAccountNames([c],function(d,b){var g=e[c];if(g>e.last.date||g>=e.last.date&&c===e.last.value)d?(console.error(d),a.error.username=lang.ERROR.INVALID_USERNAME):null!=b[0]?a.error.username=lang.ERROR.USERNAME_EXISTS:(a.error.username=null,a.username=c)})}function m(b){f||(f=null);var c=b.target.value;console.log("Checking mail",c,validateEmail(c));validateEmail(c)?refreshAccessToken(function(d){var b=new HttpClient(apiOptions.apiUrl+"/validateAccount");
f=function(d){console.log("Validate",d,c);a.error.email=null;a.email=c};b.setHeaders({Authorization:"Bearer "+d}).when("fail",function(d,b,e){console.error("Request failed",d,b,e,c);d.responseText?"REGISTERED_EMAIL"===jsonify(d.responseText).error&&(a.error.email=lang.ERROR.EMAIL_EXISTS):a.error.email=lang.ERROR.UNKNOWN_ERROR}).when("done",f).post({username:a.username,email:c})}):(a.error.email=lang.ERROR.INVALID_EMAIL,a.email="")}function n(){var b=getParameterByName("token");b?(globalLoading.show=
!0,refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+("/validation-phone/"+b))).setHeaders({Authorization:"Bearer "+c}).post({phone:a.phone}).when("done",function(d){globalLoading.show=!1;d=JSON.parse(d);console.log("Phone validation",d);a.validPhone=!0;a.sentSMS=!0;a.error.phone=""}).when("fail",function(d,b,c){console.error(d,b,c);d=jsonify(d.responseText);a.error.phone=lang.ERROR[d.error];globalLoading.show=!1})})):a.slide=1}function p(){var b=getParameterByName("token");refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+
("/validate-phone/"+b))).setHeaders({Authorization:"Bearer "+c}).post({phoneCode:a.phone_code}).when("done",function(d){globalLoading.show=!1;d=JSON.parse(d);console.log("Phone verified",d);a.username=d.data.username;a.suggestPassword();a.slide=5;a.error.phone_code=""}).when("fail",function(d,b,c){console.error(d,b,c);d=jsonify(d.responseText);a.error.phone_code=lang.ERROR[d.error];globalLoading.show=!1})})}function l(b){(b=a.password===b.target.value)?(a.error.matchPassword=null,a.passwordMatch=
!0):a.error.matchPassword=lang.ERROR.PASSWORDS_NOT_MATCH;a.passwordMatch=b}function k(b){var c=b.target.value;console.log("Input password",c);c&&!c.isEmpty()?(a.password=b.target.value,a.error.password=null):a.error.password=lang.ERROR.INVALID_PASSWORD}function r(b){a.error.email||(globalLoading.show=!0,refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+"/crearySignUp")).setHeaders({Authorization:"Bearer "+c}).post({username:a.username,email:$("#reg-email").val()}).when("done",function(d){console.log("SignUp",
d);a.slide=4;globalLoading.show=!1;b&&b()})}))}function t(){!a.error.matchPassword&&a.checkedTerms&&a.checkedPolicy?(globalLoading.show=!0,createBlockchainAccount(a.username,a.password,function(b,c){globalLoading.show=!1;catchError(b)||(console.log(c),a.slide=8)})):console.error("Account could not be created","Match pass:",a.passwordMatch,"Terms:",a.checkedTerms,"Policy:",a.checkedPolicy)}var a,f,e={last:{value:null,date:0}};creaEvents.on("crea.content.loaded",function(){console.log("Content loaded!");
h();var b=getParameterByName("token");b?(globalLoading.show=!0,refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+("/validation/"+b))).setHeaders({Authorization:"Bearer "+c}).get().when("done",function(d){globalLoading.show=!1;d=JSON.parse(d);console.log("SignUp",d);a.username=d.data.username;a.slide=5}).when("fail",function(a,b,c){console.error(a,b,c);goTo("/"+a.status)})})):a.slide=1})})();
