var welcomeVue;
(function(){function h(){welcomeVue=new Vue({el:"#welcome",data:{slide:0,username:"",email:"",phone:"",phone_code:"",country_code:"",error:{username:"",email:"",phone:"",phone_code:"",password:null,matchPassword:"",terms:"",policy:""},validUsername:!1,validEmail:!1,validPhone:!1,sentSMS:!1,passwordMatch:!1,checkedTerms:!1,checkedPolicy:!1,suggestedPassword:"",password:"",lang:lang,countryCodes:countryCodes},methods:{inputPassword:k,inputCheckPassword:l,checkEmail:m,checkPhone:n,verifyPhone:p,onPhonePrefix:function(c){console.log("Prefix selected",
c);this.country_code="string"===typeof c?c:c.callingCodes[0]},changeSlide:function(c,b){console.log("Change to slide",c,b);var a=this;c<this.slide?this.slide=c:2===this.slide?this.checkUsername(function(b,f,q){b?(console.error(b),a.error.username=lang.ERROR.INVALID_USERNAME):null!=f[0]?a.error.username=lang.ERROR.USERNAME_EXISTS:(a.error.username=null,a.username=q,a.slide=c)}):3===this.slide?this.checkEmail(function(b,f){b?(welcomeVue.error.email=b,welcomeVue.email=""):(welcomeVue.error.email=null,
welcomeVue.email=f,a.sendConfirmationMail(function(b,f){catchError(b)||(a.slide=c)}))}):b&&0!==b.length||(this.slide=c)},suggestPassword:function(){this.password=this.suggestedPassword="P"+crea.formatter.createSuggestedPassword()},checkUsername:r,sendConfirmationMail:t,createAccount:u,copyToClipboard:copyToClipboard}});creaEvents.emit("crea.dom.ready")}function r(c){var b=welcomeVue.$refs.inputusername;b.value=b.value.toLowerCase();var a=b.value;b=moment().valueOf();d.last.value=a;d.last.date=b;d[a]=
b;crea.utils.validateAccountName(a)?welcomeVue.error.username=lang.ERROR.INVALID_USERNAME:crea.api.lookupAccountNames([a],function(b,f){var e=d[a];(e>d.last.date||e>=d.last.date&&a===d.last.value)&&c&&c(b,f,a)})}function m(c){g||(g=null);var b=welcomeVue.$refs.regemail.value;console.log("Checking mail",b,validateEmail(b));validateEmail(b)?refreshAccessToken(function(a){var e=new HttpClient(apiOptions.apiUrl+"/validateAccount");g=function(a){console.log("Validate",a,b);welcomeVue.error.email=null;
welcomeVue.email=b;c(null,b)};e.setHeaders({Authorization:"Bearer "+a}).when("fail",function(a,e,d){console.error("Request failed",a,e,d,b);a.responseText?"REGISTERED_EMAIL"===jsonify(a.responseText).error&&c(lang.ERROR.EMAIL_EXISTS,null):c(lang.ERROR.UNKNOWN_ERROR,null)}).when("done",g).post({username:welcomeVue.username,email:b})}):c(lang.ERROR.INVALID_EMAIL,null)}function n(){var c=getParameterByName("token");if(c){var b=welcomeVue.country_code+welcomeVue.phone;b=b.replace(" ","").replace("+",
"");globalLoading.show=!0;refreshAccessToken(function(a){(new HttpClient(apiOptions.apiUrl+("/validation-phone/"+c))).setHeaders({Authorization:"Bearer "+a}).post({phone:b}).when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("Phone validation",a);welcomeVue.validPhone=!0;welcomeVue.sentSMS=!0;welcomeVue.error.phone=""}).when("fail",function(a,b,c){console.error(a,b,c);a=jsonify(a.responseText);welcomeVue.error.phone=lang.ERROR[a.error];globalLoading.show=!1})})}else welcomeVue.slide=
1}function p(){var c=getParameterByName("token");refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+("/validate-phone/"+c))).setHeaders({Authorization:"Bearer "+b}).post({phoneCode:welcomeVue.phone_code}).when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("Phone verified",a);welcomeVue.username=a.data.username;welcomeVue.suggestPassword();welcomeVue.slide=7;welcomeVue.error.phone_code=""}).when("fail",function(a,b,c){console.error(a,b,c);a=jsonify(a.responseText);
welcomeVue.error.phone_code=lang.ERROR[a.error];globalLoading.show=!1})})}function l(c){(c=welcomeVue.password===c.target.value)?(welcomeVue.error.matchPassword=null,welcomeVue.passwordMatch=!0):welcomeVue.error.matchPassword=lang.ERROR.PASSWORDS_NOT_MATCH;welcomeVue.passwordMatch=c}function k(c){var b=c.target.value;console.log("Input password",b);b&&!b.isEmpty()?(welcomeVue.password=c.target.value,welcomeVue.error.password=null):welcomeVue.error.password=lang.ERROR.INVALID_PASSWORD}function t(c){welcomeVue.error.email||
(globalLoading.show=!0,refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+"/crearySignUp")).setHeaders({Authorization:"Bearer "+b}).post({username:welcomeVue.username,email:$("#reg-email").val()}).when("fail",function(a,b,d){globalLoading.show=!1;a=jsonify(a.responseText);c&&c(lang.ERROR[a.error],null)}).when("done",function(a){console.log("SignUp",a);welcomeVue.slide=4;globalLoading.show=!1;c&&c(null,a)})}))}function u(){!welcomeVue.error.matchPassword&&welcomeVue.checkedTerms&&welcomeVue.checkedPolicy?
(globalLoading.show=!0,createBlockchainAccount(welcomeVue.username,welcomeVue.password,function(c,b){globalLoading.show=!1;catchError(c)||(console.log(b),welcomeVue.slide=9)})):console.error("Account could not be created","Match pass:",welcomeVue.passwordMatch,"Terms:",welcomeVue.checkedTerms,"Policy:",welcomeVue.checkedPolicy)}var g,d={last:{value:null,date:0}};creaEvents.on("crea.content.loaded",function(){console.log("Content loaded!");h();var c=getParameterByName("token");c?(globalLoading.show=
!0,refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+("/validation/"+c))).setHeaders({Authorization:"Bearer "+b}).get().when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("SignUp",a);welcomeVue.username=a.data.username;welcomeVue.slide=5}).when("fail",function(a,b,c){console.error(a,b,c);goTo("/"+a.status)})})):welcomeVue.slide=1})})();
