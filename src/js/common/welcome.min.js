(function(){function g(){a=new Vue({el:"#welcome",data:{slide:0,username:"",email:"",error:{username:"",email:"",password:null,matchPassword:"",terms:"",policy:""},validUsername:!1,validEmail:!1,passwordMatch:!1,checkedTerms:!1,checkedPolicy:!1,suggestedPassword:"",password:"",lang:lang},methods:{inputPassword:h,inputCheckPassword:k,checkEmail:l,changeSlide:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;console.log("Change to slide",a,c);c&&0!=c.length||(this.slide=
a)},suggestPassword:function(){this.password=this.suggestedPassword="P"+crea.formatter.createSuggestedPassword()},checkUsername:m,sendConfirmationMail:n,createAccount:p,copyToClipboard:copyToClipboard}});creaEvents.emit("crea.dom.ready")}function m(){var b=a.$refs.inputusername;b.value=b.value.toLowerCase();var c=b.value;b=(new Date).getTime();d.last.value=c;d.last.date=b;d[c]=b;crea.utils.validateAccountName(c)?a.error.username=lang.ERROR.INVALID_USERNAME:crea.api.lookupAccountNames([c],function(b,
q){var e=d[c];if(e>d.last.date||e>=d.last.date&&c===d.last.value)b?(console.error(b),a.error.username=lang.ERROR.INVALID_USERNAME):null!=q[0]?a.error.username=lang.ERROR.USERNAME_EXISTS:(a.error.username=null,a.username=c)})}function l(b){f||(f=null);var c=b.target.value;console.log("Checking mail",c,validateEmail(c));validateEmail(c)?refreshAccessToken(function(b){var e=new HttpClient(apiOptions.apiUrl+"/validateAccount");f=function(b){console.log("Validate",b,c);a.error.email=null;a.email=c};e.setHeaders({Authorization:"Bearer "+
b}).when("fail",function(b,e,d){console.error("Request failed",b,e,d,c);b.responseText?"REGISTERED_EMAIL"===jsonify(b.responseText).error&&(a.error.email=lang.ERROR.EMAIL_EXISTS):a.error.email=lang.ERROR.UNKNOWN_ERROR}).when("done",f).post({username:a.username,email:c})}):(a.error.email=lang.ERROR.INVALID_EMAIL,a.email="")}function k(b){(b=a.password===b.target.value)?(a.error.matchPassword=null,a.passwordMatch=!0):a.error.matchPassword=lang.ERROR.PASSWORDS_NOT_MATCH;a.passwordMatch=b}function h(b){var c=
b.target.value;console.log("Input password",c);c&&!c.isEmpty()?(a.password=b.target.value,a.error.password=null):a.error.password=lang.ERROR.INVALID_PASSWORD}function n(b){a.error.email||(globalLoading.show=!0,refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+"/crearySignUp")).setHeaders({Authorization:"Bearer "+c}).post({username:a.username,email:$("#reg-email").val()}).when("done",function(c){console.log("SignUp",c);a.slide=4;globalLoading.show=!1;b&&b()})}))}function p(){!a.error.matchPassword&&
a.checkedTerms&&a.checkedPolicy?(globalLoading.show=!0,createBlockchainAccount(a.username,a.password,function(b,c){globalLoading.show=!1;catchError(b)||(console.log(c),a.slide=8)})):console.error("Account could not be created","Match pass:",a.passwordMatch,"Terms:",a.checkedTerms,"Policy:",a.checkedPolicy)}var a,f,d={last:{value:null,date:0}};creaEvents.on("crea.content.loaded",function(){console.log("Content loaded!");g();var b=getParameterByName("token");b?(globalLoading.show=!0,refreshAccessToken(function(c){(new HttpClient(apiOptions.apiUrl+
"/validate/"+b)).setHeaders({Authorization:"Bearer "+c}).get().when("done",function(b){globalLoading.show=!1;b=JSON.parse(b);console.log("SignUp",b);a.username=b.data.username;a.suggestPassword();a.slide=5}).when("fail",function(a,b,c){console.log(a,b,c);goTo("/"+a.status)})})):a.slide=1})})();
