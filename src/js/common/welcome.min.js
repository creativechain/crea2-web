var welcomeVue;
(function(){function f(){welcomeVue=new Vue({el:"#welcome",data:{slide:0,username:"",email:"",phone:"",phone_code:"",country_code:"",error:{username:"",email:"",phone:"",phone_code:"",password:null,matchPassword:"",terms:"",policy:""},validUsername:!1,validEmail:!1,validPhone:!1,sentSMS:!1,passwordMatch:!1,checkedTerms:!1,checkedPolicy:!1,suggestedPassword:"",password:"",lang:lang,countryCodes:countryCodes},methods:{inputPassword:g,inputCheckPassword:h,checkEmail:k,checkPhone:l,verifyPhone:m,onPhonePrefix:function(a){console.log("Prefix selected",
a);this.country_code=a.callingCodes[0]},changeSlide:function(a,b){console.log("Change to slide",a,b);b&&0!==b.length||(this.slide=a)},suggestPassword:function(){this.password=this.suggestedPassword="P"+crea.formatter.createSuggestedPassword()},checkUsername:n,sendConfirmationMail:p,createAccount:q,copyToClipboard:copyToClipboard}});creaEvents.emit("crea.dom.ready")}function n(){var a=welcomeVue.$refs.inputusername;a.value=a.value.toLowerCase();var b=a.value;a=(new Date).getTime();c.last.value=b;c.last.date=
a;c[b]=a;crea.utils.validateAccountName(b)?welcomeVue.error.username=lang.ERROR.INVALID_USERNAME:crea.api.lookupAccountNames([b],function(a,r){var d=c[b];if(d>c.last.date||d>=c.last.date&&b===c.last.value)a?(console.error(a),welcomeVue.error.username=lang.ERROR.INVALID_USERNAME):null!=r[0]?welcomeVue.error.username=lang.ERROR.USERNAME_EXISTS:(welcomeVue.error.username=null,welcomeVue.username=b)})}function k(a){e||(e=null);var b=a.target.value;console.log("Checking mail",b,validateEmail(b));validateEmail(b)?
refreshAccessToken(function(a){var d=new HttpClient(apiOptions.apiUrl+"/validateAccount");e=function(a){console.log("Validate",a,b);welcomeVue.error.email=null;welcomeVue.email=b};d.setHeaders({Authorization:"Bearer "+a}).when("fail",function(a,d,c){console.error("Request failed",a,d,c,b);a.responseText?"REGISTERED_EMAIL"===jsonify(a.responseText).error&&(welcomeVue.error.email=lang.ERROR.EMAIL_EXISTS):welcomeVue.error.email=lang.ERROR.UNKNOWN_ERROR}).when("done",e).post({username:welcomeVue.username,
email:b})}):(welcomeVue.error.email=lang.ERROR.INVALID_EMAIL,welcomeVue.email="")}function l(){var a=getParameterByName("token");a?(globalLoading.show=!0,refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+("/validation-phone/"+a))).setHeaders({Authorization:"Bearer "+b}).post({phone:welcomeVue.country_code+welcomeVue.phone}).when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("Phone validation",a);welcomeVue.validPhone=!0;welcomeVue.sentSMS=!0;welcomeVue.error.phone=
""}).when("fail",function(a,b,c){console.error(a,b,c);a=jsonify(a.responseText);welcomeVue.error.phone=lang.ERROR[a.error];globalLoading.show=!1})})):welcomeVue.slide=1}function m(){var a=getParameterByName("token");refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+("/validate-phone/"+a))).setHeaders({Authorization:"Bearer "+b}).post({phoneCode:welcomeVue.phone_code}).when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("Phone verified",a);welcomeVue.username=a.data.username;
welcomeVue.suggestPassword();welcomeVue.slide=7;welcomeVue.error.phone_code=""}).when("fail",function(a,b,c){console.error(a,b,c);a=jsonify(a.responseText);welcomeVue.error.phone_code=lang.ERROR[a.error];globalLoading.show=!1})})}function h(a){(a=welcomeVue.password===a.target.value)?(welcomeVue.error.matchPassword=null,welcomeVue.passwordMatch=!0):welcomeVue.error.matchPassword=lang.ERROR.PASSWORDS_NOT_MATCH;welcomeVue.passwordMatch=a}function g(a){var b=a.target.value;console.log("Input password",
b);b&&!b.isEmpty()?(welcomeVue.password=a.target.value,welcomeVue.error.password=null):welcomeVue.error.password=lang.ERROR.INVALID_PASSWORD}function p(a){welcomeVue.error.email||(globalLoading.show=!0,refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+"/crearySignUp")).setHeaders({Authorization:"Bearer "+b}).post({username:welcomeVue.username,email:$("#reg-email").val()}).when("done",function(b){console.log("SignUp",b);welcomeVue.slide=4;globalLoading.show=!1;a&&a()})}))}function q(){!welcomeVue.error.matchPassword&&
welcomeVue.checkedTerms&&welcomeVue.checkedPolicy?(globalLoading.show=!0,createBlockchainAccount(welcomeVue.username,welcomeVue.password,function(a,b){globalLoading.show=!1;catchError(a)||(console.log(b),welcomeVue.slide=8)})):console.error("Account could not be created","Match pass:",welcomeVue.passwordMatch,"Terms:",welcomeVue.checkedTerms,"Policy:",welcomeVue.checkedPolicy)}var e,c={last:{value:null,date:0}};creaEvents.on("crea.content.loaded",function(){console.log("Content loaded!");f();var a=
getParameterByName("token");a?(globalLoading.show=!0,refreshAccessToken(function(b){(new HttpClient(apiOptions.apiUrl+("/validation/"+a))).setHeaders({Authorization:"Bearer "+b}).get().when("done",function(a){globalLoading.show=!1;a=JSON.parse(a);console.log("SignUp",a);welcomeVue.username=a.data.username;welcomeVue.slide=5}).when("fail",function(a,b,c){console.error(a,b,c);goTo("/"+a.status)})})):welcomeVue.slide=1})})();
