var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var d=0;return function(){return d<a.length?{done:!1,value:a[d++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var d="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return d?d.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,d,c){a!=Array.prototype&&a!=Object.prototype&&(a[d]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,d,c,g){if(d){c=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var h=a[g];h in c||(c[h]={});c=c[h]}a=a[a.length-1];g=c[a];d=d(g);d!=g&&null!=d&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var d=this;d instanceof String&&(d=String(d));var h=d.length;c=c||0;for(0>c&&(c=Math.max(c+h,0));c<h;c++){var n=d[c];if(n===a||Object.is(n,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,d,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(d instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.owns=function(a,d){return Object.prototype.hasOwnProperty.call(a,d)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,d){for(var c=1;c<arguments.length;c++){var g=arguments[c];if(g)for(var h in g)$jscomp.owns(g,h)&&(a[h]=g[h])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
(function(){function a(a){var f={},k=a?License.fromFlag(a.metadata.license):License.fromFlag(LICENSE.NO_LICENSE.flag);if(a){var t=a.metadata.featuredImage;f=t.url?t:mfi?{url:t}:f}b=new Vue({el:"#publish-container",data:{lang:lang,session:r,LICENSE:LICENSE,CONSTANTS:CONSTANTS,step:1,editablePost:a,bodyElements:a?a.body:[],tags:[],uploadedFiles:[],updatingIndex:-1,editor:{editing:!1,show:!1},featuredImage:f,title:a?a.title:null,description:a?a.metadata.description:"",adult:a?a.metadata.adult:!1,downloadFile:{price:0,
currency:"CREA"},publicDomain:k.has(LICENSE.FREE_CONTENT.flag)?LICENSE.FREE_CONTENT.flag:LICENSE.NO_LICENSE.flag,share:k.has(LICENSE.SHARE_ALIKE.flag)?LICENSE.SHARE_ALIKE.flag:k.has(LICENSE.NON_DERIVATES.flag)?LICENSE.NON_DERIVATES.flag:LICENSE.NO_LICENSE.flag,commercial:k.has(LICENSE.NON_COMMERCIAL.flag)?LICENSE.NON_COMMERCIAL.flag:LICENSE.NO_LICENSE.flag,noLicense:k.has(LICENSE.NON_PERMISSION.flag)?LICENSE.NON_PERMISSION.flag:LICENSE.NO_LICENSE.flag,showEditor:!1,tagsConfig:{init:!1,addedEvents:!1},
error:null},mounted:function(){},updated:function(){console.log("updating");2!==this.step&&(this.tagsConfig.init=!1,this.tagsConfig.addedEvents=!1);if(2===this.step){var e=$("#publish-tags"),b=this;this.tagsConfig.init||(e.tagsinput({maxTags:CONSTANTS.MAX_TAGS,maxChars:CONSTANTS.TEXT_MAX_SIZE.TAG,delimiter:" "}),this.tagsConfig.init=!0);this.tagsConfig.addedEvents||(e.on("beforeItemAdd",function(a){b.tags.includes(a.item)||b.tags.push(a.item)}),e.on("itemRemoved",function(a){a=b.tags.indexOf(a.item);
-1<a&&b.tags.splice(a,1)}),this.tagsConfig.addedEvents=!0,a&&a.metadata.tags.forEach(function(a){e.tagsinput("add",a)}));0<b.tags.length&&b.tags.forEach(function(a){e.tagsinput("add",a)})}},methods:{getLicense:function(){if(this.noLicense===LICENSE.NON_PERMISSION.flag)var a=License.fromFlag(this.noLicense);else this.publicDomain===LICENSE.FREE_CONTENT.flag?a=License.fromFlag(this.publicDomain):(a=LICENSE.CREATIVE_COMMONS.flag|LICENSE.ATTRIBUTION.flag|this.share|this.commercial,a=License.fromFlag(a));
return a},toStep:function(a){!this.editor.show&&this.step>a&&(this.step=a)},nextStep:function(){if(!this.editor.show){switch(this.step){case 1:this.bodyElements=cleanArray(this.bodyElements);this.error=0<this.bodyElements.length?null:this.lang.PUBLISH.NO_ELEMENTS_ERROR;break;case 2:this.error=this.featuredImage.hash&&this.title&&0!==this.tags.length?null:this.lang.PUBLISH.NO_TITLE_TAG_OR_IMAGE;break;case 3:this.error=this.editablePost&&this.editablePost.download.size&&!this.downloadFile.size?String.format(this.lang.PUBLISH.RELOAD_DOWNLOAD_FILE,
this.editablePost.download.size.name):null}this.error||(this.step+=1)}},loadFile:function(a){this.editor.show||this.$refs.publishInputFile.click()},loadFeaturedImage:function(a){this.$refs.publishInputCover.click()},onInputDownloadFile:function(a){a=a.target.files;var b=this;0<a.length&&(globalLoading.show=!0,uploadToIpfs(a[0],CONSTANTS.FILE_MAX_SIZE.POST_BODY.DOWNLOAD,function(a,e){globalLoading.show=!1;catchError(a)||(e.resource=e.url,b.downloadFile=Object.assign(b.downloadFile,jsonify(jsonstring(e))),
b.editablePost&&(b.editablePost.downloadUploaded=0<e.size))}))},onLoadFile:function(a){var b=this;a=a.target.files;var f=a[0];console.log("File loading",f);if(0<a.length){globalLoading.show=!0;var e=$jscomp.makeIterator(f.type.toUpperCase().split("/"));a=e.next().value;e=e.next().value;a=CONSTANTS.FILE_MAX_SIZE.POST_BODY[a];CONSTANTS.FILE_MAX_SIZE.POST_BODY[e]&&(a=CONSTANTS.FILE_MAX_SIZE.POST_BODY[e]);console.log("file:",f,"MaxSize:",a,"isGif",f.type.toLowerCase().includes("image/gif"));uploadToIpfs(f,
a,function(a,e){globalLoading.show=!1;a?b.error=a:(b.bodyElements.push(e),m[e.hash]=f,b.error=null,resizeImage(f,function(a){var c=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW[f.type.toUpperCase().split("/")[0]];m[e.hash]={original:f,resized:a};-1<e.type.indexOf("image/")&&!b.featuredImage.hash&&uploadToIpfs(a,c,function(f,e){f?console.error(f,a):(b.featuredImage=e,console.log("Featured image loaded!"))})}),$(b.$refs.publishInputFile).val(""))})}},onLoadFeaturedImage:function(a){var b=this;a=a.target.files;
if(0<a.length){globalLoading.show=!0;var f=a[0],e=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW[f.type.toUpperCase().split("/")[0]];resizeImage(f,function(a){uploadToIpfs(a,e,function(a,e){globalLoading.show=!1;catchError(a)||(b.featuredImage=e,m[e.hash]=f,b.error=null)})})}},toggleEditor:function(a){cancelEventPropagation(a);this.editor.show||(this.editor.show=!this.editor.show)},editorInput:function(a){this.editor.editing=0<a.length},editorEmbedVideo:function(a,b){this.bodyElements.push({type:"embed/"+b.reproductor,
value:a,player:b.reproductor})},updateText:g,removeTitleEmojis:d,removeDescriptionEmojis:c,editText:h,removeElement:n,makePublication:w,humanFileSize:humanFileSize,stringFormat:String.format}})}function d(a){b.title=removeEmojis(a.target.value)}function c(a){b.description=removeEmojis(a.target.value)}function g(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,c=CKEDITOR.instances.editor,d=c.getData();d.isEmpty()||(-1<a?b.bodyElements[a].value=d:b.bodyElements.push({value:d,type:"text/html"}),
b.updatingIndex=-1,c.setData(""),b.editor.editing=!1,b.editor.show=!1)}function h(a){console.log("Editing text",a);-1<a&&(b.editor.show=!0,setTimeout(function(){CKEDITOR.instances.editor.setData(b.bodyElements[a].value);b.updatingIndex=a;b.editor.editing=!0},500))}function n(a){if(-1<a&&a<=b.bodyElements.length-1){var c=b.bodyElements[a];b.bodyElements.splice(a,1);c.type.includes("image/")&&(a=m[c.hash],a.resized.name===b.featuredImage.name&&a.resized.size===b.featuredImage.size&&(b.featuredImage=
{},delete m[c.hash]));if(!b.featuredImage.hash){c={};for(var d=0;d<b.bodyElements.length;c={$jscomp$loop$prop$newFiles$1:c.$jscomp$loop$prop$newFiles$1},d++)if(a=b.bodyElements[d],a.type.includes("image/")){d=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW.IMAGE;c.$jscomp$loop$prop$newFiles$1=m[a.hash];console.log("Selected new featured image",c.$jscomp$loop$prop$newFiles$1.resized.name,a.hash);uploadToIpfs(c.$jscomp$loop$prop$newFiles$1.resized,d,function(a){return function(c,d){c?console.error(c,a.$jscomp$loop$prop$newFiles$1.resized):
(console.log("Preview uploaded",d),b.featuredImage=d,console.log("Featured image loaded!"))}}(c));break}}b.$forceUpdate()}}function w(a){cancelEventPropagation(a);var c=r.account.username;requireRoleKey(c,"posting",function(a){var d;globalLoading.show=!0;for(var e=b.tags,f=[],g=0;g<e.length;g++){var h=normalizeTag(e[g]);f.includes(h)||f.push(h)}var k={description:b.description,tags:f,adult:b.adult,featuredImage:b.featuredImage,license:b.getLicense().getFlag()},l=b.downloadFile;l.price||(l.price=0);
l.price=Asset.parseString(l.price+" "+l.currency).toFriendlyString(null,!1);l.resource||(l="");var m=jsonstring(b.bodyElements),n=b.title,q=!!b.editablePost,p=q?b.editablePost.permlink:toPermalink(n),v=function(){if(q&&b.editablePost.metadata.tags){var e=b.editablePost.metadata.tags[0];e&&!k.tags.includes(e)&&k.tags.unshift(e)}e=[];e.push(crea.broadcast.commentBuilder("",toPermalink(k.tags[0]),c,p,n,m,jsonstring(l),jsonstring(k)));var f=u.user.metadata.post_rewards;if(q)switch(b.editablePost.percent_crea_dollars){case 1E4:f=
"0";break;case 0:f="100";break;default:f="50"}switch(f){case "0":e.push(crea.broadcast.commentOptionsBuilder(c,p,"0.000 CBD",1E4,!0,!0,[]));break;case "50":break;default:e.push(crea.broadcast.commentOptionsBuilder(c,p,"1000000.000 CBD",0,!0,!0,[]))}f=[a];(d=crea.broadcast).sendOperations.apply(d,[f].concat(e,[function(a,b){catchError(a)?globalLoading.show=!1:(console.log(b),a={url:"/"+toPermalink(k.tags[0])+"/@"+r.account.username+"/"+p},showPost(a))}]))};q?v():crea.api.getDiscussion(c,p,function(a,
b){console.log(a,b);a||(0!==b.id?(catchError(lang.ERROR.PERMLINK_ALREADY_EXISTS),globalLoading.show=!1):v())})})}var r,u,b,m={};creaEvents.on("crea.content.loaded",function(){var b=getParameterByName("edit");if(b){var c=b.split("/")[0];b=b.split("/")[1];var d=Session.getAlive();d&&d.account.username===c&&crea.api.getDiscussion(c,b,function(b,c){catchError(b)||(c=parsePost(c),b=Asset.parse(c.download.price),c.download.price=parseFloat(b.toPlainString()),c.download.currency=b.asset.symbol,c.downloadUploaded=
!1,a(c))})}else a()});creaEvents.on("crea.session.login",function(a,c){r=a;b&&(b.session=a,b.$forceUpdate());u=c;creaEvents.emit("crea.dom.ready")})})();
