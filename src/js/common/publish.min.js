var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,b){a!=Array.prototype&&a!=Object.prototype&&(a[f]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,f,b,e){if(f){b=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var g=a[e];g in b||(b[g]={});b=b[g]}a=a[a.length-1];e=b[a];f=f(e);f!=e&&null!=f&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Object.is",function(a){return a?a:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,b){var e=this;e instanceof String&&(e=String(e));var f=e.length;b=b||0;for(0>b&&(b=Math.max(b+f,0));b<f;b++){var m=e[b];if(m===a||Object.is(m,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,f,b){if(null==a)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");
$jscomp.owns=function(a,f){return Object.prototype.hasOwnProperty.call(a,f)};$jscomp.assign="function"==typeof Object.assign?Object.assign:function(a,f){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var g in e)$jscomp.owns(e,g)&&(a[g]=e[g])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");
(function(){function a(d){var a={},k=d?License.fromFlag(d.metadata.license):License.fromFlag(LICENSE.NO_LICENSE.flag);if(d){var q=d.metadata.featuredImage;a=q.url?q:mfi?{url:q}:a}c=new Vue({el:"#publish-container",data:{lang:lang,session:p,LICENSE:LICENSE,CONSTANTS:CONSTANTS,step:1,editablePost:d,bodyElements:d?d.body:[],tags:[],uploadedFiles:[],updatingIndex:-1,editor:{editing:!1,show:!1},featuredImage:a,title:d?d.title:null,description:d?d.metadata.description:"",adult:d?d.metadata.adult:!1,downloadFile:{price:0,
currency:"CREA"},publicDomain:k.has(LICENSE.FREE_CONTENT.flag)?LICENSE.FREE_CONTENT.flag:LICENSE.NO_LICENSE.flag,share:k.has(LICENSE.SHARE_ALIKE.flag)?LICENSE.SHARE_ALIKE.flag:k.has(LICENSE.NON_DERIVATES.flag)?LICENSE.NON_DERIVATES.flag:LICENSE.NO_LICENSE.flag,commercial:k.has(LICENSE.NON_COMMERCIAL.flag)?LICENSE.NON_COMMERCIAL.flag:LICENSE.NO_LICENSE.flag,noLicense:k.has(LICENSE.NON_PERMISSION.flag)?LICENSE.NON_PERMISSION.flag:LICENSE.NO_LICENSE.flag,showEditor:!1,tagsConfig:{init:!1,addedEvents:!1},
error:null},mounted:function(){},updated:function(){console.log("updating");2!==this.step&&(this.tagsConfig.init=!1,this.tagsConfig.addedEvents=!1);if(2===this.step){var a=$("#publish-tags"),c=this;this.tagsConfig.init||(a.tagsinput({maxTags:CONSTANTS.MAX_TAGS,maxChars:CONSTANTS.TEXT_MAX_SIZE.TAG,delimiter:" "}),this.tagsConfig.init=!0);this.tagsConfig.addedEvents||(a.on("beforeItemAdd",function(a){c.tags.includes(a.item)||c.tags.push(a.item)}),a.on("itemRemoved",function(a){a=c.tags.indexOf(a.item);
-1<a&&c.tags.splice(a,1)}),this.tagsConfig.addedEvents=!0,d&&d.metadata.tags.forEach(function(d){a.tagsinput("add",d)}));0<c.tags.length&&c.tags.forEach(function(d){a.tagsinput("add",d)})}},methods:{getLicense:function(){if(this.noLicense===LICENSE.NON_PERMISSION.flag)var a=License.fromFlag(this.noLicense);else this.publicDomain===LICENSE.FREE_CONTENT.flag?a=License.fromFlag(this.publicDomain):(a=LICENSE.CREATIVE_COMMONS.flag|LICENSE.ATTRIBUTION.flag|this.share|this.commercial,a=License.fromFlag(a));
return a},toStep:function(a){!this.editor.show&&this.step>a&&(this.step=a)},nextStep:function(){if(!this.editor.show){switch(this.step){case 1:this.bodyElements=cleanArray(this.bodyElements);this.error=0<this.bodyElements.length?null:this.lang.PUBLISH.NO_ELEMENTS_ERROR;break;case 2:this.error=this.featuredImage.hash&&this.title&&0!==this.tags.length?null:this.lang.PUBLISH.NO_TITLE_TAG_OR_IMAGE;break;case 3:this.error=this.editablePost&&this.editablePost.download.size&&!this.downloadFile.size?String.format(this.lang.PUBLISH.RELOAD_DOWNLOAD_FILE,
this.editablePost.download.size.name):null}this.error||(this.step+=1)}},loadFile:function(a){this.editor.show||this.$refs.publishInputFile.click()},loadFeaturedImage:function(a){this.$refs.publishInputCover.click()},onInputDownloadFile:function(a){a=a.target.files;var d=this;0<a.length&&(globalLoading.show=!0,uploadToIpfs(a[0],CONSTANTS.FILE_MAX_SIZE.POST_BODY.DOWNLOAD,function(a,c){globalLoading.show=!1;catchError(a)||(c.resource=c.url,d.downloadFile=Object.assign(d.downloadFile,jsonify(jsonstring(c))),
d.editablePost&&(d.editablePost.downloadUploaded=0<c.size))}))},onLoadFile:function(a){var d=this,c=a.target.files;console.log("File loading",a);if(0<c.length){globalLoading.show=!0;var b=c[0];a=CONSTANTS.FILE_MAX_SIZE.POST_BODY[b.type.toUpperCase().split("/")[0]];console.log("file:",b,"MaxSize:",a);uploadToIpfs(b,a,function(a,c){globalLoading.show=!1;a?d.error=a:(d.bodyElements.push(c),h[c.hash]=b,d.error=null,resizeImage(b,function(a){var w=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW[b.type.toUpperCase().split("/")[0]];
h[c.hash]={original:b,resized:a};-1<c.type.indexOf("image/")&&!d.featuredImage.hash&&uploadToIpfs(a,w,function(c,b){c?console.error(c,a):(d.featuredImage=b,console.log("Featured image loaded!"))})}),$(d.$refs.publishInputFile).val(""))})}},onLoadFeaturedImage:function(a){var d=this;a=a.target.files;if(0<a.length){globalLoading.show=!0;var c=a[0],b=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW[c.type.toUpperCase().split("/")[0]];resizeImage(c,function(a){uploadToIpfs(a,b,function(a,b){globalLoading.show=!1;
catchError(a)||(d.featuredImage=b,h[b.hash]=c,d.error=null)})})}},toggleEditor:function(a){cancelEventPropagation(a);this.editor.show||(this.editor.show=!this.editor.show)},editorInput:function(a){this.editor.editing=0<a.length},editorEmbedVideo:function(a,d){this.bodyElements.push({type:"embed/"+d.reproductor,value:a,player:d.reproductor})},updateText:e,removeTitleEmojis:f,removeDescriptionEmojis:b,editText:g,removeElement:m,makePublication:x,humanFileSize:humanFileSize,stringFormat:String.format}})}
function f(a){c.title=removeEmojis(a.target.value)}function b(a){c.description=removeEmojis(a.target.value)}function e(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,b=CKEDITOR.instances.editor,e=b.getData();e.isEmpty()||(-1<a?c.bodyElements[a].value=e:c.bodyElements.push({value:e,type:"text/html"}),c.updatingIndex=-1,b.setData(""),c.editor.editing=!1,c.editor.show=!1)}function g(a){console.log("Editing text",a);-1<a&&(c.editor.show=!0,setTimeout(function(){CKEDITOR.instances.editor.setData(c.bodyElements[a].value);
c.updatingIndex=a;c.editor.editing=!0},500))}function m(a){if(-1<a&&a<=c.bodyElements.length-1){var b=c.bodyElements[a];c.bodyElements.splice(a,1);b.type.includes("image/")&&(a=h[b.hash],a.resized.name===c.featuredImage.name&&a.resized.size===c.featuredImage.size&&(c.featuredImage={},delete h[b.hash]));if(!c.featuredImage.hash)for(a=0;a<c.bodyElements.length;a++)if(b=c.bodyElements[a],b.type.includes("image/")){a=CONSTANTS.FILE_MAX_SIZE.POST_PREVIEW.IMAGE;var d=h[b.hash];console.log("Selected new featured image",
d.resized.name,b.hash);uploadToIpfs(d.resized,a,function(a,b){a?console.error(a,d.resized):(console.log("Preview uploaded",b),c.featuredImage=b,console.log("Featured image loaded!"))});break}c.$forceUpdate()}}function x(a){cancelEventPropagation(a);var b=p.account.username;requireRoleKey(b,"posting",function(a){var d;globalLoading.show=!0;for(var e=c.tags,f=[],g=0;g<e.length;g++){var k=normalizeTag(e[g]);f.includes(k)||f.push(k)}var h={description:c.description,tags:f,adult:c.adult,featuredImage:c.featuredImage,
license:c.getLicense().getFlag()},l=c.downloadFile;l.price||(l.price=0);l.price=Asset.parseString(l.price+" "+l.currency).toFriendlyString(null,!1);l.resource||(l="");var m=jsonstring(c.bodyElements),t=c.title,r=!!c.editablePost,n=r?c.editablePost.permlink:toPermalink(t),v=function(){if(r&&c.editablePost.metadata.tags){var e=c.editablePost.metadata.tags[0];e&&!h.tags.includes(e)&&h.tags.unshift(e)}e=[];e.push(crea.broadcast.commentBuilder("",toPermalink(h.tags[0]),b,n,t,m,jsonstring(l),jsonstring(h)));
switch(u.user.metadata.post_rewards){case "0":e.push(crea.broadcast.commentOptionsBuilder(b,n,"0.000 CBD",1E4,!0,!0,[]));break;case "50":e.push(crea.broadcast.commentOptionsBuilder(b,n,"5000000.000 CBD",5E3,!0,!0,[]));break;default:e.push(crea.broadcast.commentOptionsBuilder(b,n,"1000000.000 CBD",0,!0,!0,[]))}var f=[a];(d=crea.broadcast).sendOperations.apply(d,[f].concat(e,[function(a,b){catchError(a)?globalLoading.show=!1:(console.log(b),a={url:"/"+toPermalink(h.tags[0])+"/@"+p.account.username+
"/"+n},showPost(a))}]))};r?v():crea.api.getDiscussion(b,n,function(a,b){console.log(a,b);a||(0!==b.id?(catchError(lang.ERROR.PERMLINK_ALREADY_EXISTS),globalLoading.show=!1):v())})})}var p,u,c,h={};creaEvents.on("crea.content.loaded",function(){var b=getParameterByName("edit");if(b){var c=b.split("/")[0];b=b.split("/")[1];var e=Session.getAlive();e&&e.account.username===c&&crea.api.getDiscussion(c,b,function(b,c){catchError(b)||(c=parsePost(c),b=Asset.parse(c.download.price),c.download.price=parseFloat(b.toPlainString()),
c.download.currency=b.asset.symbol,c.downloadUploaded=!1,a(c))})}else a()});creaEvents.on("crea.session.login",function(a,b){p=a;c&&(c.session=a,c.$forceUpdate());u=b;creaEvents.emit("crea.dom.ready")})})();
