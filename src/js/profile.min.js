"use strict";(function(){var l;var f={};var j;var u;var q;var y;var o;var a;function g(G,M){console.log("Modal De-Energize",jsonify(jsonstring(G)));var N=parseFloat(vestingCrea(G.user,G.props).toPlainString(null,false));var I=parseFloat(delegatedCrea(G.user,G.props).toPlainString(null,false));var P=N-I;var Q=vestsToCgy(G,new Vests(G.user.withdrawn).toFriendlyString(null,false),apiOptions.nai.CREA);var K=vestsToCgy(G,new Vests(G.user.to_withdraw).toFriendlyString(null,false),apiOptions.nai.CREA);var O="";if(K.amount-Q.amount>0){O=String.format(lang.WALLET.DE_ENERGIZE_TEXT,K.toFriendlyString(null,false),Q.toFriendlyString(null,false))}if(!o){o=new Vue({el:"#wallet-de-energize",data:{lang:lang,session:M,state:G,maxPowerDown:P,finalAmount:0,sliderValue:0,amountByWeek:"",withdrawNote:O},methods:{formatString:String.format,onAmount:function J(S){S+=0.0001;var T=Asset.parse({amount:S,nai:apiOptions.nai.CREA});this.amountByWeek=S<0.001?"":String.format(this.lang.WALLET.DE_ENERGIZE_AMOUNT_BY_WEEK,T.divide(8).toFriendlyString(null,false))},onManualChange:function L(T){if(T){var S=T.target.valueAsNumber;if(isNaN(S)){S=0}this.onAmount(S)}},hideModalDeEnergize:function F(S){cancelEventPropagation(S);$("#wallet-de-energize").parent().removeClass("modal-active")},makeDeEnergize:function H(U,S){cancelEventPropagation(U);var T=this;var V=this.session.account.username;requireRoleKey(V,"active",function(Y){globalLoading.show=true;var W=T.finalAmount+" CREA";console.log(W);var X=cgyToVests(T.state,W);crea.broadcast.withdrawVesting(Y,V,X.toFriendlyString(null,false),function(aa,Z){globalLoading.show=false;if(!catchError(aa)){T.hideModalDeEnergize();updateUserSession()}})})}}})}else{o.session=M;o.state=G}}function m(G,N){if(!y){y=new Vue({el:"#wallet-send",data:{CONSTANTS:CONSTANTS,session:N,state:G,lang:lang,from:G.user.name,amount:0,memo:"",config:clone(a),toError:false},mounted:function F(){var P=this;$("#wallet-send").on("modalClosed.modals.mr",function(){P.clearFields()})},methods:{shouldShowMemo:function M(){var P=["transfer_to_vests","transfer_to_savings_crea","transfer_to_savings_cbd"];return !P.includes(this.config.op)},cancelSend:function O(P){cancelEventPropagation(P);this.config.confirmed=false},hideModalSend:function H(P){cancelEventPropagation(P);$("#wallet-send").removeClass("modal-active");this.clearFields()},clearFields:function J(){this.amount=0;this.memo="";this.config=clone(a)},useTotalAmount:function L(P){cancelEventPropagation(P);this.amount=this.config.total_amount.toPlainString()},sendCrea:function I(){if(this.toError||!this.amount){}else{if(this.config.confirmed){var S=this;var Q={amount:S.amount,nai:S.config.nai.toLowerCase(),round:true};var P=Asset.parse(Q).toFriendlyString(null,false);requireRoleKey(this.session.account.username,"active",function(T){globalLoading.show=true;console.log("Key:",T,S.config.op);i(T,S.config.op,S.session,S.config.to,P,S.memo,function(V,U){globalLoading.show=false;if(!catchError(V)){if(U){updateUserSession();S.hideModalSend()}}})})}else{this.config.confirmed=true;this.config.button=this.lang.BUTTON.SEND}}},validateDestiny:function K(S){var T=S.target.value;if(!crea.utils.validateAccountName(T)){var Q=[T];console.log("Checking",Q);var P=this;crea.api.lookupAccountNames(Q,function(V,U){if(V){console.error(V);P.toError=true}else{P.toError=U[0]==null}})}else{this.toError=true}}}})}else{y.state=G;y.session=N;y.from=G.user.name}}function s(av,ad,M,P){var ah=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"projects";var ag=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"balance";var X=null;if(av.user.to_withdraw>0&&ad&&av.user.name===ad.account.username){X=String.format(lang.WALLET.NEXT_DE_ENERGIZE,moment(toLocaleDate(av.user.next_vesting_withdrawal)).fromNow())}if(!l){l=new Vue({el:"#profile-container",data:{CONSTANTS:CONSTANTS,lang:lang,isoLangs:isoLangs,session:ad,account:M,state:av,filter:P,navbar:{section:ah},profile:av.user.metadata,walletTab:ag,history:{data:[],accounts:{}},blocked:{},showPriv:{posting:false,active:false,owner:false,memo:false},changePass:{username:ad?ad.account.username:null,oldPass:null,newPass:null,matchedPass:null,checkedLostPass:false,checkedStoredPass:false,error:null},nextDeEnergize:X,simpleView:false},updated:function J(){var ay=$("#wallet-tabs").prev();if(ay.is(":empty")){ay.remove()}var ax=$("#profile-edit-tags");ax.tagsinput({maxTags:CONSTANTS.MAX_TAGS,maxChars:CONSTANTS.TEXT_MAX_SIZE.TAG,delimiter:" "});if(this.profile.tags){this.profile.tags.forEach(function(az){ax.tagsinput("add",az)})}},methods:{isFeed:function(){return false},getDefaultAvatar:R.getAvatar,toUrl:toUrl,hidePrivKey:function ab(ax){this.showPriv[ax]=false},getPrivKey:function U(ay){var ax=this;var az=this.session?this.session.account.username:"";requireRoleKey(az,ay,function(aA){ax.showPriv[ay]=aA})},getKey:function O(ax){if(this.showPriv[ax]){return this.showPriv[ax]}else{if(ax==="memo"){return av.user.memo_key}else{return av.user[ax].key_auths[0][0]}}},prepareModal:function au(ay){var ax;switch(ay){case"transfer_crea":ax={title:this.lang.WALLET.TRANSFER_CREA_TITLE,text:this.lang.WALLET.TRANSFER_CREA_TEXT,button:this.lang.BUTTON.CONFIRM,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance)};break;case"transfer_to_savings_crea":ax={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:true};break;case"transfer_to_savings_cbd":ax={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance),to:this.session.account.username,disableTo:true};break;case"transfer_from_savings_cbd":ax={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CBD,text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.savings_cbd_balance)};break;case"transfer_from_savings_crea":ax={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CREA,text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.savings_balance)};break;case"transfer_to_vests":ax={title:this.lang.WALLET.CONVERT_CGY_TITLE,text:this.lang.WALLET.CONVERT_CGY_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:true};break;case"transfer_cbd":ax={title:this.lang.WALLET.TRANSFER_CBD_TITLE,text:this.lang.WALLET.TRANSFER_CBD_TEXT,button:this.lang.BUTTON.SEND,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance)};break}ax.op=ay;y.config=Object.assign(clone(a),ax)},canWithdraw:function af(){return this.session&&this.session.account.username==av.user.name},parseAsset:function am(ay){var az=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var ax=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return Asset.parse(ay).toFriendlyString(az,ax)},assetPart:function N(ay,ax){ay=Asset.parse(ay);switch(ax){case"int":return ay.toPlainString(null,false).split(".")[0];case"dec":return ay.toPlainString(null,false).split(".")[1];case"sym":return ay.asset.symbol;default:return Asset.parse(ay).toFriendlyString(null,true)}},openPost:showPost,showProfile:showProfile,getJoinDate:function T(){var ax=new Date(this.state.user.created);return this.lang.PROFILE.JOINED+moment(ax.getTime(),"x").format("MMMM YYYY")},getBuzzClass:function S(az){var ay={};var ax=az.buzz.level_name;ay[ax]=true;return ay},getFeaturedImage:function ak(ay){var ax=ay.metadata.featuredImage;if(ax&&ax.hash){return{url:apiOptions.ipfs+ax.hash}}else{if(ax&&ax.url){return ax}}return{}},getTags:function G(ay){var ax=ay.metadata.tags;var az=[];ax=ax.slice(0,7);ax.forEach(function(aA){az.push('<a href="/search?page=1&query='+encodeURIComponent(aA)+'">'+aA+"</a>")});return az.join(", ")},getLinkedTags:function an(ax,ay){var az=[];if(ax){ax.forEach(function(aA){az.push('<a href="/search?page=1&query='+encodeURIComponent(aA)+'">'+aA+"</a>")});if(ay){return az.join(", ")}}return az},hasPaid:function L(az){var ay=new Date();var ax=toLocaleDate(az.cashout_time);return ay.getTime()>ax.getTime()},getPayoutPostDate:function al(ay){var ax=toLocaleDate(ay.cashout_time);if(this.hasPaid(ay)){ax=toLocaleDate(ay.last_payout)}return moment(ax).fromNow()},hasPromotion:function Z(ay){var ax=Asset.parseString(ay.promoted);return ax.amount>0},getPromotion:function ar(ay){var ax=Asset.parseString(ay.promoted);return"$ "+ax.toPlainString()},parseJSON:function Y(ax){if(ax&&ax.length>0){try{return JSON.parse(ax)}catch(ay){catchError(ay)}}return{}},getPayout:function Q(ay){var ax=Asset.parseString(ay.pending_payout_value);if(this.hasPaid(ay)){ax=Asset.parseString(ay.total_payout_value);ax=ax.add(Asset.parseString(ay.curator_payout_value))}return"$ "+ax.toPlainString()},getPendingPayouts:function K(aE){var aG=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"});var aA=this.state.props.cbd_print_rate;var ay=10000;var aC=Asset.parseString(aE.pending_payout_value);var aB=aC;var aH=aE.percent_crea_dollars/20000;var az=Asset.parse({amount:aB.toFloat()*aH,nai:"cbd"});var aD=Asset.parse({amount:NaNOr(((aB.toFloat()-az.toFloat())/aG.toFloat()),0),nai:"cgy"});var aF=Asset.parse({amount:NaNOr((az.toFloat()*(aA/ay)),0),nai:"cbd"});var ax=Asset.parse({amount:NaNOr(((az.toFloat()-aF.toFloat())/aG.toFloat()),0),nai:"crea"});return"("+aF.toFriendlyString(null,false)+", "+ax.toFriendlyString(null,false)+", "+aD.toFriendlyString(null,false)},dateFromNow:function F(ax){return moment(toLocaleDate(ax)).fromNow()},getFutureDate:function aw(ax){return moment(toLocaleDate(ax)).fromNow()},onFollow:function I(ay,ax){updateUserSession()},onVote:function ai(aA,ax,ay){catchError(aA);var az=this;getDiscussion(ay.author,ay.permlink,function(aD,aB){if(!aD){var aC=parsePost(aB);az.state.content[aC.link]=aC;az.$forceUpdate()}})},getLicense:function ap(ax){if(ax){return License.fromFlag(ax)}return new License(LICENSE.FREE_CONTENT)},getCGYReward:function H(){var ax=parseFloat(this.state.user.reward_vesting_crea.split(" ")[0]);return ax+" CGY"},getCGYBalance:function aj(){return vestingCrea(this.state.user,this.state.props)},hasRewardBalance:function aq(){var ax=Asset.parse(this.state.user.reward_crea_balance);var az=Asset.parse(this.state.user.reward_cbd_balance);var ay=Asset.parse(this.state.user.reward_vesting_balance);return ax.amount>0||az.amount>0||ay.amount>0},cancelPowerDown:function W(ax){cancelEventPropagation(ax);var ay=this.session.account.username;requireRoleKey(ay,"active",function(aA){globalLoading.show=true;var az=new Vests(0);crea.broadcast.withdrawVesting(aA,ay,az.toFriendlyString(null,false),function(aC,aB){globalLoading.show=false;if(!catchError(aC)){updateUserSession()}})})},navigateTo:function ae(ay,ax){cancelEventPropagation(ay);updateUrl("/@"+this.state.user.name+"/"+ax);this.navbar.section=ax},isUserProfile:function ac(){if(this.session){return this.session.account.username===av.user.name}return false},onLoadAvatar:function aa(aB){var aA=aB.target.files;if(aA.length>0){globalLoading.show=true;var az=this;var ay=aA[0];var ax=CONSTANTS.FILE_MAX_SIZE.PROFILE[ay.type.toUpperCase().split("/")[0]];resizeImage(ay,function(aC){uploadToIpfs(aC,ax,function(aD,aE){globalLoading.show=false;if(!catchError(aD)){Vue.set(az.profile,"avatar",aE)}})})}},loadAvatar:function V(ax){cancelEventPropagation(ax);$("#profile-edit-input-avatar").click()},suggestPassword:function ao(){this.changePass.newPass="P"+crea.formatter.createSuggestedPassword()},claimRewards:C,sendAccountUpdate:c,ignoreUser:function(ay){function ax(){return ay.apply(this,arguments)}ax.toString=function(){return ay.toString()};return ax}(function(){ignoreUser(this.state.user.name,true,function(ay,ax){updateUserSession()})}),changePassword:function at(){var ay=this;var ax=function ax(aA){ay.changePass.error=aA;globalLoading.show=false};globalLoading.show=true;if(this.changePass.oldPass){if(this.changePass.newPass&&this.changePass.newPass===this.changePass.matchedPass){if(this.changePass.checkedLostPass&&this.changePass.checkedStoredPass){var az=Session.create(this.changePass.username,this.changePass.oldPass);az.login(function(aC,aA){if(aC){if(aC===Errors.USER_LOGIN_ERROR){ax(ay.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD)}}else{var aB=Account.generate(ay.changePass.username,ay.changePass.newPass).keys;c(null,aB,function(aF,aD){var aE=Session.getAlive();if(aE){aE.logout();goTo("/")}})}})}else{ax(ay.lang.CHANGE_PASSWORD.ERROR_CONDITIONS)}}else{ax(ay.lang.CHANGE_PASSWORD.ERROR_MATCHED_PASSWORDS)}}else{ax(ay.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD)}}}})}else{console.log("Updating data");l.state=av;l.session=ad;l.account=M;l.filter=P;l.profile=av.user.metadata;l.navbar.section=ah;l.changePass.username=ad?ad.account.username:null}l.$forceUpdate();creaEvents.emit("crea.dom.ready")}function E(F,G){if(G&&G.account.username===F.user.name){m(F,G);g(F,G)}}function b(I,M,H){var G=I.replace("s","").replace("-","_");var K={rewards24Vests:0,rewardsWeekVests:0,totalRewardsVests:0,rewards24Crea:0,rewardsWeekCrea:0,totalRewardsCrea:0,rewards24CBD:0,rewardsWeekCBD:0,totalRewardsCBD:0};var N=new Date();var O=60*60*24*1000;var L=new Date(N.getTime()-O).getTime();var Q=new Date(N.getTime()-7*O).getTime();var F,S;var J=[];H.user.transfer_history.sort(function(U,T){var W=toLocaleDate(U[1].timestamp);var V=toLocaleDate(T[1].timestamp);return V.getTime()-W.getTime()});H.user.transfer_history.forEach(function(V){if(V[1].op[0]==="author_reward"&&G==="author_reward"){if(!S){S=new Date(V[1].timestamp).getTime()}F=new Date(V[1].timestamp).getTime();var U=Asset.parseString(V[1].op[1].vesting_payout);var X=Asset.parseString(V[1].op[1].crea_payout);var W=Asset.parseString(V[1].op[1].cbd_payout);if(F>Q){if(F>L){K.rewards24Vests+=U.toFloat();K.rewards24Crea+=X.toFloat();K.rewards24CBD+=W.toFloat()}K.rewardsWeekVests+=U.toFloat();K.rewardsWeekCrea+=X.toFloat();K.rewardsWeekCBD+=W.toFloat()}K.totalRewardsVests+=U.toFloat();K.totalRewardsCrea+=X.toFloat();K.totalRewardsCBD+=W.toFloat();J.push(V)}else{if(V[1].op[0]==="curation_reward"&&G==="curation_reward"){if(!S){S=new Date(V[1].timestamp).getTime()}F=new Date(V[1].timestamp).getTime();var T=Asset.parseString(V[1].op[1].reward);if(F>Q){if(F>L){K.rewards24Vests+=T.toFloat()}K.rewardsWeekVests+=T.toFloat()}K.totalRewardsVests+=T.toFloat();J.push(V)}}});if(!f[I]){f[I]=new Vue({el:"#profile-"+I,data:{lang:lang,session:M,state:H,rewards:K,rewardsOp:J},methods:{vestsToCgy:function(U){function T(V){return U.apply(this,arguments)}T.toString=function(){return U.toString()};return T}(function(T){return vestsToCgy(this.state,T)}),parseAsset:Asset.parse,formatTime:function P(T){return moment(T).format("DD MMM HH:MM")}}})}else{f[I].session=M;f[I].state=H;f[I].rewards=K;f[I].rewardsOp=J}}function r(H,G,F){if(!j){j=new Vue({el:"#blocked-container",data:{lang:lang,session:H,account:G,blocked:F},methods:{unlock:function I(J){ignoreUser(J,false,function(L,K){if(!catchError(L)){updateUserSession()}})}}})}else{j.session=H;j.account=G;j.blocked=F}}function w(I,J,H,G){if(!u){u=new Vue({el:"#following-container",data:{lang:lang,state:I,session:J,account:H,following:G},methods:{onFollow:function F(){updateUserSession()}}})}else{u.state=I;u.session=J;u.account=H;u.following=G}}function t(H,J,G,I){if(!q){q=new Vue({el:"#follower-container",data:{lang:lang,state:H,session:J,account:G,follower:I},methods:{onFollow:function F(){updateUserSession()}}})}else{q.state=H;q.session=J;q.account=G;q.follower=I}}function d(F){var G=getPathPart().replace("@","");B(G,"transfers",function(H,I){if(!catchError(H)){b("author-rewards",F,I);b("curation-rewards",F,I)}})}function h(G,F){if(G){crea.api.getFollowing(G.account.username,"","ignore",1000,function(J,H){if(!catchError(J)){var I=[];H=H.following;H.forEach(function(K){if(K.follower===G.account.username){if(!I.includes(K.following)){I.push(K.following)}}});if(I.length){crea.api.getAccounts(I,function(M,L){if(!catchError(M)){var N={};for(var K=0;K<L.length;K++){var O=L[K];O.metadata=jsonify(O.json_metadata);N[O.name]=O}r(G,F,N)}})}else{console.log("Not blockeds");r(G,F,{})}}})}}function n(H,I,G){var F=function F(J){crea.api.getAccounts(J.user.followings,function(M,K){if(!catchError(M)){var L={};K.forEach(function(N){N.metadata=jsonify(N.json_metadata);N.metadata.avatar=N.metadata.avatar||{};L[N.name]=N});w(H,I,G,L)}})};if(G&&H.user.name===G.user.name){F(G)}else{crea.api.getFollowing(H.user.name,"","blog",1000,function(L,J){if(!catchError(L)){var K=[];J.following.forEach(function(M){K.push(M.following)});H.user.followings=K;F(H)}})}}function k(H,I,G){var F=function F(J){crea.api.getAccounts(J.user.followers,function(M,K){if(!catchError(M)){var L={};K.forEach(function(N){N.metadata=jsonify(N.json_metadata);N.metadata.avatar=N.metadata.avatar||{};L[N.name]=N});t(H,I,G,L)}})};crea.api.getFollowers(H.user.name,"","blog",1000,function(L,J){if(!catchError(L)){var K=[];J.followers.forEach(function(M){K.push(M.follower)});H.user.followers=K;F(H)}})}function A(I,J,H,F){var K=getPathPart(1);var G="balances";if(!K||K.isEmpty()){K="projects"}switch(K){case"balances":case"passwords":case"permissions":G=K;K="wallet"}K=K.toLowerCase();s(I,J,H,F,K,G);E(I,J);p(I.user.name);d(J);h(J,H);n(I,J,H);k(I,J,H)}function c(F,O,N){var G=toLocaleDate(l.state.user.last_account_update);var H=new Date();var I=H.getTime()-G.getTime();if(I>=CONSTANTS.ACCOUNT.UPDATE_THRESHOLD){var K=Session.getAlive();if(K){var L=l.profile;L.tags=$("#profile-edit-tags").val().split(" ");L=jsonstring(L);if(!O){var J=l.state.user;O={memo:{pub:J.memo_key},active:{pub:J.active.key_auths[0][0]},posting:{pub:J.posting.key_auths[0][0]},owner:{pub:J.owner.key_auths[0][0]}}}requireRoleKey(K.account.username,"owner",function(Q){crea.broadcast.accountUpdate(Q,K.account.username,createAuth(O.owner.pub),createAuth(O.active.pub),createAuth(O.posting.pub),O.memo.pub,L,function(S,T){globalLoading.show=false;if(S){if(N){N(S)}}else{updateUserSession();if(N){N(null,T)}}})})}else{globalLoading.show=false;if(N){N(Errors.USER_NOT_LOGGED)}}}else{var M=lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.TITLE;var P=String.format(lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.BODY,moment(G).fromNow());showAlert(M,P)}}function p(F){setTimeout(function(){crea.api.getAccountHistory(F,-1,50,function(I,G){if(!catchError(I)){G.history=G.history.reverse();var H=[];var J=[];G.history.forEach(function(K){K=K[1];var L=function L(M){if(M&&H.indexOf(M)<0){H.push(M)}};if(K.op.type==="transfer_operation"){L(K.op.value.from);L(K.op.value.to)}else{if(K.op.type==="transfer_to_vesting_operation"){L(K.op.value.from);L(K.op.value.to)}else{if(K.op.type==="transfer_to_savings_operation"){L(K.op.value.from);L(K.op.value.to)}else{if(K.op.type==="vote_operation"){L(K.op.value.voter);L(K.op.value.author)}else{if(K.op.type==="comment_operation"){L(K.op.value.parent_author);L(K.op.value.author)}else{if(K.op.type==="producer_reward_operation"){L(K.op.value.producer)}else{if(K.op.type==="account_create_operation"){L(K.op.value.creator)}else{if(K.op.type==="curation_reward_operation"){L(K.op.value.curator);L(K.op.value.comment_author)}}}}}}}}J.push(K)});crea.api.getAccounts(H,function(M,K){if(M){console.error(M)}else{var L={};H.forEach(function(O){for(var N=0;N<K.length;N++){if(O===K[N].name){L[O]=K[N];L[O].metadata=jsonify(L[O].json_metadata);L[O].metadata.avatar=L[O].metadata.avatar||{};break}}});l.history.data=J;l.history.accounts=L}})}})})}function B(I){var F=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var H=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var G;if(!I.startsWith("/@")){G="/@"+I}else{G=I}if(F){if(typeof F==="string"){G=G+"/"+F}else{if(typeof F==="function"){H=F}}}crea.api.getState(G,function(J,K){if(J){if(H){H(J)}}else{K.content={};K.discussion_idx={"":[]};x(function(P,O){var N=Object.keys(K.accounts);N.forEach(function(S){K.accounts[S]=parseAccount(K.accounts[S])});if(K.accounts[I]){K.user=K.accounts[I];crea.formatter.estimateAccountValue(K.user).then(function(S){K.user.estimate_account_value=S})}O.sort(function(V,U){var T=toLocaleDate(V.created);var S=toLocaleDate(U.created);return S.getTime()-T.getTime()});for(var M=0;M<O.length;M++){var Q=O[M];var L=Q.author+"/"+Q.permlink;K.content[L]=Q;K.discussion_idx[""].push(L)}if(H){H(P,K)}})}})}function D(I,H){var F=getPathPart();F=F.replace("@","");if(F){var J=function J(N,O){if(!catchError(N)){var M=Object.keys(O.content);if(l){O.content=Object.assign(l.state.content,O.content);M=M.concat(l.state.discussion_idx[""])}M=Array.trim(M);console.log(clone(O.content));console.log("Posts:",M);for(var K=0;K<M.length;K++){var L=M[K];O.content[L]=parsePost(O.content[L])}M.sort(function(T,S){var Q=new Date(O.content[T].created);var P=new Date(O.content[S].created);return P.getTime()-Q.getTime()});O.discussion_idx[""]=M;A(O,I,H,F)}};if(I&&H){if(I.account.username===F){var G=clone(H);B(F,J)}else{B(F,J)}}else{B(F,J)}}}function C(G){if(G){G.preventDefault()}var F=l.state.user.reward_crea_balance;var I=l.state.user.reward_cbd_balance;var H=l.state.user.reward_vesting_balance;requireRoleKey(l.session.account.username,"posting",function(J){globalLoading.show=true;crea.broadcast.claimRewardBalance(J,l.session.account.username,F,I,H,function(L,K){globalLoading.show=false;if(!catchError(L)){updateUserSession()}})})}function i(H,M,I,L,G,F,K){if(typeof F==="function"){K=F;F=""}if(I){var J=I.account.username;switch(M){case CONSTANTS.TRANSFER.TRANSFER_CREA:case CONSTANTS.TRANSFER.TRANSFER_CBD:crea.broadcast.transfer(H,J,L,G,F,K);break;case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CBD:crea.broadcast.transferToSavings(H,J,L,G,F,K);break;case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CBD:crea.broadcast.transferFromSavings(H,J,parseInt(new Date().getTime()/1000),L,G,F,K);break;case CONSTANTS.TRANSFER.TRANSFER_TO_VESTS:crea.broadcast.transferToVesting(H,J,L,G,K);break}}else{if(K){K(Errors.USER_NOT_LOGGED)}}}function e(H,G){var F=getPathPart(1);if(H){if(F){var I=getPathPart();if("@"+H.account.username!==I){showProfile(I);return}}G.user.cgy_balance="0.000 "+apiOptions.symbol.CGY;if(H.account.username===G.user.name){a={op:"transfer_crea",title:lang.WALLET.TRANSFER_CREA_TITLE,text:lang.WALLET.TRANSFER_CREA_TEXT,button:lang.BUTTON.SEND,total_amount:Asset.parseString("0.000 CREA").toFriendlyString(),nai:apiOptions.symbol.CREA,confirmed:false,to:null,disableTo:false}}}else{if(F){var I=getPathPart();showProfile(I);return}}D(H,G)}creaEvents.on("crea.session.login",e);creaEvents.on("crea.session.update",e);function x(G){if(!z){z=1}var F=new HttpClient(apiOptions.apiUrl+"/creary/blog");F.when("done",function(H){var L=jsonify(H).data;++z;var K=[];var J=L.length;var I=function(){--J;if(J<=0){if(G){G(null,K)}}};L.forEach(function(N){var M=N.author+"/"+N.permlink;crea.api.getContent(N.author,N.permlink,function(P,O){if(P){console.error("Error getting",M,P)}else{var Q=parsePost(O);Q.reblogged_by=N.reblogged_by;K.push(Q);I()}})});if(L.length===0){I();--z}});F.when("fail",function(H,J,I){v=false;catchError(J);--z});refreshAccessToken(function(H){F.headers={Authorization:"Bearer "+H};F.post({author:getPathPart().replace("@",""),page:z})})}var v;var z;creaEvents.on("crea.scroll.bottom",function(){if(!v){v=true;if(z){x(function(J,I){I.sort(function(O,N){var M=toLocaleDate(O.created);var L=toLocaleDate(N.created);return L.getTime()-M.getTime()});for(var G=0;G<I.length;G++){var K=I[G];var F=K.author+"/"+K.permlink;l.state.content[F]=K;l.state.discussion_idx[""].push(F)}var H=l.state.discussion_idx[""];z=l.state.content[H[H.length-1]];l.$forceUpdate();v=false})}}})})();