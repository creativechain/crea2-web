"use strict";var profileContainer;(function(){var f={};var j;var t;var p;var x;var n;var a;function g(F,L){console.log("Modal De-Energize",jsonify(jsonstring(F)));var M=parseFloat(vestingCrea(F.user,F.props).toPlainString(null,false));var H=parseFloat(delegatedCrea(F.user,F.props).toPlainString(null,false));var O=M-H;var P=vestsToCgy(F,new Vests(F.user.withdrawn).toFriendlyString(null,false),apiOptions.nai.CREA);var J=vestsToCgy(F,new Vests(F.user.to_withdraw).toFriendlyString(null,false),apiOptions.nai.CREA);var N="";if(J.amount-P.amount>0){N=String.format(lang.WALLET.DE_ENERGIZE_TEXT,J.toFriendlyString(null,false),P.toFriendlyString(null,false))}if(!n){n=new Vue({el:"#wallet-de-energize",data:{lang:lang,session:L,state:F,maxPowerDown:O,finalAmount:0,sliderValue:0,amountByWeek:"",withdrawNote:N},methods:{formatString:String.format,onAmount:function I(Q){Q+=0.0001;var S=Asset.parse({amount:Q,nai:apiOptions.nai.CREA});this.amountByWeek=Q<0.001?"":String.format(this.lang.WALLET.DE_ENERGIZE_AMOUNT_BY_WEEK,S.divide(8).toFriendlyString(null,false))},onManualChange:function K(S){if(S){var Q=S.target.valueAsNumber;if(isNaN(Q)){Q=0}this.onAmount(Q)}},hideModalDeEnergize:function E(Q){cancelEventPropagation(Q);$("#wallet-de-energize").parent().removeClass("modal-active")},makeDeEnergize:function G(T,Q){cancelEventPropagation(T);var S=this;var U=this.session.account.username;requireRoleKey(U,"active",function(X){globalLoading.show=true;var V=S.finalAmount+" CREA";console.log(V);var W=cgyToVests(S.state,V);crea.broadcast.withdrawVesting(X,U,W.toFriendlyString(null,false),function(Z,Y){globalLoading.show=false;if(!catchError(Z)){S.hideModalDeEnergize();updateUserSession()}})})}}})}else{n.session=L;n.state=F}}function l(F,M){if(!x){x=new Vue({el:"#wallet-send",data:{CONSTANTS:CONSTANTS,session:M,state:F,lang:lang,from:F.user.name,amount:0,memo:"",config:clone(a),toError:false},mounted:function E(){var O=this;$("#wallet-send").on("modalClosed.modals.mr",function(){O.clearFields()})},methods:{shouldShowMemo:function L(){var O=["transfer_to_vests","transfer_to_savings_crea","transfer_to_savings_cbd"];return !O.includes(this.config.op)},cancelSend:function N(O){cancelEventPropagation(O);this.config.confirmed=false},hideModalSend:function G(O){cancelEventPropagation(O);$("#wallet-send").removeClass("modal-active");this.clearFields()},clearFields:function I(){this.amount=0;this.memo="";this.config=clone(a)},useTotalAmount:function K(O){cancelEventPropagation(O);this.amount=this.config.total_amount.toPlainString()},sendCrea:function H(){if(this.toError||!this.amount){}else{if(this.config.confirmed){var Q=this;var P={amount:Q.amount,nai:Q.config.nai.toLowerCase(),round:true};var O=Asset.parse(P).toFriendlyString(null,false);requireRoleKey(this.session.account.username,"active",function(S){globalLoading.show=true;console.log("Key:",S,Q.config.op);i(S,Q.config.op,Q.session,Q.config.to,O,Q.memo,function(U,T){globalLoading.show=false;if(!catchError(U)){if(T){updateUserSession();Q.hideModalSend()}}})})}else{this.config.confirmed=true;this.config.button=this.lang.BUTTON.SEND}}},validateDestiny:function J(Q){var S=Q.target.value;if(!crea.utils.validateAccountName(S)){var P=[S];console.log("Checking",P);var O=this;crea.api.lookupAccountNames(P,function(U,T){if(U){console.error(U);O.toError=true}else{O.toError=T[0]==null}})}else{this.toError=true}}}})}else{x.state=F;x.session=M;x.from=F.user.name}}function r(au,ac,L,O){var ag=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"projects";var af=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"balance";var W=null;if(au.user.to_withdraw>0&&ac&&au.user.name===ac.account.username){W=String.format(lang.WALLET.NEXT_DE_ENERGIZE,moment(toLocaleDate(au.user.next_vesting_withdrawal)).fromNow())}if(!profileContainer){profileContainer=new Vue({el:"#profile-container",data:{CONSTANTS:CONSTANTS,lang:lang,isoLangs:isoLangs,session:ac,account:L,state:au,filter:O,navbar:{section:ag},profile:au.user.metadata,walletTab:af,history:{data:[],accounts:{}},blocked:{},showPriv:{posting:false,active:false,owner:false,memo:false},changePass:{username:ac?ac.account.username:null,oldPass:null,newPass:null,matchedPass:null,checkedLostPass:false,checkedStoredPass:false,error:null},nextDeEnergize:W,simpleView:false},updated:function I(){var ax=$("#wallet-tabs").prev();if(ax.is(":empty")){ax.remove()}var aw=$("#profile-edit-tags");aw.tagsinput({maxTags:CONSTANTS.MAX_TAGS,maxChars:CONSTANTS.TEXT_MAX_SIZE.TAG,delimiter:" "});if(this.profile.tags){this.profile.tags.forEach(function(ay){aw.tagsinput("add",ay)})}},methods:{isFeed:function(){return false},getDefaultAvatar:R.getAvatar,toUrl:toUrl,hidePrivKey:function aa(aw){this.showPriv[aw]=false},getPrivKey:function T(ax){var aw=this;var ay=this.session?this.session.account.username:"";requireRoleKey(ay,ax,function(az){aw.showPriv[ax]=az})},getKey:function N(aw){if(this.showPriv[aw]){return this.showPriv[aw]}else{if(aw==="memo"){return au.user.memo_key}else{return au.user[aw].key_auths[0][0]}}},prepareModal:function at(ax){var aw;switch(ax){case"transfer_crea":aw={title:this.lang.WALLET.TRANSFER_CREA_TITLE,text:this.lang.WALLET.TRANSFER_CREA_TEXT,button:this.lang.BUTTON.CONFIRM,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance)};break;case"transfer_to_savings_crea":aw={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:true};break;case"transfer_to_savings_cbd":aw={title:this.lang.WALLET.TRANSFER_TO_SAVINGS_TITLE,text:this.lang.WALLET.TRANSFER_TO_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance),to:this.session.account.username,disableTo:true};break;case"transfer_from_savings_cbd":aw={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CBD,text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.savings_cbd_balance)};break;case"transfer_from_savings_crea":aw={title:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TITLE_CREA,text:this.lang.WALLET.TRANSFER_FROM_SAVINGS_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.savings_balance)};break;case"transfer_to_vests":aw={title:this.lang.WALLET.CONVERT_CGY_TITLE,text:this.lang.WALLET.CONVERT_CGY_TEXT,button:this.lang.BUTTON.TRANSFER,nai:apiOptions.symbol.CREA,total_amount:Asset.parseString(this.state.user.balance),to:this.session.account.username,disableTo:true};break;case"transfer_cbd":aw={title:this.lang.WALLET.TRANSFER_CBD_TITLE,text:this.lang.WALLET.TRANSFER_CBD_TEXT,button:this.lang.BUTTON.SEND,nai:apiOptions.symbol.CBD,total_amount:Asset.parseString(this.state.user.cbd_balance)};break}aw.op=ax;x.config=Object.assign(clone(a),aw)},canWithdraw:function ae(){return this.session&&this.session.account.username==au.user.name},parseAsset:function al(ax){var ay=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var aw=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return Asset.parse(ax).toFriendlyString(ay,aw)},assetPart:function M(ax,aw){ax=Asset.parse(ax);switch(aw){case"int":return ax.toPlainString(null,false).split(".")[0];case"dec":return ax.toPlainString(null,false).split(".")[1];case"sym":return ax.asset.symbol;default:return Asset.parse(ax).toFriendlyString(null,true)}},openPost:showPost,showProfile:showProfile,getJoinDate:function S(){var aw=new Date(this.state.user.created);return this.lang.PROFILE.JOINED+moment(aw.getTime(),"x").format("MMMM YYYY")},getBuzzClass:function Q(ay){var ax={};var aw=ay.buzz.level_name;ax[aw]=true;return ax},getFeaturedImage:function aj(ax){var aw=ax.metadata.featuredImage;if(aw&&aw.hash){return{url:apiOptions.ipfs+aw.hash}}else{if(aw&&aw.url){return aw}}return{}},getTags:function F(ax){var aw=ax.metadata.tags;var ay=[];aw=aw.slice(0,7);aw.forEach(function(az){ay.push('<a href="/search?page=1&query='+encodeURIComponent(az)+'">'+az+"</a>")});return ay.join(", ")},getLinkedTags:function am(aw,ax){var ay=[];if(aw){aw.forEach(function(az){ay.push('<a href="/search?page=1&query='+encodeURIComponent(az)+'">'+az+"</a>")});if(ax){return ay.join(", ")}}return ay},hasPaid:function K(ay){var ax=new Date();var aw=toLocaleDate(ay.cashout_time);return ax.getTime()>aw.getTime()},getPayoutPostDate:function ak(ax){var aw=toLocaleDate(ax.cashout_time);if(this.hasPaid(ax)){aw=toLocaleDate(ax.last_payout)}return moment(aw).fromNow()},hasPromotion:function Y(ax){var aw=Asset.parseString(ax.promoted);return aw.amount>0},getPromotion:function aq(ax){var aw=Asset.parseString(ax.promoted);return"$ "+aw.toPlainString()},parseJSON:function X(aw){if(aw&&aw.length>0){try{return JSON.parse(aw)}catch(ax){catchError(ax)}}return{}},getPayout:function P(ax){var aw=Asset.parseString(ax.pending_payout_value);if(this.hasPaid(ax)){aw=Asset.parseString(ax.total_payout_value);aw=aw.add(Asset.parseString(ax.curator_payout_value))}return"$ "+aw.toPlainString()},getPendingPayouts:function J(aD){var aF=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"});var az=this.state.props.cbd_print_rate;var ax=10000;var aB=Asset.parseString(aD.pending_payout_value);var aA=aB;var aG=aD.percent_crea_dollars/20000;var ay=Asset.parse({amount:aA.toFloat()*aG,nai:"cbd"});var aC=Asset.parse({amount:NaNOr(((aA.toFloat()-ay.toFloat())/aF.toFloat()),0),nai:"cgy"});var aE=Asset.parse({amount:NaNOr((ay.toFloat()*(az/ax)),0),nai:"cbd"});var aw=Asset.parse({amount:NaNOr(((ay.toFloat()-aE.toFloat())/aF.toFloat()),0),nai:"crea"});return"("+aE.toFriendlyString(null,false)+", "+aw.toFriendlyString(null,false)+", "+aC.toFriendlyString(null,false)},dateFromNow:function E(aw){return moment(toLocaleDate(aw)).fromNow()},getFutureDate:function av(aw){return moment(toLocaleDate(aw)).fromNow()},onFollow:function H(ax,aw){updateUserSession()},onVote:function ah(az,aw,ax){catchError(az);var ay=this;getDiscussion(ax.author,ax.permlink,function(aC,aA){if(!aC){var aB=parsePost(aA);ay.state.content[aB.link]=aB;ay.$forceUpdate()}})},getLicense:function ao(aw){if(aw){return License.fromFlag(aw)}return new License(LICENSE.FREE_CONTENT)},getCGYReward:function G(){var aw=parseFloat(this.state.user.reward_vesting_crea.split(" ")[0]);return aw+" CGY"},getCGYBalance:function ai(){return vestingCrea(this.state.user,this.state.props)},hasRewardBalance:function ap(){var aw=Asset.parse(this.state.user.reward_crea_balance);var ay=Asset.parse(this.state.user.reward_cbd_balance);var ax=Asset.parse(this.state.user.reward_vesting_balance);return aw.amount>0||ay.amount>0||ax.amount>0},cancelPowerDown:function V(aw){cancelEventPropagation(aw);var ax=this.session.account.username;requireRoleKey(ax,"active",function(az){globalLoading.show=true;var ay=new Vests(0);crea.broadcast.withdrawVesting(az,ax,ay.toFriendlyString(null,false),function(aB,aA){globalLoading.show=false;if(!catchError(aB)){updateUserSession()}})})},navigateTo:function ad(ax,aw){cancelEventPropagation(ax);updateUrl("/@"+this.state.user.name+"/"+aw);this.navbar.section=aw},isUserProfile:function ab(){if(this.session){return this.session.account.username===au.user.name}return false},onLoadAvatar:function Z(aA){var az=aA.target.files;if(az.length>0){globalLoading.show=true;var ay=this;var ax=az[0];var aw=CONSTANTS.FILE_MAX_SIZE.PROFILE[ax.type.toUpperCase().split("/")[0]];resizeImage(ax,function(aB){uploadToIpfs(aB,aw,function(aC,aD){globalLoading.show=false;if(!catchError(aC)){Vue.set(ay.profile,"avatar",aD)}})})}},loadAvatar:function U(aw){cancelEventPropagation(aw);$("#profile-edit-input-avatar").click()},suggestPassword:function an(){this.changePass.newPass="P"+crea.formatter.createSuggestedPassword()},claimRewards:B,sendAccountUpdate:c,ignoreUser:function(ax){function aw(){return ax.apply(this,arguments)}aw.toString=function(){return ax.toString()};return aw}(function(){ignoreUser(this.state.user.name,true,function(ax,aw){updateUserSession()})}),changePassword:function ar(){var ax=this;var aw=function aw(az){ax.changePass.error=az;globalLoading.show=false};globalLoading.show=true;if(this.changePass.oldPass){if(this.changePass.newPass&&this.changePass.newPass===this.changePass.matchedPass){if(this.changePass.checkedLostPass&&this.changePass.checkedStoredPass){var ay=Session.create(this.changePass.username,this.changePass.oldPass);ay.login(function(aB,az){if(aB){if(aB===Errors.USER_LOGIN_ERROR){aw(ax.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD)}}else{var aA=Account.generate(ax.changePass.username,ax.changePass.newPass).keys;c(null,aA,function(aE,aC){var aD=Session.getAlive();if(aD){aD.logout();goTo("/")}})}})}else{aw(ax.lang.CHANGE_PASSWORD.ERROR_CONDITIONS)}}else{aw(ax.lang.CHANGE_PASSWORD.ERROR_MATCHED_PASSWORDS)}}else{aw(ax.lang.CHANGE_PASSWORD.ERROR_CURRENT_PASSWORD)}}}})}else{console.log("Updating data");profileContainer.state=au;profileContainer.session=ac;profileContainer.account=L;profileContainer.filter=O;profileContainer.profile=au.user.metadata;profileContainer.navbar.section=ag;profileContainer.changePass.username=ac?ac.account.username:null}profileContainer.$forceUpdate();creaEvents.emit("crea.dom.ready")}function D(E,F){if(F&&F.account.username===E.user.name){l(E,F);g(E,F)}}function b(H,L,G){var F=H.replace("s","").replace("-","_");var J={rewards24Vests:0,rewardsWeekVests:0,totalRewardsVests:0,rewards24Crea:0,rewardsWeekCrea:0,totalRewardsCrea:0,rewards24CBD:0,rewardsWeekCBD:0,totalRewardsCBD:0};var M=new Date();var N=60*60*24*1000;var K=new Date(M.getTime()-N).getTime();var P=new Date(M.getTime()-7*N).getTime();var E,Q;var I=[];G.user.transfer_history.sort(function(T,S){var V=toLocaleDate(T[1].timestamp);var U=toLocaleDate(S[1].timestamp);return U.getTime()-V.getTime()});G.user.transfer_history.forEach(function(U){if(U[1].op[0]==="author_reward"&&F==="author_reward"){if(!Q){Q=new Date(U[1].timestamp).getTime()}E=new Date(U[1].timestamp).getTime();var T=Asset.parseString(U[1].op[1].vesting_payout);var W=Asset.parseString(U[1].op[1].crea_payout);var V=Asset.parseString(U[1].op[1].cbd_payout);if(E>P){if(E>K){J.rewards24Vests+=T.toFloat();J.rewards24Crea+=W.toFloat();J.rewards24CBD+=V.toFloat()}J.rewardsWeekVests+=T.toFloat();J.rewardsWeekCrea+=W.toFloat();J.rewardsWeekCBD+=V.toFloat()}J.totalRewardsVests+=T.toFloat();J.totalRewardsCrea+=W.toFloat();J.totalRewardsCBD+=V.toFloat();I.push(U)}else{if(U[1].op[0]==="curation_reward"&&F==="curation_reward"){if(!Q){Q=new Date(U[1].timestamp).getTime()}E=new Date(U[1].timestamp).getTime();var S=Asset.parseString(U[1].op[1].reward);if(E>P){if(E>K){J.rewards24Vests+=S.toFloat()}J.rewardsWeekVests+=S.toFloat()}J.totalRewardsVests+=S.toFloat();I.push(U)}}});if(!f[H]){f[H]=new Vue({el:"#profile-"+H,data:{lang:lang,session:L,state:G,rewards:J,rewardsOp:I},methods:{vestsToCgy:function(T){function S(U){return T.apply(this,arguments)}S.toString=function(){return T.toString()};return S}(function(S){return vestsToCgy(this.state,S)}),parseAsset:Asset.parse,formatTime:function O(S){return moment(S).format("DD MMM HH:MM")}}})}else{f[H].session=L;f[H].state=G;f[H].rewards=J;f[H].rewardsOp=I}}function q(G,F,E){if(!j){j=new Vue({el:"#blocked-container",data:{lang:lang,session:G,account:F,blocked:E},methods:{unlock:function H(I){ignoreUser(I,false,function(K,J){if(!catchError(K)){updateUserSession()}})}}})}else{j.session=G;j.account=F;j.blocked=E}}function v(H,I,G,F){if(!t){t=new Vue({el:"#following-container",data:{lang:lang,state:H,session:I,account:G,following:F},methods:{onFollow:function E(){updateUserSession()}}})}else{t.state=H;t.session=I;t.account=G;t.following=F}}function s(G,I,F,H){if(!p){p=new Vue({el:"#follower-container",data:{lang:lang,state:G,session:I,account:F,follower:H},methods:{onFollow:function E(){updateUserSession()}}})}else{p.state=G;p.session=I;p.account=F;p.follower=H}}function d(E){var F=getPathPart().replace("@","");A(F,"transfers",function(G,H){if(!catchError(G)){b("author-rewards",E,H);b("curation-rewards",E,H)}})}function h(F,E){if(F){crea.api.getFollowing(F.account.username,"","ignore",1000,function(I,G){if(!catchError(I)){var H=[];G=G.following;G.forEach(function(J){if(J.follower===F.account.username){if(!H.includes(J.following)){H.push(J.following)}}});if(H.length){crea.api.getAccounts(H,function(L,K){if(!catchError(L)){var M={};for(var J=0;J<K.length;J++){var N=K[J];N.metadata=jsonify(N.json_metadata);M[N.name]=N}q(F,E,M)}})}else{console.log("Not blockeds");q(F,E,{})}}})}}function m(G,H,F){var E=function E(I){crea.api.getAccounts(I.user.followings,function(L,J){if(!catchError(L)){var K={};J.forEach(function(M){M.metadata=jsonify(M.json_metadata);M.metadata.avatar=M.metadata.avatar||{};K[M.name]=M});v(G,H,F,K)}})};if(F&&G.user.name===F.user.name){E(F)}else{crea.api.getFollowing(G.user.name,"","blog",1000,function(K,I){if(!catchError(K)){var J=[];I.following.forEach(function(L){J.push(L.following)});G.user.followings=J;E(G)}})}}function k(G,H,F){var E=function E(I){crea.api.getAccounts(I.user.followers,function(L,J){if(!catchError(L)){var K={};J.forEach(function(M){M.metadata=jsonify(M.json_metadata);M.metadata.avatar=M.metadata.avatar||{};K[M.name]=M});s(G,H,F,K)}})};crea.api.getFollowers(G.user.name,"","blog",1000,function(K,I){if(!catchError(K)){var J=[];I.followers.forEach(function(L){J.push(L.follower)});G.user.followers=J;E(G)}})}function z(H,I,G,E){var J=getPathPart(1);var F="balances";if(!J||J.isEmpty()){J="projects"}switch(J){case"balances":case"passwords":case"permissions":F=J;J="wallet"}J=J.toLowerCase();r(H,I,G,E,J,F);D(H,I);o(H.user.name);d(I);h(I,G);m(H,I,G);k(H,I,G)}function c(E,N,M){var F=toLocaleDate(profileContainer.state.user.last_account_update);var G=new Date();var H=G.getTime()-F.getTime();if(H>=CONSTANTS.ACCOUNT.UPDATE_THRESHOLD){var J=Session.getAlive();if(J){var K=profileContainer.profile;K.tags=$("#profile-edit-tags").val().split(" ");K=jsonstring(K);if(!N){var I=profileContainer.state.user;N={memo:{pub:I.memo_key},active:{pub:I.active.key_auths[0][0]},posting:{pub:I.posting.key_auths[0][0]},owner:{pub:I.owner.key_auths[0][0]}}}requireRoleKey(J.account.username,"owner",function(P){crea.broadcast.accountUpdate(P,J.account.username,createAuth(N.owner.pub),createAuth(N.active.pub),createAuth(N.posting.pub),N.memo.pub,K,function(Q,S){globalLoading.show=false;if(Q){if(M){M(Q)}}else{updateUserSession();if(M){M(null,S)}}})})}else{globalLoading.show=false;if(M){M(Errors.USER_NOT_LOGGED)}}}else{var L=lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.TITLE;var O=String.format(lang.ERROR.ACCOUNT_UPDATE_THRESHOLD_EXCEEDED.BODY,moment(F).fromNow());showAlert(L,O)}}function o(E){setTimeout(function(){crea.api.getAccountHistory(E,-1,50,function(H,F){if(!catchError(H)){F.history=F.history.reverse();var G=[];var I=[];F.history.forEach(function(J){J=J[1];var K=function K(L){if(L&&G.indexOf(L)<0){G.push(L)}};if(J.op.type==="transfer_operation"){K(J.op.value.from);K(J.op.value.to)}else{if(J.op.type==="transfer_to_vesting_operation"){K(J.op.value.from);K(J.op.value.to)}else{if(J.op.type==="transfer_to_savings_operation"){K(J.op.value.from);K(J.op.value.to)}else{if(J.op.type==="vote_operation"){K(J.op.value.voter);K(J.op.value.author)}else{if(J.op.type==="comment_operation"){K(J.op.value.parent_author);K(J.op.value.author)}else{if(J.op.type==="producer_reward_operation"){K(J.op.value.producer)}else{if(J.op.type==="account_create_operation"){K(J.op.value.creator)}else{if(J.op.type==="curation_reward_operation"){K(J.op.value.curator);K(J.op.value.comment_author)}}}}}}}}I.push(J)});crea.api.getAccounts(G,function(L,J){if(L){console.error(L)}else{var K={};G.forEach(function(N){for(var M=0;M<J.length;M++){if(N===J[M].name){K[N]=J[M];K[N].metadata=jsonify(K[N].json_metadata);K[N].metadata.avatar=K[N].metadata.avatar||{};break}}});profileContainer.history.data=I;profileContainer.history.accounts=K}})}})})}function A(H){var E=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var G=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var F;if(!H.startsWith("/@")){F="/@"+H}else{F=H}if(E){if(typeof E==="string"){F=F+"/"+E}else{if(typeof E==="function"){G=E}}}crea.api.getState(F,function(I,J){if(I){if(G){G(I)}}else{J.content={};J.discussion_idx={"":[]};w(function(O,N){var M=Object.keys(J.accounts);M.forEach(function(Q){J.accounts[Q]=parseAccount(J.accounts[Q])});if(J.accounts[H]){J.user=J.accounts[H];crea.formatter.estimateAccountValue(J.user).then(function(Q){J.user.estimate_account_value=Q})}N.sort(function(U,T){var S=toLocaleDate(U.created);var Q=toLocaleDate(T.created);return Q.getTime()-S.getTime()});for(var L=0;L<N.length;L++){var P=N[L];var K=P.author+"/"+P.permlink;J.content[K]=P;J.discussion_idx[""].push(K)}if(G){G(O,J)}})}})}function C(H,G){var E=getPathPart();E=E.replace("@","");if(E){var I=function I(M,N){if(!catchError(M)){var L=Object.keys(N.content);if(profileContainer){N.content=Object.assign(profileContainer.state.content,N.content);L=L.concat(profileContainer.state.discussion_idx[""])}L=L.unique();console.log(clone(N.content));console.log("Posts:",L);for(var J=0;J<L.length;J++){var K=L[J];N.content[K]=parsePost(N.content[K])}L.sort(function(S,Q){var P=new Date(N.content[S].created);var O=new Date(N.content[Q].created);return O.getTime()-P.getTime()});N.discussion_idx[""]=L;z(N,H,G,E)}};if(H&&G){if(H.account.username===E){var F=clone(G);A(E,I)}else{A(E,I)}}else{A(E,I)}}}function B(F){if(F){F.preventDefault()}var E=profileContainer.state.user.reward_crea_balance;var H=profileContainer.state.user.reward_cbd_balance;var G=profileContainer.state.user.reward_vesting_balance;requireRoleKey(profileContainer.session.account.username,"posting",function(I){globalLoading.show=true;crea.broadcast.claimRewardBalance(I,profileContainer.session.account.username,E,H,G,function(K,J){globalLoading.show=false;if(!catchError(K)){updateUserSession()}})})}function i(G,L,H,K,F,E,J){if(typeof E==="function"){J=E;E=""}if(H){var I=H.account.username;switch(L){case CONSTANTS.TRANSFER.TRANSFER_CREA:case CONSTANTS.TRANSFER.TRANSFER_CBD:crea.broadcast.transfer(G,I,K,F,E,J);break;case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_TO_SAVINGS_CBD:crea.broadcast.transferToSavings(G,I,K,F,E,J);break;case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CREA:case CONSTANTS.TRANSFER.TRANSFER_FROM_SAVINGS_CBD:crea.broadcast.transferFromSavings(G,I,parseInt(new Date().getTime()/1000),K,F,E,J);break;case CONSTANTS.TRANSFER.TRANSFER_TO_VESTS:crea.broadcast.transferToVesting(G,I,K,F,J);break}}else{if(J){J(Errors.USER_NOT_LOGGED)}}}function e(G,F){var E=getPathPart(1);if(G){if(E){var H=getPathPart();if("@"+G.account.username!==H){showProfile(H);return}}F.user.cgy_balance="0.000 "+apiOptions.symbol.CGY;if(G.account.username===F.user.name){a={op:"transfer_crea",title:lang.WALLET.TRANSFER_CREA_TITLE,text:lang.WALLET.TRANSFER_CREA_TEXT,button:lang.BUTTON.SEND,total_amount:Asset.parseString("0.000 CREA").toFriendlyString(),nai:apiOptions.symbol.CREA,confirmed:false,to:null,disableTo:false}}}else{if(E){var H=getPathPart();showProfile(H);return}}C(G,F)}creaEvents.on("crea.session.login",e);creaEvents.on("crea.session.update",e);function w(F){if(!y){y=1}var E=new HttpClient(apiOptions.apiUrl+"/creary/blog");E.when("done",function(G){var K=jsonify(G).data;++y;var J=[];var I=K.length;var H=function(){--I;if(I<=0){if(F){F(null,J)}}};K.forEach(function(M){var L=M.author+"/"+M.permlink;crea.api.getContent(M.author,M.permlink,function(O,N){if(O){console.error("Error getting",L,O)}else{var P=parsePost(N);P.reblogged_by=M.reblogged_by;J.push(P);H()}})});if(K.length===0){H();--y}});E.when("fail",function(G,I,H){u=false;catchError(I);--y});refreshAccessToken(function(G){E.headers={Authorization:"Bearer "+G};E.post({author:getPathPart().replace("@",""),page:y})})}var u;var y;creaEvents.on("crea.scroll.bottom",function(){if(!u){u=true;if(y){w(function(I,H){H.sort(function(N,M){var L=toLocaleDate(N.created);var K=toLocaleDate(M.created);return K.getTime()-L.getTime()});for(var F=0;F<H.length;F++){var J=H[F];var E=J.author+"/"+J.permlink;profileContainer.state.content[E]=J;profileContainer.state.discussion_idx[""].push(E)}var G=profileContainer.state.discussion_idx[""];y=profileContainer.state.content[G[G.length-1]];profileContainer.$forceUpdate();u=false})}}})})();