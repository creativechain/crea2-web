(function(e){function l(a,b){this.isInit=!0;this.itemsArray=[];this.$element=e(a);this.$element.addClass("sr-only");this.multiple=(this.isSelect="SELECT"===a.tagName)&&a.hasAttribute("multiple");this.objectItems=b&&b.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=e('<div class="bootstrap-tagsinput"></div>');this.$input=e('<input type="text" placeholder="'+this.placeholderText+
'"/>').appendTo(this.$container);this.$element.before(this.$container);this.build(b);this.isInit=!1}function m(a,b){if("function"!==typeof a[b]){var e=a[b];a[b]=function(b){return b[e]}}}function n(a,b){if("function"!==typeof a[b]){var e=a[b];a[b]=function(){return e}}}function k(a){return a?v.text(a).html():""}function p(a){var b=0;if(document.selection)a.focus(),b=document.selection.createRange(),b.moveStart("character",-a.value.length),b=b.text.length;else if(a.selectionStart||"0"==a.selectionStart)b=
a.selectionStart;return b}function w(a,b){var f=!1;e.each(b,function(b,d){if("number"===typeof d&&a.which===d||"string"===typeof d&&a.key===d)return f=!0,!1;if(a.which===d.which){b=!d.hasOwnProperty("altKey")||a.altKey===d.altKey;var c=!d.hasOwnProperty("shiftKey")||a.shiftKey===d.shiftKey;d=!d.hasOwnProperty("ctrlKey")||a.ctrlKey===d.ctrlKey;if(b&&c&&d)return f=!0,!1}});return f}var q={tagClass:function(a){return"badge badge-info"},focusClass:"focus",itemValue:function(a){return a?a.toString():a},
itemText:function(a){return this.itemValue(a)},itemTitle:function(a){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,32,44,","],alphanumeric:!0,invalidChars:[],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!1,onTagExists:function(a,b){},trimValue:!1,allowDuplicates:!1,triggerChange:!0};l.prototype={constructor:l,add:function(a,b,f){var c=this;if(!(c.options.maxTags&&c.itemsArray.length>=c.options.maxTags||!1!==a&&!a)){"string"===typeof a&&c.options.trimValue&&
(a=e.trim(a));if("object"===typeof a&&!c.objectItems)throw"Can't add objects when itemValue option is not set";if(!a.toString().match(/^\s*$/)){c.isSelect&&!c.multiple&&0<c.itemsArray.length&&c.remove(c.itemsArray[0]);if("string"===typeof a&&"INPUT"===this.$element[0].tagName){var d=a.split(c.options.delimiterRegex?c.options.delimiterRegex:c.options.delimiter);if(1<d.length){for(a=0;a<d.length;a++)this.add(d[a],!0);b||c.pushVal(c.options.triggerChange);return}}var h=c.options.itemValue(a);d=c.options.itemText(a);
var g=c.options.tagClass(a),r=c.options.itemTitle(a),t=e.grep(c.itemsArray,function(b){return c.options.itemValue(b)===h})[0];if(t&&!c.options.allowDuplicates)c.options.onTagExists&&(b=e(".badge",c.$container).filter(function(){return e(this).data("item")===t}),c.options.onTagExists(a,b));else if(!(c.items().toString().length+a.length+1>c.options.maxInputLength)){var u=e.Event("beforeItemAdd",{item:a,cancel:!1,options:f});c.$element.trigger(u);u.cancel||(c.itemsArray.push(a),g=e('<span class="badge '+
k(g)+(null!==r?'" title="'+r:"")+'">'+k(d)+'<span data-role="remove"></span></span>'),g.data("item",a),c.findInputWrapper().before(g),g.after(" "),g=e('option[value="'+encodeURIComponent(h)+'"]',c.$element).length||e('option[value="'+k(h)+'"]',c.$element).length,c.isSelect&&!g&&(d=e("<option selected>"+k(d)+"</option>"),d.data("item",a),d.attr("value",h),c.$element.append(d)),b||c.pushVal(c.options.triggerChange),c.options.maxTags!==c.itemsArray.length&&c.items().toString().length!==c.options.maxInputLength||
c.$container.addClass("bootstrap-tagsinput-max"),e(".typeahead, .twitter-typeahead",c.$container).length&&c.$input.typeahead("val",""),this.isInit?c.$element.trigger(e.Event("itemAddedOnInit",{item:a,options:f})):c.$element.trigger(e.Event("itemAdded",{item:a,options:f})))}}}},remove:function(a,b,f){var c=this;c.objectItems&&(a="object"===typeof a?e.grep(c.itemsArray,function(b){return c.options.itemValue(b)==c.options.itemValue(a)}):e.grep(c.itemsArray,function(b){return c.options.itemValue(b)==
a}),a=a[a.length-1]);if(a){var d=e.Event("beforeItemRemove",{item:a,cancel:!1,options:f});c.$element.trigger(d);if(d.cancel)return;e(".badge",c.$container).filter(function(){return e(this).data("item")===a}).remove();e("option",c.$element).filter(function(){return e(this).data("item")===a}).remove();-1!==e.inArray(a,c.itemsArray)&&c.itemsArray.splice(e.inArray(a,c.itemsArray),1)}b||c.pushVal(c.options.triggerChange);c.options.maxTags>c.itemsArray.length&&c.$container.removeClass("bootstrap-tagsinput-max");
c.$element.trigger(e.Event("itemRemoved",{item:a,options:f}))},removeAll:function(){e(".badge",this.$container).remove();for(e("option",this.$element).remove();0<this.itemsArray.length;)this.itemsArray.pop();this.pushVal(this.options.triggerChange)},refresh:function(){var a=this;e(".badge",a.$container).each(function(){var b=e(this),f=b.data("item"),c=a.options.itemValue(f),d=a.options.itemText(f),h=a.options.tagClass(f);b.attr("class",null);b.addClass("badge "+k(h));b.contents().filter(function(){return 3==
this.nodeType})[0].nodeValue=k(d);a.isSelect&&e("option",a.$element).filter(function(){return e(this).data("item")===f}).attr("value",c)})},items:function(){return this.itemsArray},pushVal:function(){var a=this,b=e.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(b.join(a.options.delimiter));a.options.triggerChange&&a.$element.trigger("change")},build:function(a){var b=this;b.options=e.extend({},q,a);b.objectItems&&(b.options.freeInput=!1);m(b.options,"itemValue");
m(b.options,"itemText");n(b.options,"tagClass");if(b.options.typeahead){var f=b.options.typeahead||{};n(f,"source");b.$input.typeahead(e.extend({},f,{source:function(a,c){function d(a){for(var d=[],e=0;e<a.length;e++){var g=b.options.itemText(a[e]);h[g]=a[e];d.push(g)}c(d)}var h=this.map={};a=f.source(a);e.isFunction(a.success)?a.success(d):e.isFunction(a.then)?a.then(d):e.when(a).then(d)},updater:function(a){b.add(this.map[a]);return this.map[a]},matcher:function(a){return-1!==a.toLowerCase().indexOf(this.query.trim().toLowerCase())},
sorter:function(a){return a.sort()},highlighter:function(a){return a.replace(new RegExp("("+this.query+")","gi"),"<strong>$1</strong>")}}))}if(b.options.typeaheadjs){var c=b.options.typeaheadjs;e.isArray(c)||(c=[null,c]);e.fn.typeahead.apply(b.$input,c).on("typeahead:selected",e.proxy(function(a,e,g){var d=0;c.some(function(a,b){return a.name===g?(d=b,!0):!1});c[d].valueKey?b.add(e[c[d].valueKey]):b.add(e);b.$input.typeahead("val","")},b))}b.$container.on("click",e.proxy(function(a){b.$element.attr("disabled")||
b.$input.removeAttr("disabled");b.$input.focus()},b));if(b.options.addOnBlur&&b.options.freeInput)b.$input.on("focusout",e.proxy(function(a){0===e(".typeahead, .twitter-typeahead",b.$container).length&&(b.add(b.$input.val()),b.$input.val(""))},b));b.$container.on({focusin:function(){b.$container.addClass(b.options.focusClass)},focusout:function(){b.$container.removeClass(b.options.focusClass)}});b.$container.on("keydown","input",e.proxy(function(a){var c=e(a.target),d=b.findInputWrapper();if(b.$element.attr("disabled"))b.$input.attr("disabled",
"disabled");else{switch(a.which){case 8:0===p(c[0])&&(d=d.prev(),d.length&&b.remove(d.data("item")));break;case 46:0===p(c[0])&&(d=d.next(),d.length&&b.remove(d.data("item")));break;case 37:a=d.prev();0===c.val().length&&a[0]&&(a.before(d),c.focus());break;case 39:a=d.next(),0===c.val().length&&a[0]&&(a.after(d),c.focus())}d=c.val().length;c.attr("size",Math.max(this.inputSize,d+Math.ceil(d/5)+1))}},b));b.$container.bind("paste",function(a){if(b.options.alphanumeric){var c=a.originalEvent.clipboardData.getData("text"),
d=c.match(/^[a-z0-9-]+$/i);console.log("paste",c,d);d||a.preventDefault()}});b.$container.on("keypress","input",e.proxy(function(a){var c=e(a.target);if(b.$element.attr("disabled"))b.$input.attr("disabled","disabled");else{var d=c.val(),f=b.options.maxChars&&d.length>=b.options.maxChars;b.options.freeInput&&(w(a,b.options.confirmKeys)||f)&&(0!==d.length&&(b.add(f?d.substr(0,b.options.maxChars):d),c.val("")),!1===b.options.cancelConfirmKeysOnEmpty&&a.preventDefault());b.options.alphanumeric&&(d=String.fromCharCode(a.which),
d.match(/^[a-z0-9-]+$/i)||a.preventDefault());a=c.val().length;c.attr("size",Math.max(this.inputSize,a+Math.ceil(a/5)+1))}},b));b.$container.on("click","[data-role=remove]",e.proxy(function(a){b.$element.attr("disabled")||b.remove(e(a.target).closest(".badge").data("item"))},b));b.options.itemValue===q.itemValue&&("INPUT"===b.$element[0].tagName?b.add(b.$element.val()):e("option",b.$element).each(function(){b.add(e(this).attr("value"),!0)}))},destroy:function(){this.$container.off("keypress","input");
this.$container.off("click","[role=remove]");this.$container.remove();this.$element.removeData("tagsinput");this.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],b=this.$container[0];a&&a.parentNode!==b;)a=a.parentNode;return e(a)}};e.fn.tagsinput=function(a,b,f){var c=[];this.each(function(){var d=e(this).data("tagsinput");d?a||b?void 0!==d[a]&&(d=3===d[a].length&&void 0!==f?d[a](b,null,f):d[a](b),void 0!==
d&&c.push(d)):c.push(d):(d=new l(this,a),e(this).data("tagsinput",d),c.push(d),"SELECT"===this.tagName&&e("option",e(this)).attr("selected","selected"),e(this).val(e(this).val()))});return"string"==typeof a?1<c.length?c:c[0]:c};e.fn.tagsinput.Constructor=l;var v=e("<div />")})(window.jQuery);
