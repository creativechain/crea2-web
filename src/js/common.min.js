"use strict";function _typeof(b){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){a=function a(c){return typeof c}}else{a=function a(c){return c&&typeof Symbol==="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c}}return a(b)}function _instanceof(b,a){if(a!=null&&typeof Symbol!=="undefined"&&a[Symbol.hasInstance]){return a[Symbol.hasInstance](b)}else{return b instanceof a}}function _classCallCheck(a,b){if(!_instanceof(a,b)){throw new TypeError("Cannot call a class as a function")}}var IpfsFile=function IpfsFile(d,a,c,b){_classCallCheck(this,IpfsFile);this.hash=d;this.name=a;this.type=c;this.size=b;this.url="https://ipfs.creary.net/ipfs/"+d};var creaEvents=new EventEmitter();var bannerVue;var globalLoading;var CONSTANTS={ACCOUNT:{UPDATE_THRESHOLD:1000*60*60},TRANSFER:{TRANSFER_CREA:"transfer_crea",TRANSFER_CBD:"transfer_cbd",TRANSFER_TO_SAVINGS_CREA:"transfer_to_savings_crea",TRANSFER_TO_SAVINGS_CBD:"transfer_to_savings_cbd",TRANSFER_FROM_SAVINGS_CREA:"transfer_from_savings_crea",TRANSFER_FROM_SAVINGS_CBD:"transfer_from_savings_cbd",TRANSFER_TO_VESTS:"transfer_to_vests"},FILE_MAX_SIZE:{PROFILE:{IMAGE:1024*500},POST_BODY:{AUDIO:100*1024*1024,VIDEO:200*1024*1024,IMAGE:5*1024*1024,DOWNLOAD:200*1024*1024},POST_PREVIEW:{IMAGE:1024*500}},TEXT_MAX_SIZE:{PROFILE:{PUBLIC_NAME:21,ABOUT:144,CONTACT:55,WEB:55},TITLE:55,DESCRIPTION:233,COMMENT:233,TAG:21,PERMLINK:255},MAX_TAGS:8,BUZZ:{MAX_LOG_NUM:20,LEVELS:["novice","trainee","advanced","expert","influencer","master","guru","genius"]}};creaEvents.on("crea.session.login",function(b,a){showBanner(b===false)});function showBanner(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(bannerVue){bannerVue.showBanner=a}}function goTo(a){window.location.href=a}function showPost(a){if(!a.url){a.url="/"+a.metadata.tags[0]+"/@"+a.author+"/"+a.permlink}goTo(a.url)}function showProfile(a){a=a.match(/[\w\.\d-]+/gm);if(a){goTo("/@"+a)}}function updateUrl(a){window.history.pushState("","",a)}function toHome(a){if(a){if(window.location.href.indexOf(a)>-1){goTo("/")}}else{goTo("/")}}function resolveFilter(a){a=a.toLowerCase();return a}function isInHome(){var b=["/skyrockets","/popular","/now","/popular30","/created","/promoted","/votes","/actives","/cashout","/responses","/payout","/payout_comments"];var a=Session.getAlive();if(a&&isUserFeed(a.account.username)){return true}return b.includes(window.location.pathname)}function createBlockchainAccount(d,a,c){var b=crea.auth.getPrivateKeys(d,a,DEFAULT_ROLES);refreshAccessToken(function(f){var e=new HttpClient(apiOptions.apiUrl+"/createCrearyAccount");e.when("done",function(g){g=jsonify(g);if(c){c(null,g)}});e.when("fail",function(g,i,h){if(c){c(h)}});e.headers={Authorization:"Bearer "+f};e.post({username:d,active:b.activePubkey,owner:b.ownerPubkey,posting:b.postingPubkey,memo:b.memoPubkey})})}function removeBlockedContents(d,e,c){if(d){var b=c?c:Object.keys(d.content);if(e){var a=[];b.forEach(function(f){var g=d.content[f];if(e.user.blockeds.indexOf(g.author)<0){a.push(f)}});return a}return b}return null}function parseAccount(a){if(a){a.metadata=jsonify(a.json_metadata);a.metadata.avatar=a.metadata.avatar||{};a.metadata.adult_content=a.metadata.adult_content||"hide";a.metadata.post_rewards=a.metadata.post_rewards||"50";a.metadata.comment_rewards=a.metadata.comment_rewards||"50";a.metadata.lang=a.metadata.lang||getNavigatorLanguage();a.buzz=crea.formatter.reputation(a.reputation,CONSTANTS.BUZZ.LEVELS.length,CONSTANTS.BUZZ.MAX_LOG_NUM);if(a.buzz.level<=0){a.buzz.level=1}a.buzz.level_name=CONSTANTS.BUZZ.LEVELS[a.buzz.level-1];a.buzz.level_title=lang.BUZZ[a.buzz.level-1];return a}return a}function parsePost(a){if(a){a.link=a.author+"/"+a.permlink;a.body=isJSON(a.body)?jsonify(a.body):a.body;a.body=cleanArray(a.body);a.metadata=jsonify(a.json_metadata);a.down_votes=[];a.up_votes=[];a.active_votes.forEach(function(c){if(c.percent<0){a.down_votes.push(c)}else{if(c.percent>0){a.up_votes.push(c)}}});var b=function b(c){if(_typeof(c)==="object"){return Asset.parse(c).toFriendlyString(null,false)}return c};a.curator_payout_value=b(a.curator_payout_value);a.max_accepted_payout=b(a.max_accepted_payout);a.pending_payout_value=b(a.pending_payout_value);a.promoted=b(a.promoted);a.total_payout_value=b(a.total_payout_value);a.total_pending_value=b(a.total_pending_value)}return a}function getAccounts(a,b){crea.api.getAccounts(a,function(e,d){if(b){if(e){b(e)}else{for(var c=0;c<d.length;c++){d[c]=parseAccount(d[c])}b(null,d)}}})}function getDiscussion(c,a,d){if(typeof a==="function"){d=a;var b;[b,c,a]=/([\w\.\d-]+)\/([\w\d-]+)/gm.exec(c)}else{c=/[\w\.\d-]+/gm.exec(c)[0]}crea.api.getDiscussion(c,a,d)}function recommendPost(c,a,e){var b=Session.getAlive();if(b){var d={account:b.account.username,author:c,permlink:a};d=["reblog",d];requireRoleKey(b.account.username,"posting",function(f){globalLoading.show=true;crea.broadcast.customJson(f,[],[b.account.username],"follow",jsonstring(d),function(h,g){globalLoading.show=false;if(e){if(h){e(h)}else{e(null,g)}}})})}}function ignoreUser(b,e,d){var a=Session.getAlive();if(a){var c={follower:a.account.username,following:b,what:e?["ignore"]:[]};c=["follow",c];requireRoleKey(a.account.username,"posting",function(f){globalLoading.show=true;crea.broadcast.customJson(f,[],[a.account.username],"follow",jsonstring(c),function(h,g){globalLoading.show=false;if(d){if(h){d(h)}else{d(null,g)}}})})}else{if(d){d(Errors.USER_NOT_LOGGED)}}}function updateUserSession(){var a=Session.getAlive();if(a){a.login(function(e,f){if(!catchError(e)){var d=2;var g=function g(i,h){--d;if(d===0){creaEvents.emit("crea.session.login",i,h)}};var c=[];var b=[];crea.api.getFollowing(a.account.username,"","blog",1000,function(i,h){if(!catchError(i)){h.following.forEach(function(j){c.push(j.following)});f.user.followings=c;g(a,f)}});crea.api.getFollowing(a.account.username,"","ignore",1000,function(i,h){if(!catchError(i)){h.following.forEach(function(j){b.push(j.following)});f.user.blockeds=b;g(a,f)}})}})}else{creaEvents.emit("crea.session.update",false)}}function refreshAccessToken(g){var e=new Date().getTime();var a=localStorage.getItem(CREARY.ACCESS_TOKEN_EXPIRATION);a=isNaN(a)?0:a;if(a<=e){var d=apiOptions.apiUrl+"/oauth/v2/token";var c=new HttpClient(d);var f={grant_type:"client_credentials",client_id:"1_2e5ws1sr915wk0o4kksc0swwoc8kc4wgkgcksscgkkko404g8c",client_secret:"3c2x9uf9uwg0ook0kksk8koccsk44w0gg4csos04ows444ko4k"};c.when("done",function(h){h=JSON.parse(h);localStorage.setItem(CREARY.ACCESS_TOKEN,h.access_token);localStorage.setItem(CREARY.ACCESS_TOKEN_EXPIRATION,new Date().getTime()+h.expires_in*1000);if(g){g(h.access_token)}});c.post(f)}else{if(g){var b=localStorage.getItem(CREARY.ACCESS_TOKEN);g(b)}}}function resizeImage(c,d){var b=500;console.log(c);if(c.type==="image/png"||c.type==="image/jpg"||c.type==="image/jpeg"){var a=new FileReader();a.onload=function(f){var e=new Image();e.onload=function(){var g;if(e.width<=e.height&&e.width>b){g={maxWidth:b,maxHeight:Infinity}}else{if(e.height<=e.width&&e.height>b){g={maxWidth:Infinity,maxHeight:b}}}if(g){g.quality=0.8;g.success=function(h){console.log(h);if(d){d(h)}};new Compressor(c,g)}else{if(d){d(c)}}};e.src=f.target.result};a.readAsDataURL(c)}else{if(d){d(c)}}}function uploadToIpfs(a,c,b){if(window.File&&window.FileReader&&window.FileList&&window.Blob){if(!c){if(b){b(lang.PUBLISH.FILE_FORMAT_NOT_ALLOWED)}}else{if(a.size<=c){refreshAccessToken(function(e){var d=new HttpClient(apiOptions.ipfsd);d.setHeaders({Authorization:"Bearer "+e}).post({file:a}).when("done",function(h){h=jsonify(h);console.log(h);if(b){var g=new IpfsFile(h.data.hash,a.name,a.type,a.size);b(null,g)}});d.when("fail",function(f,h,g){if(b){b(g)}})})}else{globalLoading.show=false;console.error("File",a.name,"too large. Size:",a.size,"MAX:",c);if(b){b(lang.PUBLISH.FILE_TOO_LARGE)}}}}else{globalLoading.show=false}}function downloadFile(b,a){var c=document.createElement("a");c.setAttribute("href",b);c.setAttribute("download",a);c.style.display="none";document.body.appendChild(c);c.click();document.body.removeChild(c)}function performSearch(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var a=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var e=arguments.length>3?arguments[3]:undefined;var d="/search?query="+encodeURIComponent(b)+"&page="+c;if(a){updateUrl(d);refreshAccessToken(function(g){var f=new HttpClient(apiOptions.apiUrl+"/searchCreaContent");f.setHeaders({Authorization:"Bearer "+g});f.when("done",function(i){var j=jsonify(i).data;for(var h=0;h<j.length;h++){j[h].tags=jsonify(j[h].tags)}creaEvents.emit("crea.search.content",j);if(e){e()}});f.when("fail",function(h,j,i){console.error(h,j,i);catchError(i)});f.get({search:b,page:c})})}else{goTo(d)}}function catchError(d){if(d){console.error(d);var e;var b=[];if(typeof d==="string"){e=d}else{if(d.name){e=name}else{if(d.TITLE){e=d.TITLE}}if(d.message){var a=d.message.split(":");var c=a[a.length-1];console.error(c);if(c===" Account does not have enough flow to vote."||c.includes("RC. Please wait to transact, or energize CREA.")){e=lang.ERROR.INSUFFICIENT_RC.TITLE;b=lang.ERROR.INSUFFICIENT_RC.BODY;console.log(b)}else{b.push(c)}}if(d.BODY){b=d.BODY}}showAlert(e,b);return true}return false}function showAlert(c,a){var b={title:c,body:typeof a==="string"?[a]:a};creaEvents.emit("crea.alert",b)}function requireRoleKey(f,e,a,d){if(typeof a==="function"){d=a;a=false}if(d){var c=randomNumber(0,Number.MAX_SAFE_INTEGER);var b=Session.getAlive();if(b&&b.account.keys[e]){d(b.account.keys[e].prv,b.account.username)}else{creaEvents.on("crea.auth.role."+c,function(g,h){if(d){d(g,h)}creaEvents.off("crea.auth.role."+c)});creaEvents.emit("crea.auth.role",f,e,a,c)}}}creaEvents.on("crea.content.prepare",function(){globalLoading=new Vue({el:"#global-loading",data:{show:false}});if(document.getElementById("home-banner")!==null){bannerVue=new Vue({el:"#home-banner",data:{showBanner:false,lang:lang}})}});