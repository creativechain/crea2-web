"use strict";var homePosts;var lastPage;(function(){var e,d;function a(l,u,m){var D=m.content;var s=m.accounts;var I=Object.keys(D);var J=[];for(var t=0;t<I.length;t++){var E=I[t];if(!D[E].parent_author){D[E].metadata=jsonify(D[E].json_metadata);J.push(E)}}m.content=D;var A=Object.keys(s);A.forEach(function(x){s[x]=parseAccount(s[x])});m.accounts=s;if(u.startsWith("/")){u=u.substring(1)}var B=resolveFilter("/"+getPathPart()).replace("/","");var h=getPathPart(1)||"";if(isUserFeed(getPathPart())&&!m.discussion_idx[h]){I=J;I.sort(function(L,K){var x=toLocaleDate(D[L].created);var k=toLocaleDate(D[K].created);return k.getTime()-x.getTime()});m.discussion_idx[h]={};m.discussion_idx[h][B]=I;lastPage=lastPage?lastPage:1}else{if(window.location.pathname==="/search"){lastPage=getParameterByName("page")||1}else{var p=m.discussion_idx[h][B];lastPage=m.content[p[p.length-1]]}}m.discussion_idx[h][B]=removeBlockedContents(m,d,m.discussion_idx[h][B]);if(!homePosts){homePosts=new Vue({el:"#home-posts",data:{session:e,account:d,filter:u,category:B,discuss:h,urlFilter:l,state:m,search:getParameterByName("query"),simpleView:false,lang:lang},updated:function H(){if(mr.masonry){mr.masonry.windowLoad();mr.masonry.updateLayout()}},methods:{isFeed:function(){return isUserFeed()},getDefaultAvatar:R.getAvatar,toggleSimpleView:function(){this.simpleView=!this.simpleView;console.log("SimpleView",this.simpleView)},onFollow:function q(x,k){updateUserSession()},openPost:showPost,parseAsset:function z(k){return Asset.parse(k).toFriendlyString()},getBuzzClass:function C(K){var x={};var k=K.buzz.level_name;x[k]=true;return x},getFeaturedImage:function r(x){var k=x.metadata.featuredImage;if(k&&k.hash){return{url:apiOptions.ipfs+k.hash}}else{if(k&&k.url){return k}}return{}},getTags:function j(x){var k=x.metadata.tags;var K=[];k=k.slice(0,7);k.forEach(function(L){K.push('<a href="/search?page=1&query='+encodeURIComponent(L)+'">'+L+"</a>")});return K.join(", ")},getFutureDate:function i(k){return moment(toLocaleDate(k)).fromNow()},hasPaid:function G(K){var x=new Date();var k=toLocaleDate(K.cashout_time);return x.getTime()>k.getTime()},getPayoutPostDate:function F(x){var k=toLocaleDate(x.cashout_time);if(this.hasPaid(x)){k=toLocaleDate(x.last_payout)}return moment(k).fromNow()},hasPromotion:function w(x){var k=Asset.parseString(x.promoted);return k.amount>0},getPromotion:function v(x){var k=Asset.parseString(x.promoted);return"$ "+k.toPlainString()},getPayout:function o(x){var k=Asset.parseString(x.pending_payout_value);if(this.hasPaid(x)){k=Asset.parseString(x.total_payout_value);k=k.add(Asset.parseString(x.curator_payout_value))}return"$ "+k.toPlainString()},getPendingPayouts:function n(Q,x){x=x?x.toLowerCase():"";var T=Asset.parse({amount:Asset.parseString(this.state.feed_price.base).toFloat()/Asset.parseString(this.state.feed_price.quote).toFloat(),nai:"cbd"});var M=this.state.props.cbd_print_rate;var K=10000;var O=Asset.parse(Q.pending_payout_value);var N=O;var U=Q.percent_crea_dollars/20000;var L=Asset.parse({amount:N.toFloat()*U,nai:"cbd"});var P=Asset.parse({amount:NaNOr(((N.toFloat()-L.toFloat())/T.toFloat()),0),nai:"cgy"});var S=Asset.parse({amount:NaNOr((L.toFloat()*(M/K)),0),nai:"cbd"});var k=Asset.parse({amount:NaNOr(((L.toFloat()-S.toFloat())/T.toFloat()),0),nai:"crea"});switch(x){case"cgy":return P.toFriendlyString(null,false);case"cbd":return S.toFriendlyString(null,false);case"crea":return k.toFriendlyString(null,false);default:return"("+S.toFriendlyString(null,false)+", "+k.toFriendlyString(null,false)+", "+P.toFriendlyString(null,false)+")"}},parseJSON:function g(k){if(k&&k.length>0){try{return JSON.parse(k)}catch(x){catchError(x)}}return{}},onVote:function f(L,k,x){catchError(L);var K=this;getDiscussion(x.author,x.permlink,function(O,M){if(!O){var N=parsePost(M);K.state.content[N.link]=N;K.$forceUpdate()}})},getLicense:function y(k){if(k){return License.fromFlag(k)}return new License(LICENSE.FREE_CONTENT)}}})}else{homePosts.session=e;homePosts.account=d;homePosts.filter=u;homePosts.category=B;homePosts.discuss=h;homePosts.state=m;homePosts.urlFilter=l;homePosts.search=getParameterByName("query")}homePosts.$forceUpdate();creaEvents.emit("crea.dom.ready")}creaEvents.on("crea.posts",function(q,h,g){var n=[];for(var k in g.content){var j=g.content[k].author;if(!n.includes(j)){n.push(j)}g.content[k]=parsePost(g.content[k])}if(isUserFeed(getPathPart())){getAccounts(n,function(w,s){if(!catchError(w)){var v={};s.forEach(function(x){v[x.name]=x});if(homePosts){for(var t in v){homePosts.state.accounts[t]=v[t]}for(var u in g.content){homePosts.state.content[u]=parsePost(g.content[u])}g=homePosts.state}else{g.accounts=v}a(q,h,g)}})}else{if(homePosts&&homePosts.urlFilter===q&&q==="/search"){var l=getParameterByName("query");if(l===homePosts.search&&l!==null){for(var p in g.accounts){homePosts.state.accounts[p]=parseAccount(g.accounts[p])}for(var f in g.content){homePosts.state.content[f]=parsePost(g.content[f])}var i=g.discussion_idx[""].search;for(var o=0;o<i.length;o++){if(!homePosts.state.discussion_idx[""].search.includes(i[o])){homePosts.state.discussion_idx[""].search.push(i[o])}}homePosts.state.discussion_idx[""].search=removeBlockedContents(homePosts.state,d,homePosts.state.discussion_idx[""].search)}else{a(q,h,g)}}else{if(homePosts&&homePosts.urlFilter===q){for(var m in g.accounts){homePosts.state.accounts[m]=parseAccount(g.accounts[m])}for(var r in g.content){homePosts.state.content[r]=parsePost(g.content[r])}g=homePosts.state}a(q,h,g)}}});function c(i){var h=window.location.pathname;if(h==="/"){if(e){i=i?i:"/@"+e.account.username+"/feed";creaEvents.emit("crea.content.filter",i)}else{creaEvents.emit("crea.content.filter","/popular")}}else{if(isUserFeed(getPathPart())){if(e){if(getPathPart()!==("@"+e.account.username)){showProfile(getPathPart())}else{creaEvents.emit("crea.content.filter",h)}}else{showProfile(getPathPart())}}else{if(h.startsWith("/search")){var f=getParameterByName("query");var g=getParameterByName("page")||1;performSearch(f,g,true)}else{creaEvents.emit("crea.content.filter",h)}}}}creaEvents.on("crea.session.update",function(g,f){homePosts.session=e=g;homePosts.account=d=f;c(homePosts.urlFilter)});creaEvents.on("crea.session.login",function(g,f){e=g;d=f;c()});var b;creaEvents.on("crea.scroll.bottom",function(){if(!b){b=true;if(isUserFeed()){var f=new HttpClient(apiOptions.apiUrl+"/creary/feed");f.when("done",function(l){var p=jsonify(l).data;if(p.length){var o=p.length;var n=[];var m=[];var q=function q(){o--;if(o<=0){getAccounts(m,function(s,u){if(!catchError(s)){u.forEach(function(v){homePosts.state.accounts[v.name]=parseAccount(v)});n.sort(function(y,x){var w=toLocaleDate(y.created);var v=toLocaleDate(x.created);return v.getTime()-w.getTime()});var t=homePosts.discuss;var r=homePosts.category;n.forEach(function(w){var v=w.author+"/"+w.permlink;homePosts.state.content[v]=w;homePosts.state.discussion_idx[t][r].push(v)});homePosts.state.discussion_idx[t][r]=removeBlockedContents(homePosts.state,d,homePosts.state.discussion_idx[t][r]);homePosts.$forceUpdate()}b=false})}else{b=false}};p.forEach(function(s){var r=s.author+"/"+s.permlink;if(!homePosts.state.content[r]){crea.api.getContent(s.author,s.permlink,function(u,t){if(u){console.error("Error getting",r,u)}else{var v=parsePost(t);v.reblogged_by=s.reblogged_by;n.push(v);if(!homePosts.state.accounts[s.author]&&!m.includes(s.author)){m.push(s.author)}}q()})}else{homePosts.state.content[r].reblogged_by=s.reblogged_by}})}else{b=false;--lastPage}});f.when("fail",function(l,n,m){b=false;catchError(n)});var k=getPathPart().replace("/","").replace("@","");crea.api.getFollowing(k,"","blog",1000,function(n,l){if(!catchError(n)){var m=[];l.following.forEach(function(o){m.push(o.following)});if(m.length){m=m.join(",");refreshAccessToken(function(o){f.headers={Authorization:"Bearer "+o};lastPage++;f.post({following:m,page:lastPage,reblogs:true})})}}})}else{if(window.location.pathname==="/search"){var j=getParameterByName("query");var h=Object.keys(homePosts.state.content).length;if(h>0&&h%20===0){globalLoading.show=true;performSearch(j,++lastPage,true,function(){b=false;globalLoading.show=false})}}else{var g;var i=homePosts.category;switch(i){case"now":g=crea.api.getDiscussionsByNow;break;case"skyrockets":g=crea.api.getDiscussionsBySkyrockets;break;case"promoted":g=crea.api.getDiscussionsByPromoted;break;case"popular":g=crea.api.getDiscussionsByPopular;break;default:g=crea.api["getDiscussionsBy"+i.capitalize()];break}if(g){g(lastPage.author,lastPage.permlink,21,function(p,m){if(p){console.error(p)}else{var o=m.discussions;o.shift();var n=[];for(var l=0;l<o.length;l++){var q=o[l];o[l]=parsePost(q);if(!homePosts.state.accounts[q.author]&&!n.includes(q.author)){n.push(q.author)}}getAccounts(n,function(r,t){if(!catchError(r)){t.forEach(function(u){homePosts.state.accounts[u.name]=u});var s=homePosts.discuss;o.forEach(function(v){var u=v.author+"/"+v.permlink;homePosts.state.content[u]=v;homePosts.state.discussion_idx[s][i].push(u)});homePosts.state.discussion_idx[s][i]=removeBlockedContents(homePosts.state,d,homePosts.state.discussion_idx[s][i]);lastPage=o[o.length-1];homePosts.$forceUpdate()}b=false})}})}}}}});creaEvents.on("crea.search.content",function(j){var i={content:{},accounts:{},discussion:[]};var g=0;var h=function h(l){g++;if(g>=j.length){console.log(l);l.content=i.content;l.accounts=i.accounts;i.discussion.sort(function(n,m){return l.content[m].active_votes.length-l.content[n].active_votes.length});l.discussion_idx[""]={};l.discussion_idx[""].search=i.discussion;creaEvents.emit("crea.posts","/search","search",l)}};var k=function k(l){var m=function m(o){var p=o.author+"/"+o.permlink;var n="/"+o.tags[0]+"/@"+p;crea.api.getState(n,function(r,q){if(r){console.error(r);m(o)}else{i.discussion.push(p);i.accounts[o.author]=q.accounts[o.author];i.content[p]=q.content[p];h(q)}})};m(j[l])};for(var f=0;f<j.length;f++){k(f)}if(j.length===0){crea.api.getState("/no_results",function(m,l){if(!catchError(m)){h(l)}})}});creaEvents.on("crea.dom.ready",function(){$("#view-changer").click(function(){homePosts.toggleSimpleView()})})})();